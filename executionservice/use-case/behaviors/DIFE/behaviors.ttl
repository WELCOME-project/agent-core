# @base <http://localhost:8090/rdf4j/repositories/behaviors#> .

@prefix agents: <http://localhost:8090/rdf4j/repositories/agents#> .
@prefix : <http://localhost:8090/rdf4j/repositories/behaviors#> .
@prefix domain: <http://localhost:8090/rdf4j/repositories/domain#> .
@prefix localServices: <http://localhost:8090/rdf4j/repositories/localServices#> .
@prefix localAgents: <http://localhost:8090/rdf4j/repositories/localAgents#> .
@prefix services: <http://localhost:8090/rdf4j/repositories/services#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix ajan: <http://www.ajan.de/ajan-ns#> .
@prefix bt: <http://www.ajan.de/behavior/bt-ns#> .
@prefix actn: <http://www.ajan.de/actn#> .
@prefix http-headers: <http://www.w3.org/2008/http-headers#> .
@prefix http-methods: <http://www.w3.org/2008/http-methods#> .
@prefix http-core: <http://www.w3.org/2006/http#> .
@prefix ssc: <http://welcome/ajan/servicecomputing#> .
@prefix myWelcome: <http://www.ajan.de/myWelcome-ns#> .
@prefix welcomePlugin: <http://welcome/ajan/plugin#> .

# ----------------------------------------------
# ------------- WelcomeBehaviorTree ------------
# ----------------------------------------------

# ----------- Endpoint ------------

# localhost:8080/welcome/integration/coordination/ajan/agents/<agentName>?capability=receiveSpeechAct | POST | text/turtle
# Body: "<http://test/Subject> <http://test/predicate> "Hallo! I come from the KMS" ."
# localhost:8080/welcome/integration/coordination/ajan/agents/<agentName>?capability=populateRepo | POST | text/turtle
# Body: "<http://test/Subject> <http://test/predicate> "Hallo! I come from the WPM" ."

# ------------------------------------------- 
# ---------------- Behaviors ----------------
# ------------------------------------------- 
        
:InitialWelcomeBehavior
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Initialization Behavior" ;
  bt:hasChild [
          a bt:Sequence ;
          bt:hasChildren (
                    :UpdateBehaviorRunning
                    [
                      a bt:Priority ;
                      bt:hasChildren (
                                :ConditionLSRPopulated
                                :EventProducerPopulateLSR
                              )                                                           
                    ]
                    [
                      a bt:Priority ;
                      bt:hasChildren (
                                :ConditionLARPopulated
                                :EventProducerPopulateLAR                           
                              )                                                           
                    ]
                  )
        ] .

:FinalWelcomeBehavior
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Final Behavior" ;
  bt:hasChild [
          a bt:Sequence ;
          bt:hasChildren (
                    :DeleteTemporalFlagsinLAKR
                    :DeleteTemporalFlagsinLSR
                  )
        ] .

:HeartbeatMonitoringBT
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Heartbeat behavior" ;
  bt:hasChild [
          a bt:Sequence ;
          bt:hasChildren (
                    :AgentMonitoringHandleEvent
                  )
        ] .

:ErrorHandlingBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Error Handling Behavior" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:ReceiveErrorHandleEvent
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						:ConditionKMSError
																						:UpdateCreateClosingUponFailureFarewellKMSError_Part1
																						:UpdateCreateClosingUponFailureFarewellKMSError_Part2
																						#:UpdateCreateHeaderDMSMessage																												
																						:SendIncompleteOrMultipleDIPDMS
																					)																															
																]
															)																															
										]
										[
											a bt:IsSucceeding ;
											bt:hasChild 	
														:UpdateEmptyExecutionRepository
										]
									)
				] .
        
:PopulateLSRRepos
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Populate Local LSR Repository" ;
  bt:hasChild [
          a bt:Priority ;
          bt:hasChildren (
                    [
                      a bt:Sequence ;
                      bt:hasChildren (
                                :EventHandlerRequestLSRTriples
                                :UpdateBehaviorRunning
                                :UpdateCreateHeaderDispatcherMessage
                                :MessageSendLSRMessageWPM
                                :DefaultFailed
                              )                                                           
                    ]
                    [
                      a bt:Sequence ;
                      bt:hasChildren (
                                :EventHandlerReceiveLocalServices
                                :UpdateBehaviorRunning
                                [
                                  a bt:Priority ;
                                  bt:hasChildren (
                                            [
                                              a bt:Invert ;
                                              bt:hasChild 
                                                    :ConditionLSRPopulated                                                            
                                            ]
                                            :RemoveLSRContent
                                            :UpdateLSRAgentKnowledge
                                          )                                                             
                                ]
                                :WriteTriplesLSRC1
                                :WriteTriplesLSRC2
                                :WriteTriplesLSRC3
								:WriteTriplesLSRC4
                                :PluginOWL2PDDL
                                :UpdateAgentKnowsLSR
                                :UpdateLSRExecutionKnowledge
                                :UpdateDeleteBehaviorRunning
                              )                                                             
                    ]
                   )
        ] .

:PopulateLARRepos
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Populate Local LAR Repository" ;
  bt:hasChild [
          a bt:Priority ;
          bt:hasChildren (
                    [
                      a bt:Sequence ;
                      bt:hasChildren (
                                :EventHandlerRequestLARTriples
                                :UpdateBehaviorRunning
                                :UpdateCreateHeaderDispatcherMessage
                                :MessageSendLARMessageWPM
                                :DefaultFailed
                              )                                                             
                    ]
                    [
                      a bt:Sequence ;
                      bt:hasChildren (
                                :EventHandlerReceiveLocalAgents
                                :UpdateBehaviorRunning
                                [
                                  a bt:Priority ;
                                  bt:hasChildren (
                                            [
                                              a bt:Invert ;
                                              bt:hasChild 
                                                    :ConditionLARPopulated                                                            
                                            ]
                                            :RemoveLARContent
                                            :UpdateLARAgentKnowledge
                                          )                                                             
                                ]
                                :WriteTriplesLAR
                                :UpdateAgentKnowsLAR
                                :UpdateLARExecutionKnowledge
                                :UpdateDeleteBehaviorRunning
                              )                                                             
                    ]
                   )
        ] .
        
:HandshakeBehavior
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Handhshake BT" ;
  bt:hasChild [
          a bt:Priority ;
          bt:hasChildren (
                    [
                      a bt:Invert ;
                      bt:hasChild 
                            :EventHandlerHandshake
                    ]
                    [
                      a bt:Sequence ;
                      bt:hasChildren (
                                :UpdateBehaviorRunning
                                :ConditionLSRPopulated
                                [
                                  a bt:Priority ;
                                  bt:hasChildren ([
                                            a bt:Sequence ;
                                            bt:hasChildren (
                                                    :ConditionLARPopulated                                                    
                                                    :UpdateCreateHeaderAppMessage
                                                    :MessageSendAgentReadiness
                                                    :UpdateDeleteBehaviorRunning
                                                    )                                                             
                                          ]
                                          :EventProducerPopulateLAR
                                          )                                                       
                                ]
                              )
                    ]
                    :EventProducerPopulateLSR                 
                  )                                                           
  ] .
      
:ProcessSpeechActsBehavior
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Process Speech Acts BT" ;
  bt:hasChild [
          a bt:Sequence ;
          bt:hasChildren (
                    [
                      a bt:Priority ;
                      bt:hasChildren (
                                [
                                  a bt:Invert ;
                                  bt:hasChild 
                                        :EventSpeaktoavatar
                                ]
                                [
                                  a bt:Sequence ;
                                  bt:hasChildren (
                                            :UpdateBehaviorRunning
                                            [
												a bt:IsSucceeding ;
												bt:hasChild 	
														:UpdateEmptyExecutionRepository			
											]
											:WriteAgentNameinExecution
                                            :UpdateCreateOpeningDIPPart1
                                            :UpdateCreateOpeningDIPPart2
                                            :UpdateCreateOpeningDIPPart3
                                            :UpdateCreateHeaderKMSMessage
                                            :SendDIPtoKMS
                                          )
                                ]
                              )                                                           
                    ]
                    [
                      a bt:Priority ;
                      bt:hasChildren (
                                [
                                  a bt:Invert ;
                                  bt:hasChild 
                                        :EventDIP_OR_ServiceRequest
                                ]
                                [
                                  a bt:Priority ;
                                  bt:hasChildren (
                                            [
                                              a bt:Priority ;
                                              bt:hasChildren (
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :UpdateBehaviorRunning                                                                    
                                                                   [
																		a bt:IsSucceeding ;
																		bt:hasChild 	
																					:UpdateEmptyExecutionRepository
																					
																	]
                                                                    :WriteActiveDIPinExecution
                                                                    :ConditionDIPIncomplete
                                                                    :UpdateIncompleteDIP
                                                                    :EventProducerSpecificBTDIPIncomplete
                                                                  )
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionDIPCompleteOrUndefinedOrUnfinished
                                                                    :UpdateCompleteDIP
                                                                    [
                                                                      a bt:Priority ;
                                                                      bt:hasChildren (
                                                                                [
                                                                                  a bt:Sequence ;
                                                                                  bt:hasChildren (
                                                                                            :ConditionDIPIsNotOpening
                                                                                            :EventProducerSpecificBTDIPComplete
                                                                                          )
                                                                                ]
                                                                                [
                                                                                  a bt:Sequence ;
                                                                                  bt:hasChildren (
                                                                                            :ConditionalNoServiceRequest
                                                                                            :DeleteActiveDIPinAgentKB
                                                                                            [
																								a bt:IsSucceeding ;
																								bt:hasChild 	
																										:UpdateEmptyExecutionRepository
																							]
																							:WriteAgentNameinExecution
                                                                                            :CreateClosingUponFailureNoRequest_Part1
																							:CreateClosingUponFailureNoRequest_Part2
                                                                                            :UpdateCreateHeaderKMSMessage
                                                                                            :SendDIPtoKMS
                                                                                          )
                                                                                ]
                                                                              )
                                                                    ]
                                                                  )
                                                        ]                                                     
                                                      )
                                            ]
                                            [
                                              a bt:Priority ;
                                              bt:hasChildren (
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionServiceRequest
                                                                    [
                                                                      a bt:IsSucceeding ;
                                                                      bt:hasChild   
                                                                          :DeletePreviousServiceRequestinExecution
                                                                    ]                                                                   
                                                                    :WriteServiceRequestinExecution
                                                                    [
                                                                      a bt:Priority ;
                                                                      bt:hasChildren (
                                                                                [
                                                                                  a bt:Sequence ;
                                                                                  bt:hasChildren (
                                                                                            :InvokeMatchmaker
                                                                                            :ConditionMatchmakerOutput
                                                                                            :PDDL2SPARQLPlugin
                                                                                            [
                                                                                              a bt:Priority ;
                                                                                              bt:hasChildren (
                                                                                                        [
                                                                                                          a bt:Sequence ;
                                                                                                          bt:hasChildren (
                                                                                                                    :ConditionPreconditionHolds                                                                                                   
                                                                                                                   # [
                                                                                                                   #  a bt:Priority ;
                                                                                                                   #  bt:hasChildren (
                                                                                                                   #             [
                                                                                                                   #               a bt:Sequence ;
                                                                                                                   #               bt:hasChildren (
                                                                                                                   #                         :ConditionAtomicService
                                                                                                                   #                         :CreateAtomicServiceDIP
                                                                                                                   #                       )                                                           
                                                                                                                   #             ] 
                                                                                                                   #             [
                                                                                                                   #               a bt:Sequence ;
                                                                                                                   #               bt:hasChildren (
                                                                                                                   #                         :ConditionComposedService
                                                                                                                   #                         :CreateComposedServiceDIP
                                                                                                                   #                       )                                                           
                                                                                                                   #             ] 
                                                                                                                   #           )                                                           
                                                                                                                   # ] 
                                                                                                                    :DeleteSSCResultinAgentKB
                                                                                                                    :WriteSSCResultinAgentKB
                                                                                                                    :EventProducerFirstInteractionMove
                                                                                                                  )                                                           
                                                                                                        ]
                                                                                                        :EventProducerAlternativeFirstInteractionMove                                                                   
                                                                                                      )                                                           
                                                                                            ]
                                                                                          )
                                                                                ]                                         
                                                                                [
                                                                                  a bt:Sequence ;
                                                                                  bt:hasChildren (
                                                                                            :InvokePlanner
                                                                                            :ConditionPlannerOutput
                                                                                                 )                                                           
                                                                                ]
                                                                              )
                                                                    ]
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :DeleteActiveDIPinAgentKB
																	[
																		a bt:IsSucceeding ;
																		bt:hasChild 	
																					:UpdateEmptyExecutionRepository
																	]
																	:WriteAgentNameinExecution
																	:CreateClosingUponFailureNoRequest_Part1
																	:CreateClosingUponFailureNoRequest_Part2
																	:UpdateCreateHeaderKMSMessage
																	:SendDIPtoKMS
                                                                  )                                                           
                                                        ]                                         
                                                      )                                                           
                                            ]
                                          )
                                ]
                              )                                                           
                    ]                   
                    [
                      a bt:Priority ;
                      bt:hasChildren (
                                [
                                  a bt:Invert ;
                                  bt:hasChild 
                                        :EventDefaultStatementNoOpinion
                                ]
                                [
                                  a bt:Sequence ;
                                  bt:hasChildren (
                                            :UpdateBehaviorRunning
											:DeleteActiveDIPinAgentKB																						
											[
												a bt:IsSucceeding ;
												bt:hasChild 	
															:UpdateEmptyExecutionRepository
											]
											:WriteAgentNameinExecution
											:CreateClosingUponFailureInternalErrorPart1
											:CreateClosingUponFailureInternalErrorPart2
											:UpdateCreateHeaderKMSMessage
											:SendDIPtoKMS
                                          )
                                ]
                              )                                                           
                    ]
                  )
        ] .

:GenericInteractionDIFEScenarioBT
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Generic Interaction Behaviour for DIFE Scenarios" ;
  bt:hasChild [
          a bt:Priority ;
          bt:hasChildren (
                    [
                      a bt:Sequence ;
                      bt:hasChildren (
                                :EventHandlerFirstInteractionMove
                                :UpdateBehaviorRunning
                                :DeletePrecondition
                               [
									a bt:IsSucceeding ;
									bt:hasChild 	
													:UpdateEmptyExecutionRepository
								]
                                [
                                  a bt:IsSucceeding ;
                                  bt:hasChild   
                                        :DeleteActiveDIPinAgentKB
                                ]
                                [
                                  a bt:Priority ;
                                  bt:hasChildren (
                                            [
                                              a bt:Sequence ;
                                              bt:hasChildren (
                                                        :ConditionServiceFirstInteraction                                             
                                                        [
                                                          a bt:Priority ;
                                                          bt:hasChildren (
                                                                    [
                                                                      a bt:Sequence ;
                                                                      bt:hasChildren (
                                                                                :ConditionFirstMoveFirstReceptionService
                                                                                :WriteObtainRegistrationStatus2Execution  
                                                                              )
                                                                      
                                                                    ]  
                                                                    [
                                                                      a bt:Sequence ;
                                                                      bt:hasChildren (
                                                                                :ConditionFirstMoveCVCreation
                                                                                :WriteCVPurposeDIP2Execution
                                                                                [
																					a bt:Priority ;
																					bt:hasChildren (
																										[
																											a bt:Sequence ;
																											bt:hasChildren (
																																:ConditionExistingIncompleteCV																																																																																												
																																:UpdateCVPurpose_ExistingIncompleteDIP2Execution
																															)
																										]
																										[
																											a bt:Sequence ;
																											bt:hasChildren (
																																:ConditionExistingCompleteCV																																																																																												
																																:UpdateCVPurpose_ExistingCompleteDIP2Execution
																															)
																										]
																										[
																											a bt:Sequence ;
																											bt:hasChildren (
																																:ConditionNoCV																																																																																												
																																:UpdateCVPurpose_NoCVDIP2Execution
																															)
																										]
																									)
																				]
                                                                              )
                                                                    ]
																	[
																		a bt:Sequence ;
																		bt:hasChildren (
																							:ConditionFirstMoveSchooling
																							:WriteScenarioIntroductionSchoolingDIP2Execution
																						)
																	]
                                                                  )
                                                        ]
                                                      )                                                           
                                            ]
                                            [
                                              a bt:Sequence ;
                                              bt:hasChildren (
															   [
																	a bt:IsSucceeding ;
																	bt:hasChild 	
																				:UpdateEmptyExecutionRepository
																]
																:WriteAgentNameinExecution
																:WriteCreateInformContactNGOFarewellDIP2Execution_Part1
																:WriteCreateInformContactNGOFarewellDIP2Execution_Part2
																:WriteCreateInformContactNGOFarewellDIP2Execution_Part3
															)                                                           
                                            ]                                                                   
                                          )                                                           
                                ] 
                                :DeleteSSCResultinAgentKB
                                #:DeleteFirstInteractionFlaginExecution 
                                :DeleteFirstInteractionFlaginLAKR
                                :UpdateCreateHeaderKMSMessage
                                :SendDIPtoKMS                                         
                              )
                    ]
                    [
                      a bt:Sequence ;
                      bt:hasChildren (
                                :EventHandlerSpecificBT	
								[
									a bt:IsSucceeding ;
									bt:hasChild 	
												:UpdateEmptyExecutionRepository
								]
								:WriteSpecificBTFlaginExecution																
								[
									a bt:IsSucceeding ;
									bt:hasChild 	
													:DeleteSpecificBTFlaginAgentKB
								]
								:WriteActiveDIPinExecution
                                [
                                  a bt:Priority ;
                                  bt:hasChildren (  
                                            [
                                              a bt:Sequence ;
                                              bt:hasChildren (
                                                        :ConditionalFlagIncomplete
                                                        [
                                                          a bt:IsSucceeding ;
                                                          bt:hasChild   
                                                                :DeleteActiveDIPinAgentKB
                                                        ]
														:SendIncompleteOrMultipleDIPDMS
                                                      )                                                           
                                            ]
                                            [
                                              a bt:Sequence ;
                                              bt:hasChildren (
                                                        :ConditionalNormalClosing_ContactNGO_ClosingFailureComplete
                                                        :DeleteActiveDIPinAgentKB
                                                        #:SucessFinishScenario
                                                        :UpdateCreateHeaderAppMessage
                                                        :MessageSendDialogueFinishNotification
                                                      )                                                           
                                            ]
                                            [
                                              a bt:Priority ;
                                              bt:hasChildren (  
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionExecuteFirstReception
                                                                    :EventProducerExecuteFirstReceptionBT
                                                                  )
                                                        ]
														[
															a bt:Sequence ;
															bt:hasChildren (
																				:ConditionExecuteSchoolingBT
																				:EventProducerExecuteSchoolingBT
																			)
														]
                                                        :EventProducerExecuteCVCreationBT
                                                      )
                                            ]
                                          )
                                ]
                                :UpdateDeleteBehaviorRunning
                              )
                    ]
                  )
        ] .

      
:SpecificFirstReceptionBT
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Specific First Reception Behavior Tree" ;
  bt:hasChild [
          a bt:Sequence ;
          bt:hasChildren (
                    :EventHandlerExecuteFirstReceptionBT
                    :UpdateBehaviorRunning 					
                    [
                      a bt:IsSucceeding ;
                      bt:hasChild   

                            :UpdateEmptyExecutionRepository
                    ]
					:WriteActiveDIPinExecution					
                    :DeleteActiveDIPinAgentKB
                    [
                      a bt:Priority ;
                      bt:hasChildren (
                                [
                                  a bt:Sequence ;
                                  bt:hasChildren (
                                            :ConditionalInformRegistrationServiceComplete
                                            :EventProducerNormalClosingScenario
                                          )                                                           
                                ]
                                [
                                  a bt:Sequence ;
                                  bt:hasChildren (
                                            :ConditionalFillFormCourseDIPComplete
                                            :UpdateCreateHeaderAppNotificationMessage
                                            :SendNotification2App
                                          )                                                           
                                ]
                                [
                                  a bt:Sequence ;
                                  bt:hasChildren(
                                           [
                                              a bt:Priority ;
                                              bt:hasChildren (
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalUndefinedDIP
                                                                    :UpdateCreateClosingUponFailureUndefinedSlotDIP2Execution_Part1
                                                                    :UpdateCreateClosingUponFailureUndefinedSlotDIP2Execution_Part2
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalObtainRegistrationStatusCompleteAndYesAnswer  
                                                                    :WriteProposeService2Execution                                      
                                                                    :WriteSSCResultinExecution
                                                                    :UpdateProposeService
                                                                    :DeleteSSCResultinAgentKB
                                                                    :DeleteSSCResultinLSR
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalObtainRegistrationStatusCompleteAndNotAnswer
                                                                    :WriteObtainRegistrationServiceInfo2Execution
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalProposeServiceCompleteAndYes
                                                                    :WriteInformFirstReception2Execution
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalProposeServiceCompleteAndNot
                                                                    :WriteAgentNameinExecution
                                                                    :UpdateCreateInformContactNGO 
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalObtainRegistrationServiceInfoComplete
                                                                    :WriteInformRegistrationService2Execution
                                                                    :DeletePreviousRegistrationOfficesinExecution
                                                                    [
                                                                      a bt:Priority ;
                                                                      bt:hasChildren (
                                                                              [
                                                                                a bt:Sequence ;
                                                                                bt:hasChildren (
                                                                                          :ConditionalCoordinateExists
                                                                                          :WriteCoordinatesinExecution
                                                                                          :InvokeClosestDistancePlugin
                                                                                        )                                                           
                                                                              ]
                                                                              :WriteDefaultOfficeinExecution
                                                                              )                                                           
                                                                    ]
                                                                    :UpdateInformRegistrationServiceDIP
                                                                  )                                                           
                                                        ]                                                             
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalInformFirstReceptionServiceCompleteAndYesAnswer
                                                                    :WritePersonalInfoFirstReceptionDIP2Execution
                                                                  )                                                           
                                                        ]             
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalPersonalInfoComplete
                                                                    :WriteAddressInfoDIP2Execution
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalAddressInfoDIPComplete
                                                                    :WriteFillFormOtherDIP2Execution
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalFillFormOtherDIPComplete
                                                                    :WriteFillFormModulesDIP2Execution
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    :ConditionalFillFormModulesDIPComplete
                                                                    :WriteFillFormCourseDIP2Execution
                                                                  )                                                           
                                                        ]
                                                        [
                                                          a bt:Sequence ;
                                                          bt:hasChildren (
                                                                    [
                                                                      a bt:IsSucceeding ;
                                                                      bt:hasChild   
                                                                          :UpdateEmptyExecutionRepository
                                                                    ]
																	:WriteAgentNameinExecution
                                                                    :CreateClosingUponFailureInternalErrorPart1
                                                                    :CreateClosingUponFailureInternalErrorPart2
                                                                  )                                                           
                                                        ]
                                                      )
                                            ]
                                            :UpdateCreateHeaderKMSMessage
                                            :SendDIPtoKMS
                                          )
                                ]
                              )
                    ]                   
                  )
        ] . 

:CloseFirstReceptionScenarioBT
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Specific First Reception Closing Behavior Tree" ;
  bt:hasChild [
    a bt:Sequence ;
    bt:hasChildren (
              [
                a bt:Priority ;
                bt:hasChildren (
                          :EventHandlerNormalClosingScenario
                          :EventHandlerAlternativeClosingScenario
                        )
              ]                       
              :UpdateBehaviorRunning
              [
                a bt:IsSucceeding ;
                bt:hasChild   
                      :UpdateEmptyExecutionRepository
              ]
              :DeleteActiveDIPinAgentKB 
              :WriteAgentNameinExecution
              :UpdateCreateNormalClosingPart1
              :UpdateCreateNormalClosingPart2
			  :UpdateCreateHeaderKMSMessage
              :SendDIPtoKMS
            ) 
  ].

:SpecificCVCreationBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "CV Creation Behavior Tree" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:UpdateBehaviorRunning									
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Sequence ;
																	bt:hasChildren(
																					:EventHandlerCVNotification
																					[
																						a bt:IsSucceeding ;
																						bt:hasChild 	
																								:UpdateEmptyExecutionRepository
																					]
																					:WriteNotificationToExecution
																					:DeleteS7NotificationFromLAKR
																					[
																						a bt:Priority ;
																						bt:hasChildren (
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionIsPersonalInfoFinished
																																	:UpdateCreateHeaderAppMessageDisplay
																																	:MessageSendPersonalInfoSectionToApp 
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionIsEducationInformationFinished
																																	:UpdateCreateHeaderAppMessageDisplay
																																	:MessageSendEducationInformationSectionToApp 
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionIsOtherEducationInformationFinished
																																	:UpdateCreateHeaderAppMessageDisplay
																																	:MessageSendOtherEducationInformationSectionToApp 
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionIsLanguageInformationFinished
																																	:UpdateCreateHeaderAppMessageDisplay
																																	:MessageSendLanguageInformationSectionToApp 
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionIsEmploymentInformationFinished
																																	:UpdateCreateHeaderAppMessageDisplay
																																	:MessageSendEmploymentInformationSectionToApp 
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionIsSkillInformationFinished
																																	:UpdateCreateHeaderAppMessageDisplay
																																	:MessageSendSkillNotificationtoApp																																																															
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionIsOtherInformationFinished
																																	:UpdateCreateHeaderAppMessageDisplay
																																	:MessageSendOtherInformationSectionToApp 
																																)																														
																											]
																											#[
																											#	a bt:Sequence ;
																											#	bt:hasChildren (
																											#						:ConditionCreateCVDocumentFinished
																											#						:UpdateCreateHeaderAppMessageDisplay
																											#						:MessageSendCreateCVDocumentSectionToApp 
																											#					)																														
																											#]
																										)																														
																					]
																				  )
																]
																[
																	a bt:Sequence ;
																	bt:hasChildren(
																						:EventHandlerExecuteCVCreationBT
																						[
																							a bt:IsSucceeding ;
																							bt:hasChild 	
																									:UpdateEmptyExecutionRepository
																						]
																						:WriteActiveDIPinExecution
																						:DeleteActiveDIPinAgentKB
																						[
																							a bt:Priority ;
																							bt:hasChildren (
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalUndefinedDIP
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																							:UpdateEmptyExecutionRepository
																																		]
																																		:WriteAgentNameinExecution
																																		:UpdateCreateClosingUponFailureUndefinedSlotDIP2Execution_Part1
																																		:UpdateCreateClosingUponFailureUndefinedSlotDIP2Execution_Part2
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalAnyConfirmInfoNot_UndefinedValue
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																							:UpdateEmptyExecutionRepository
																																		]
																																		:WriteAgentNameinExecution
																																		:WriteCreateInformContactNGOFarewellDIP2Execution_Part1
																																		:WriteCreateInformContactNGOFarewellDIP2Execution_Part2
																																		:WriteCreateInformContactNGOFarewellDIP2Execution_Part3
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalCVPurposeInterestYes																																		
																																		:WritePersonalInfoDIP2Execution
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalCVPurposeInterestNot
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																					:UpdateEmptyExecutionRepository
																																		]
																																		:WriteAgentNameinExecution	
																																		:UpdateCreateInformContactNGOFarewell_GENERIC_DIP2Execution_Part1
																																		:UpdateCreateInformContactNGOFarewell_GENERIC_DIP2Execution_Part2
																																		:UpdateCreateInformContactNGOFarewell_GENERIC_DIP2Execution_Part3
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalPersonalInfoConfirmationYes
																																		:WriteEducationInformationDIP2Execution 
																																	)																														
																												] 																												
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalEducationInformationConfirmationYes
																																		:WriteOtherEducationInformationDIP2Execution
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalOtherEducationInformationConfirmationYes
																																		:WriteLanguageInformationDIP2Execution 
																																	)																														
																												]
																												
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalLanguageInformationConfirmationYes
																																		:WriteEmploymentInformationDIP2Execution 
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalEmploymentInformationConfirmationYes
																																		:WriteSkillInformationDIP2Execution																																		
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalSkillInformation
																																		:WriteOtherInformationDIP2Execution 	
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalOtherInformationConfirmationYes
																																		:UpdateCreateHeaderAppMessageDisplay
																																		:MessageSendCVCreatedNotificationtoApp
																																		:WriteCreateCVDocumentDIP2Execution 																																		
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalCreateCVDocumentYes
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																						:UpdateEmptyExecutionRepository
																																						
																																		]
																																		:WriteAgentNameinExecution
																																		:UpdateCreateNormalClosingS7DIP2Execution_Part1
																																		:UpdateCreateNormalClosingS7DIP2Execution_Part2
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																					:UpdateEmptyExecutionRepository
																																		]
																																		:WriteAgentNameinExecution
																																		:UpdateCreateClosingUponFailureFarewellUnknownDIP_Part1
																																		:UpdateCreateClosingUponFailureFarewellUnknownDIP_Part2
																																	)																														
																												]
																											)
																						]
																						:UpdateCreateHeaderKMSMessage
																						:SendDIPtoKMS
																				  )
																]																
															)
										]										
									)
				] .	


:SpecificSchoolingBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Schooling Behavior Tree: Master" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:HandleEventMasterSchoolingBT
										:UpdateBehaviorRunning									
										[
											a bt:IsSucceeding ;
											bt:hasChild 	
														:UpdateEmptyExecutionRepository
										]
										:WriteActiveDIPinExecution	
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						[
																							a bt:Priority ;
																							bt:hasChildren (
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalMasterDIP
																																		[
																																			a bt:Priority ;
																																			bt:hasChildren (
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																														:ConditionalExecuteUorMasterRecognition
																																														:WriteUMasterDegreeDocumentsDIP2Execution
																																													)																														
																																								]
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																														:ConditionalExecuteProfSkillRecognition																																		
																																														:WriteSkillAccreditationRequirementsDIP2Execution
																																													)																														
																																								]
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																														:ConditionalExecuteNonUQualificationRecognition																																		
																																														:WriteEducationDepartmentContactDIP2Execution
																																													)																														
																																								]
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																														:ConditionalAllSubTopicsInformed																																	
																																														[
																																															a bt:IsSucceeding ;
																																															bt:hasChild 	
																																																	:UpdateEmptyExecutionRepository
																																														]
																																														:WriteAgentNameinExecution
																																														:UpdateCreateNormalClosingFarewellS8DIP2Execution_Part1
																																														:UpdateCreateNormalClosingFarewellS8DIP2Execution_Part2 	
																																													)																														
																																								]
																																								[
																																									a bt:Sequence ;
																																									bt:hasChildren (
																																															[
																																																a bt:IsSucceeding ;
																																																bt:hasChild 	
																																																				:UpdateEmptyExecutionRepository
																																															]
																																															:WriteAgentNameinExecution
																																															:UpdateCreateClosingUponFailureUnknownTopicDIP2Execution_Part1
																																															:UpdateCreateClosingUponFailureUnknownTopicDIP2Execution_Part2
																																													)																														
																																								]
																																							)																														
																																		]
																																	)																														
																												]																
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalUndefinedDIP
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																						:UpdateEmptyExecutionRepository
																																		]
																																		:WriteAgentNameinExecution
																																		:UpdateCreateClosingUponFailureUndefinedSlotDIP2Execution_Part1
																																		:UpdateCreateClosingUponFailureUndefinedSlotDIP2Execution_Part2
																																	)																														
																												]
																												[
																													a bt:Sequence ;
																													bt:hasChildren (
																																		:ConditionalAnyConfirmInfoNot_UndefinedValue
																																		[
																																			a bt:IsSucceeding ;
																																			bt:hasChild 	
																																						:UpdateEmptyExecutionRepository
																																		]
																																		:WriteAgentNameinExecution
																																		:WriteCreateInformContactNGOFarewellDIP2Execution_Part1																																		
																																		:WriteCreateInformContactNGOFarewellDIP2Execution_Part2
																																		:WriteCreateInformContactNGOFarewellDIP2Execution_Part3
																																	)																														
																												]
																							)
																						]
																						:DeleteActiveDIPinAgentKB
																						:UpdateCreateHeaderKMSMessage
																						:SendDIPtoKMS
																					)																														
																]
																:EventProducerInformFirstTopic
																
															)																														
										]
										:UpdateDeleteTopicSelected
										:UpdateDeleteBehaviorRunning
					)
				] .	

:UMasterRecognitionSchoolingBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Schooling Behavior Tree: University or Master Recognition" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:EventHandlerUMasterRecognition
										:UpdateBehaviorRunning									
										[
											a bt:IsSucceeding ;
											bt:hasChild 	
														:UpdateEmptyExecutionRepository
										]
										:WriteActiveDIPinExecution								
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						:ConditionalOrientORSARUAppORDocTransOptORUMasterRecog_Yes
																						:DeleteActiveDIPinAgentKB
																						:UpdateCreateHeaderKMSMessage
																						:MessageUMasterRecognitionInformed
																					)																														
																]																
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						[
																							a bt:Priority ;
																							bt:hasChildren (
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalUMasterDegreeDocuments_Yes
																																	:WriteDocumentTranslationDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalUMasterDegreeDocuments_Not
																																	:WriteSARUAppointmentDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalDocumentTranslation_Yes
																																	:WriteUMasterRecogProcessDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalDocumentTranslation_Not
																																	:WriteDocumentTranslationOptionsDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalDocTransOptORSARUAppORUMasterRecogProc_Not
																																	:WriteInformationAndOrientationDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalInformationAndOrientation_Not
																																	[
																																		a bt:IsSucceeding ;
																																		bt:hasChild 	
																																						:UpdateEmptyExecutionRepository
																																	]
																																	:WriteAgentNameinExecution
																																	:UpdateCreateNormalClosingFarewellS8DIP2Execution_Part1
																																	:UpdateCreateNormalClosingFarewellS8DIP2Execution_Part2
																																)																														
																											]
																							)
																						]
																						:DeleteActiveDIPinAgentKB
																						:UpdateCreateHeaderKMSMessage
																						:SendDIPtoKMS
																	)																														
																]
																:EventProducerInformSecondTopic
															)																														
										]
										:UpdateDeleteBehaviorRunning
					)
				] .	

:ProfessionalSkillsRecognitionSchoolingBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Schooling Behavior Tree: Professional Skill Recognition" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:EventHandlerProfessionalSkillsRecognition
										:UpdateBehaviorRunning									
										[
											a bt:IsSucceeding ;
											bt:hasChild 	
														:UpdateEmptyExecutionRepository
										]
										:WriteActiveDIPinExecution	
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						:ConditionalOrientationORAccreditationServiceORContactAppORCVProcess_Yes
																						:DeleteActiveDIPinAgentKB
																						:UpdateCreateHeaderKMSMessage
																						:MessageProfessionalSkillRecognitionInformed
																					)																														
																]																
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						[
																							a bt:Priority ;
																							bt:hasChildren (
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalSkillAccreditationRequirements_Yes
																																	:WriteCVRequirementDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalSkillAccreditationRequirements_Not
																																	:WriteContactAppointmentDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalCVRequirement_Yes
																																	:WriteNewCVCreationDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalCVRequirement_Not
																																	:WriteCVAssistanceDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalNewCVORCVAssistance_Yes
																																	:WriteCVCreationProcessDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalNewCVORCVAssistance_Not
																																	:WriteAccreditationServiceContactDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalContactAppORCVProcess_Not
																																	:WriteInformationAndOrientationDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalOrientationORAccreditationContact_Not
																																	[
																																		a bt:IsSucceeding ;
																																		bt:hasChild 	
																																						:UpdateEmptyExecutionRepository
																																	]
																																	:WriteAgentNameinExecution
																																	:UpdateCreateNormalClosingFarewellS8DIP2Execution_Part1
																																	:UpdateCreateNormalClosingFarewellS8DIP2Execution_Part2 	
																																)																														
																											]
																											
																							)
																						]
																						:DeleteActiveDIPinAgentKB
																						:UpdateCreateHeaderKMSMessage
																						:SendDIPtoKMS
																	)																														
																]
																:EventProducerInformThirdTopic
															)																														
										]
										:UpdateDeleteBehaviorRunning
					)
				] .	

:NonUQualificationSchoolingBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Schooling Behavior Tree: Non University Qualification" ;
	bt:hasChild [
					a bt:Sequence ;
					bt:hasChildren (
										:EventHandlerNonUQualificationRecognition
										:UpdateBehaviorRunning									
										[
											a bt:IsSucceeding ;
											bt:hasChild 	
														:UpdateEmptyExecutionRepository
										]
										:WriteActiveDIPinExecution										
										[
											a bt:Priority ;
											bt:hasChildren (
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						:ConditionalEducationDepartmentContact_Yes
																						:DeleteActiveDIPinAgentKB
																						:UpdateCreateHeaderKMSMessage
																						:MessageNonUniversityQualificationInformed
																					)																														
																]																
																[
																	a bt:Sequence ;
																	bt:hasChildren (
																						[
																							a bt:Priority ;
																							bt:hasChildren (
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	:ConditionalEducationDepartmentContact_Not
																																	:WriteInformationAndOrientationDIP2Execution
																																)																														
																											]
																											[
																												a bt:Sequence ;
																												bt:hasChildren (
																																	[
																																		a bt:IsSucceeding ;
																																		bt:hasChild 	
																																					:UpdateEmptyExecutionRepository
																																	]
																																	:WriteAgentNameinExecution
																																	:UpdateCreateClosingUponFailureFarewellUnknownDIP_Part1
																																	:UpdateCreateClosingUponFailureFarewellUnknownDIP_Part2
																												)																														
																											]																											
																											
																							)
																						]
																						:DeleteActiveDIPinAgentKB
																						:UpdateCreateHeaderKMSMessage
																						:SendDIPtoKMS
																	)																														
																]
															)																														
										]
										:UpdateDeleteBehaviorRunning
					)
				] .	
				
:ExternalFAQBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "External FAQ Behavior Tree" ;
	bt:hasChild [
		a bt:Sequence ;
		bt:hasChildren (
							:EventHandlerRetrievedExternalFAQs
							[
								a bt:IsSucceeding ;
								bt:hasChild 	
										:UpdateEmptyExecutionRepository
							]
							:WriteExternalFAQNotifiationToExecution
							:UpdateDeleteExternalFAQNotificationAgentKnowledge
							#:ConditionExternalFAQ
							:UpdateCreateHeaderAppMessageFAQSuggestion
							:MessageSendFoundFAQtoApp																	
						)
				] .
				
:InternalFAQBT
	a bt:BehaviorTree ;
	a bt:Root ;
	rdfs:label "Internal FAQ Behavior Tree" ;
	bt:hasChild [
		a bt:Sequence ;
		bt:hasChildren (
							:EventHandlerRetrievedInternalFAQs
							[
								a bt:IsSucceeding ;
								bt:hasChild 	
										:UpdateEmptyExecutionRepository
							]
							:WriteInternalFAQNotifiationToExecution
							:UpdateDeleteInternalFAQNotificationAgentKnowledge
							:WriteAgentNameinExecution
							:UpdateCreateFAQDIPinExecution_Part1
							:UpdateCreateFAQDIPinExecution_Part2
							:UpdateCreateFAQDIPinExecution_Part3
							:UpdateCreateFAQDIPinExecution_Part4
							:UpdateCreateFAQDIPinExecution_Part5
							:UpdateCreateFAQDIPinExecution_Part6
							:UpdateCreateFAQDIPinExecution_Part7
							:UpdateCreateFAQDIPinExecution_Part8
							:UpdateCreateHeaderKMSMessage
							:SendDIPtoKMS							
						)
				] .
        
:AgentShutdown
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Agent Shutdown Behavior Tree" ;
  bt:hasChild [
    a bt:Sequence ;
    bt:hasChildren (
              :EventHandlerShutdown
              [
                a bt:Priority ;
                bt:hasChildren (
                          [
                            a bt:Sequence ;
                            bt:hasChildren (
                                      :ConditionAgentRunningBT
                                      :UpdateAgentRunningYes                                      
                                    )                                                           
                          ]
                          :UpdateAgentRunningNot
                        )                                                           
              ]
              :MessageSendShutdownNotification
            )
        ] .

# ------------------------------------------- 
# ----------- S4  -----------
# -------------------------------------------

:RequestInitiatorBT
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Request Initiator Behavior" ;
  bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :ProduceTestGoal
              )
        ] .

:ProduceTestGoal
  a bt:GoalProducer ;
  rdfs:label "ProduceTestGoal producer" ;
  ajan:goal agents:TestGoal ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:ExecutionKnowledge;
          bt:sparql """

            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE {
              ?s ?p ?o .
            }"""^^xsd:string ;
        ] .

:StartLccAssessmentBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Start LCC Assessment Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleStartLccAssessmentEvent
            :MessageToAppToStartLccAssessment
            :SaveLccAssessmentConfig
            :AddAttendanceLessonID
            :ClearExecutionKnowledge
            )
          ]
        ] .

:LccAssessmentCompleteBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "LCC Assessment Completed Behavior Tree" ;
  bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleLccAssessmentCompleteEvent
            :SaveLccAssessmentScores
            :ComputeLccCpl
            :WriteLccAttributesToEKB
            :WriteAgentId2Execution
            :MessageToTpToSubmitLccAssessmentInfo
            )
        ] .

:SubmitFinalLccResultBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Submit LCC Final Result Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleLccFinalResultEvent
            :SaveLccFinalResult
            :ClearExecutionKnowledge
            )
          ]
        ] .

:StartLccProcessBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "LCC Protocol Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleStartLccProcessEvent
            :EventProducerPopulateLAR
            :Wait10Sec
            :WriteAgentId2Execution
            :UpdateLccProblem
            [
              a bt:Priority ;
              bt:hasChildren (
                  [
                    a bt:Sequence ;
                    bt:hasChildren (
                        :ConditionDedicatedAgent
                        :ProduceLccDedicatedAgentBehaviorEvent
                            )
                  ]
                  [
                    a bt:Sequence ;
                    bt:hasChildren (
                        :WriteLccPersonalInfoToEKB
                        :WriteAgentAddresses2Exec
                        :Message2DedicatedLccPersonalInfo
                        :InsertLccPersonalInfo2LakrWithLccId
                            )
                  ]
                  [
                    a bt:Sequence ;
                    bt:hasChildren (
                        :ClearExecutionKnowledge
                        :JustFail
                            )
                  ]
                    )
            ]
            :WriteLccProblem2Lakr
            :ClearExecutionKnowledge
              )
          ]
        ] .

:LccDedicatedAgentBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "LCC Dedicated Agent Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
          a bt:Sequence ;
          bt:hasChildren (
              :HandleLccDedicatedAgentEvent
              [
                a bt:Priority ;
                bt:hasChildren (
                    [
                      a bt:Sequence ;
                      bt:hasChildren (
                          :WriteLccPersonalInfoToEKB
                          :InsertLccPersonalInfo2LakrWithLccId
                          :Wait4LccPersonalInfo
                          :WriteCompleteLccPersonalInfo2Exec
                          [
                            a bt:Priority ;
                            bt:hasChildren (
                                :ConditionAllReturnedLccPersonalInfo
                          #     [
                          #       a bt:Sequence ;
                          #       bt:hasChildren (
                          #           :MessageRequestLccPersonalInfo
                          #           :Wait4LccPersonalInfo
                          #           :ConditionAllReturnedLccPersonalInfo
                          #               )
                          #     ]
                                    )
                          ]
                          :ProduceComputeCoalitionsEvent
                          :ClearExecutionKnowledge
                              )
                    ]
                    :ProduceLccFailedEvent
                        )
              ]
                  )
            ]
        ] .

:ReceiveLccPersonalInfoBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Receive LCC Personal Info Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleReceiveLccPersonalInfoEvent
            :InsertLccPersonalInfoOfSender2Lakr
            :ClearExecutionKnowledge
                )
          ]
        ] .

:ComputeLccCoalitionStructuresBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Compute LCC Coalition Structures Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleComputeCoalitionsEvent
            [
              a bt:Priority ;
              bt:hasChildren (
                  [
                    a bt:Sequence ;
                    bt:hasChildren (
                        #:ComputeLccCannotLinkConnections
                        :GenerateFeasibleCoalitions4Lcc
                        :ComputeLccCoalitionInfo_addingAttendanceInfo
                        [
                          a bt:Priority ;
                          bt:hasChildren (
                            :RemoveAttendanceViolatedCoalitions
                            :SimpleSuccess
                          )
                        ]
                        :UpdateLccCoalitionInfoWrt
                      # [
                      #   a bt:Priority ;
                      #   bt:hasChildren (
                              :ConditionAnyFeasibleCoalitionExists
                      #       :ProduceFinalizeLccEvent
                      #           )
                      # ]
                        :WriteAgentAddresses2Exec
                        :BroadcastCoalitions2ReceiveUtilities
                        :WriteLccPreferencesToEKB
                        :ComputeSdOfLccCoalitions
                        :WriteEverythingToLSR
                        :ComputeUtilityValuesInLccWrite
                        :InsertLccUtilities2Lakr
                        :Wait4UtilityValues
                        :ComputeLccCoalitionValues
                        :ProduceSolveLccEvent
                        :ClearExecutionKnowledge
                            )
                  ]
                  :ProduceLccFailedEvent
                      )
            ]
                )
          ]
        ] .

:ComputeLccUtilityValuesBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Compute LCC Utility Values Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleComputeLccUtilitiesEvent
            :WriteLccPreferencesToEKB
            :WriteAgentId2Execution
            :WriteEverythingToLSR
            :ComputeUtilityValuesInLccWrite
            :WriteAgentAddresses2Exec
            :MessageLccUtilities2Dedicated
            :InsertLccUtilities2Lakr
            :ClearExecutionKnowledge
                )
          ]
        ].

:ReceiveLccUtilityValuesBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Receive LCC Utility Values BT" ;
  bt:hasChild [
#   a bt:Sequence ;
#   bt:hasChildren (
#       [
          a bt:UntilFail ;
          bt:hasChild [
              a bt:Sequence ;
              bt:hasChildren (
                :HandleReceiveLccUtilitiesEvent
            #   :ReplaceLccProcessType
            #   :WriteAllIncompleteLccProcess2Ek
            #   :RemoveUnmatchingLccProcesses
            #   :ConditionAgentInAnyMAC
            #   :RetrieveLccProcessInfoSbt
            #   :WriteLccUtilitiesOfSender2Lakr
                :InsertLccUtilitiesOfSender2Lakr
                :ClearExecutionKnowledge
                      )

                ]
#       ]
#           )
        ] .
        
:SolveLccBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Solve LCC Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleSolveLccEvent
            [
              a bt:Priority ;
              bt:hasChildren (
                  [
                    a bt:Sequence ;
                    bt:hasChildren (
                        :WriteAgentId2Execution
                        :WriteCoalitionValues2Ek
                        #:JustFail
                        :SolveLcc_BOSS
                        :NormalizeCsValues
                        :WriteAgentAddresses2Exec
                        [
                          a bt:Priority ;
                          bt:hasChildren (
                              :BroadcastLccResult
                              :SimpleSuccess
                          )
                        ]
                        :Message2TeacherLccResult
                        :ProduceFinalizeLccEvent
                        :ClearExecutionKnowledge
                            )
                  ]
                  :ProduceLccFailedEvent
                      )
            ]
              )
          ]
        ] .

:FinalizeLccProcessBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Finalize LCC Process Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
        a bt:Sequence ;
        bt:hasChildren (
            :HandleFinalizeLccEvent
            :WriteLccResult
            :ComputeLccRuntime
            :WriteAgentId2Execution
            [
              a bt:Priority ;
              bt:hasChildren (
                  :ConditionAgentInAnyCoordination
                  :Message2WPMUpdateStatus2Active
              )
            ]
                )
          ]
        ] .

:LccFailureBt
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "LCC Failure Behavior Tree" ;
  bt:hasChild [
    a bt:UntilFail ;
    bt:hasChild [
      a bt:Sequence ;
      bt:hasChildren (
            :HandleLccFailedEvent
            [
              a bt:Priority ;
              bt:hasChildren (
                  :Message2TeacherLccFailed
                  :SimpleSuccess
              )
            ]
            [
              a bt:Priority ;
              bt:hasChildren (
                  :BroadcastLccFailed
                  :SimpleSuccess
              )
            ]
            :ProduceFinalizeLccEvent
              )
          ]
        ] .

#---------------MAJAN BT Nodes---------------
#------------TEST BTs----------------------
:TestQueueBT
  a bt:BehaviorTree ;
  a bt:Root ;
  rdfs:label "Test Queue Event Behavior Tree" ;
  bt:hasChild [
          a bt:Sequence ;
          bt:hasChildren (
                :TestUntilFail
                  )
        ] .

:TestUntilFail
  a bt:UntilFail ;
  rdfs:label "test until fail"^^xsd:string ;
  bt:hasChild [
          a bt:Sequence ;
          bt:hasChildren (
                :HandleTestQueueEvent
                :WriteTest
                #:Wait4LAR
                :WriteTest
                :WriteTest
                :WriteTest
                :WriteTest
                :WriteTest
                  )
        ] .
        
# ------------------------------------------- 
# ----------- Standard Primitives -----------
# ------------------------------------------- 

#=============================================================================================
# InitialBT

:UpdateBehaviorRunning
  a bt:Update ;
  rdfs:label "Update: Write agentRunning Flag in the LAKR" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>                 
          INSERT {
            ?agent welcome:hasBTRunning "true"^^xsd:boolean .
          }
           WHERE {
            ?agent rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .

:UpdateDeleteBehaviorRunning
  a bt:Update ;
  rdfs:label "Update: Delete agentRunning Flag in the LAKR" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>                 
          DELETE {
            ?agent welcome:hasBTRunning ?val .
          }
           WHERE {
            ?agent rdf:type ajan:Agent .
            ?agent welcome:hasBTRunning ?val .
          }"""^^xsd:string ;
    ]) .
    
:ConditionLARPopulated
  a bt:Condition ;
  rdfs:label "Condition: LAR initialized?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:LocalAgentsKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          ASK
          WHERE {
            ?agent rdf:type ajan:Agent .
            ?agent ?p ?o .  
          }"""^^xsd:string ;
    ]) .

:EventProducerPopulateLAR
  a bt:EventProducer ;
  rdfs:label "EventProducer: Request Populate LAR" ;
  ajan:event agents:PopulateLAREvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:needsPopulateLAR "localRepo" .
            }
            WHERE {
              ?s rdf:type ajan:Agent .
            }"""^^xsd:string ;
        ] . 

:ConditionLSRPopulated
  a bt:Condition ;
  rdfs:label "Condition: LSR initialized?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
          ASK
          WHERE {
            ?service rdf:type service:Service.  
          }"""^^xsd:string ;
    ]) .
    
:EventProducerPopulateLSR
  a bt:EventProducer ;
  rdfs:label "EventProducer: Request Populate LSR" ;
  ajan:event agents:PopulateLSREvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:needsPopulateLSR "localRepo" .
              <http://mycontext> <http://www.ajan.de/behavior/bt-ns#rdfContext> <http://localhost:8090/rdf4j/repositories/agents#PopulateLSREvent> .
            }
            WHERE {
              ?s rdf:type ajan:Agent .
            }"""^^xsd:string ;
        ] . 

#=============================================================================================
# FinalBT

:DeleteTemporalFlagsinLAKR
  a bt:Update ;
  rdfs:label "Update: Delete Flags in LAKR" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          DELETE {
            ?MatchmakerOffer welcome:hasPrecondition ?precondition .
            ?MatchmakerResult ssc:hasServiceName ?servName .  
            ?agent welcome:hasBTRunning ?val .
            ?query welcome:hasPreconditionResult ?preconVal .
            welcome:myWelcomeAgent welcome:hasFirstMove ?result .
            ?bt welcome:hasActiveDIP ?id .  
            ?dip welcome:hasNamedGraph ?dipGraph .
          }
           WHERE {
            ?s ?o ?p .
            OPTIONAL {
              {?MatchmakerOffer welcome:hasPrecondition ?precondition .}
              UNION
              {?MatchmakerResult ssc:hasServiceName ?servName .}  
              UNION
              {?agent welcome:hasBTRunning ?val .}
              UNION
              {?query welcome:hasPreconditionResult ?preconVal .}
              UNION
              {welcome:myWelcomeAgent welcome:hasFirstMove ?result .}
              UNION
              {?bt welcome:hasActiveDIP ?id .}
              UNION
              {?dip welcome:hasNamedGraph ?dipGraph .}
            }
          }         
          """^^xsd:string ;
    ]) .
    
:DeleteTemporalFlagsinLSR
  a bt:Update ;
  rdfs:label "Update: Delete Flags in LSR" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          DELETE {
            ?ssc ssc:hasResultOffer ?MatchmakerOffer .  
          }
          WHERE {
            ?s ?o ?p .
            OPTIONAL {
              ?ssc ssc:hasResultOffer ?MatchmakerOffer .  
            }
          }         
          """^^xsd:string ;
    ]) .

#=============================================================================================
# HeartbeatMonitoringBT

:AgentMonitoringHandleEvent
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Heartbeat Monitoring" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#AgentMonitoringEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:ExecutionKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>  
            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE { 
              ?s ?p ?o .        
            }"""^^xsd:string ;
        ] .
  
#=============================================================================================
#ErrorHandlingBT  

:ReceiveErrorHandleEvent
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Error Handling" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#ErrorHandlingEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>	
						PREFIX wex: <http://welcome.org/integration/pipeline/exception#>
						CONSTRUCT {
							?error rdf:type wex:WelcomePipelineException .
							?error ?propError ?objError .
						}
						WHERE { 
							?error rdf:type wex:WelcomePipelineException .
							?error ?propError ?objError .
						}"""^^xsd:string ;
				] .

:ConditionKMSError
	a bt:Condition ;
	rdfs:label "Condition: Error in KMS?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX wex: <http://welcome.org/integration/pipeline/exception#>
					ASK
					WHERE {
						?error rdf:type wex:WelcomePipelineException .
						?error wex:hasCode ?errorCode .
						FILTER (CONTAINS(str(?errorCode), "KMS"))						
					}"""^^xsd:string ;
		]) .

:UpdateCreateClosingUponFailureFarewellKMSError_Part1
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure DIP - KMS Error - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					PREFIX wex: <http://welcome.org/integration/pipeline/exception#>
					INSERT {
						welcome:ClosingUponFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ClosingUponFailureFarewell welcome:hasDIPStatus welcome:Incomplete .
						welcome:ClosingUponFailureFarewell welcome:isCurrentDIP "true"^^xsd:boolean .
						welcome:ClosingUponFailureFarewell welcome:hasSlot welcome:informMessage .
						welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informMessage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string . 
						welcome:informMessage welcome:hasInputRDFContents welcome:reifiedReasonTError40_4 .
						welcome:informMessage welcome:dependsOn welcome:Unknown .
						welcome:informMessage welcome:associatedWith welcome:Unknown .
						welcome:informMessage welcome:hasStatus welcome:Pending .
						welcome:informMessage welcome:hasNumberAttempts 0 .
						welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informMessage welcome:isOptional "false"^^xsd:boolean .				
						welcome:reifiedReasonTError40_4 rdf:type rdf:Statement .
						welcome:reifiedReasonTError40_4 rdf:subject welcome:subTemplate .
						welcome:reifiedReasonTError40_4 rdf:predicate welcome:isReason .
						welcome:reifiedReasonTError40_4 rdf:object "TError40_4"^^xsd:string .
					} WHERE { 
						?error rdf:type wex:WelcomePipelineException .
					}"""^^xsd:string ;
		]) .

:UpdateCreateClosingUponFailureFarewellKMSError_Part2
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure DIP - KMS Error - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					PREFIX wex: <http://welcome.org/integration/pipeline/exception#>
					INSERT {
						welcome:ClosingUponFailureFarewell welcome:hasSlot welcome:informClosingFailureFarewell .
						welcome:informClosingFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informClosingFailureFarewell welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informClosingFailureFarewell welcome:hasTemplateId "TInformClosingFailureFarewell"^^xsd:string . 
						welcome:informClosingFailureFarewell welcome:hasInputRDFContents welcome:Unknown .
						welcome:informClosingFailureFarewell welcome:hasStatus welcome:Pending .
						welcome:informClosingFailureFarewell welcome:hasNumberAttempts 0 .
						welcome:informClosingFailureFarewell welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informClosingFailureFarewell welcome:isOptional "false"^^xsd:boolean .
						welcome:informClosingFailureFarewell welcome:dependsOn welcome:Unknown .
						welcome:informClosingFailureFarewell welcome:associatedWith welcome:Unknown .
					} WHERE { 
						?error rdf:type wex:WelcomePipelineException .
					}"""^^xsd:string ;
		]) .
																						
:UpdateEmptyExecutionRepository
	a bt:Update ;
	rdfs:label "Update: Empty Execution Repository" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE{
						?s ?p ?o .
					}
					WHERE { 
						?s ?p ?o .
					}
					"""^^xsd:string ;
		]) .
#=============================================================================================
# PopulateReposBT
                                
:EventHandlerRequestLSRTriples
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Request Populate LSR" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#PopulateLSREvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:needsPopulateLSR "localRepo" .
            }
            WHERE { 
              welcome:myWelcomeAgent welcome:needsPopulateLSR "localRepo" .       
            }"""^^xsd:string ;
        ] .

:UpdateCreateHeaderDispatcherMessage
  a bt:Update ;
  rdfs:label "Update: Header Message for Dispatcher" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          DELETE{
            welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
            welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
            welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
            welcome:headerUserID welcome:hasHeaderValue ?id .
          }
          INSERT {
            welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
            welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
            welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
            welcome:headerUserID welcome:hasHeaderValue ?id .           
          } 
          WHERE { 
            ?msg welcome:hasCorrelationID ?correlationID .
            ?du rdf:type welcome:DialogueUser .
            ?du welcome:hasUserId ?idObject .
            ?idObject welcome:hasValue ?id .
          }
          """^^xsd:string ;
    ]) .
    
:MessageSendLSRMessageWPM
  a <http://www.ajan.de/myWelcome-ns#Message> ;
  rdfs:label "Message: Request KBS populate LSR" ;
  rdfs:comment "Message: Request KBS populate LSR" ;
  bt:targetBase ajan:ExecutionKnowledge ;  
  <http://www.ajan.de/myWelcome-ns#correlatorId> [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?hdrName ?fieldValue
        WHERE {
            ?headerName welcome:hasHeaderName ?hdrName .
            ?headerName welcome:hasHeaderValue ?fieldValue .
        }"""^^xsd:string
    ] ; 
    http-core:headers ([
          a http-core:Header ;            
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "application/trig"
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;     
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>  
            CONSTRUCT {         
              ?agent rdf:type ajan:Agent .
            }
            WHERE {
              ?agent rdf:type ajan:Agent .          
            }"""^^xsd:string
      ]
    ] ;    
  ] ;
  bt:queryUri [
  a bt:SelectQuery ;
  a bt:QueryUri ;
  bt:originBase ajan:AgentKnowledge ;
  bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT ?requestURI 
        WHERE
        {
          welcome:dispatcher welcome:hasAddress ?partialAddress .
          BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/globalRepository?repository=wsr") AS ?requestURI )
        }"""^^xsd:string
  ] . 
# bt:queryUri [
# a bt:SelectQuery ;
# a bt:QueryUri ;
# bt:originBase ajan:AgentKnowledge ;  
# bt:sparql """
#       PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#       PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#       SELECT ?requestURI 
#       WHERE
#       {
#         welcome:dispatcher welcome:hasAddress ?partialAddress .
#         BIND(CONCAT(STR(?partialAddress), "/kms/receiveDIP") AS ?requestURI )
#       }"""^^xsd:string
# ] .

:DefaultFailed
  a bt:Fail ;
  rdfs:label "Default Fail - Successful Request to KBS"^^xsd:string .
  
:EventHandlerRequestLARTriples
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Request Populate LAR" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#PopulateLAREvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """           
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:needsPopulateLAR "localRepo" .
            }
            WHERE { 
              welcome:myWelcomeAgent welcome:needsPopulateLAR "localRepo" .
            }"""^^xsd:string ;
        ] .

:MessageSendLARMessageWPM
  a <http://www.ajan.de/myWelcome-ns#Message> ;
  rdfs:label "Message: Request KBS populate LAR" ;
  rdfs:comment "Message: Request KBS populate LAR" ;
  bt:targetBase ajan:ExecutionKnowledge ;  
  <http://www.ajan.de/myWelcome-ns#correlatorId> [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?hdrName ?fieldValue
        WHERE {
            ?headerName welcome:hasHeaderName ?hdrName .
            ?headerName welcome:hasHeaderValue ?fieldValue .
        }"""^^xsd:string
    ] ; 
    http-core:headers ([
          a http-core:Header ;            
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;     
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>  
            CONSTRUCT {         
              ?agent rdf:type ajan:Agent .
            }
            WHERE {
              ?agent rdf:type ajan:Agent .          
            }"""^^xsd:string
      ]
    ] ;    
  ] ;
  bt:queryUri [
  a bt:SelectQuery ;
  a bt:QueryUri ;
  bt:originBase ajan:AgentKnowledge ;
  bt:sparql """
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT ?requestURI 
        WHERE
        {
          welcome:dispatcher welcome:hasAddress ?partialAddress .
            BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/globalRepository?repository=war") AS ?requestURI )
        }"""^^xsd:string
  ] . 
# bt:queryUri [
# a bt:SelectQuery ;
# a bt:QueryUri ;
# bt:originBase ajan:AgentKnowledge ;  
# bt:sparql """
#       PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#       PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#       SELECT ?requestURI 
#       WHERE
#       {
#         welcome:dispatcher welcome:hasAddress ?partialAddress .
#         BIND(CONCAT(STR(?partialAddress), "/kms/receiveDIP") AS ?requestURI )
#       }"""^^xsd:string
# ] .

:EventHandlerReceiveLocalServices
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Receive Local Services" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#ReceiveLocalServicesEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:ExecutionKnowledge ;
          bt:sparql """"""^^xsd:string ;
        ] .

#:ConditionNoAgentPopulation
# a bt:Condition ;
# rdfs:label "Condition: Agent Population?" ;
# bt:query ( [
#   a bt:AskQuery ;
#   bt:originBase ajan:ExecutionKnowledge ;
#   bt:sparql """
#         PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
#         PREFIX ajan: <http://www.ajan.de/ajan-ns#>
#         PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#         PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
#         ASK
#         WHERE {
#           ?agentName rdf:type ajan:Agent .
#         }"""^^xsd:string ;
#   ]) .
    
:RemoveLSRContent
  a bt:Update ;
  rdfs:label "Update: Remove LSR Content" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          DELETE {
            ?s ?o ?p .
          }
           WHERE {
            ?s ?o ?p .
          }         
          """^^xsd:string ;
    ]) .

:UpdateLSRAgentKnowledge
  a bt:Update ;
  rdfs:label "Delete LSR Agent Knowledge" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        DELETE {
          ?agent welcome:knowsLocalServices ajan:LocalServicesKnowledge . 
        }
        INSERT {
          ?agent welcome:needsPopulateLSR "localRepo" .
        }
        WHERE {
          ?agent rdf:type ajan:Agent .
        }   """^^xsd:string ;
    ]) .
    
#:WriteTriplesLSR
# a bt:Write ;
# rdfs:label "Write Triples in LSR" ;
# bt:query [
#   a bt:ConstructQuery ;
#   bt:originBase ajan:ExecutionKnowledge ;
#   bt:targetBase ajan:LocalServicesKnowledge ;
#   bt:sparql """
#     PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
#     PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
#     PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
#     PREFIX owl: <http://www.w3.org/2002/07/owl#>
#     PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
#     CONSTRUCT  {
#       ?s ?o ?p .
#     }
#     WHERE { 
#       SELECT DISTINCT ?s ?o ?p 
#       WHERE {
#       ?s ?o ?p .
#       ?a rdf:type service:Service .
#       }
#     } """^^xsd:string ;
# ] .

:PluginOWL2PDDL
  a ssc:PDDLConverter ;
  rdfs:label "Plugin: Create PDDL Domain File" ;
  ssc:LocalServicesTriples [
        a bt:SelectQuery ;
        bt:originBase ajan:LocalServicesKnowledge ;
        bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
        SELECT ?s ?o ?p ?g
        WHERE {
          { GRAPH ?g { ?s ?o ?p } }
        }"""^^xsd:string ;
      ] . 

:UpdateAgentKnowsLSR
  a bt:Update ;
  rdfs:label "Update: Agent Knows LSR" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>          
          DELETE {
            welcome:myWelcomeAgent welcome:needsPopulateLSR "localRepo" .
          }
          INSERT {
            ?agent welcome:knowsLocalServices ajan:LocalServicesKnowledge . 
          }
          WHERE {
            ?agent rdf:type ajan:Agent .
          }         
          """^^xsd:string ;
    ]) .

:WriteTriplesLSRC1
  a bt:Write ;
  rdfs:label "Write Triples in LSR for C1" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:LocalServicesKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
      PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
                    CONSTRUCT {
                        ?s ?p ?o .
            <http://mycontext1> <http://www.ajan.de/behavior/bt-ns#rdfContext> <file://C:/fakepath/FirstReceptionService.owl> .
                    }

                        WHERE { GRAPH <file://C:/fakepath/FirstReceptionService.owl> {?s ?p ?o .} } """^^xsd:string ;
  ] .

:WriteTriplesLSRC2
  a bt:Write ;
  rdfs:label "Write Triples in LSR for C2" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:LocalServicesKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
      PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
                    CONSTRUCT {
                        ?s ?p ?o .
            <http://mycontext2> <http://www.ajan.de/behavior/bt-ns#rdfContext> <file://C:/fakepath/RegistrationService.owl> .
                    }

                        WHERE { GRAPH <file://C:/fakepath/RegistrationService.owl> {?s ?p ?o .} } """^^xsd:string ;
  ] .
  
:WriteTriplesLSRC3
  a bt:Write ;
  rdfs:label "Write Triples in LSR for C3 - CreateCV" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:LocalServicesKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
      PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
                    CONSTRUCT {
                        ?s ?p ?o .
            <http://mycontext3> <http://www.ajan.de/behavior/bt-ns#rdfContext> <file://C:/fakepath/CreateCV.owl> .
                    }

                        WHERE { GRAPH <file://C:/fakepath/CreateCV.owl> {?s ?p ?o .} } """^^xsd:string ;
  ] .

:WriteTriplesLSRC4
	a bt:Write ;
	rdfs:label "Write Triples in LSR for C4 - Schooling" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:targetBase ajan:LocalServicesKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			PREFIX owl: <http://www.w3.org/2002/07/owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
            CONSTRUCT {
                        ?s ?p ?o .
            <http://mycontext4> <http://www.ajan.de/behavior/bt-ns#rdfContext> <file://C:/fakepath/SchoolingDIFE.owl> .
            }
			WHERE { GRAPH <file://C:/fakepath/SchoolingDIFE.owl> {?s ?p ?o .} } """^^xsd:string ;
	] .
  
:UpdateLSRExecutionKnowledge
  a bt:Update ;
  rdfs:label "Update: LSR in Execution Knowledge" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>  
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
      PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
      PREFIX owl: <http://www.w3.org/2002/07/owl#>
      PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
      DELETE {
        ?s ?p ?o .
      }WHERE {
        ?s ?p ?o .
      }"""^^xsd:string ;
    ]) .
    
:EventHandlerReceiveLocalAgents
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Receive Local Agents" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#ReceiveLocalAgentsEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:ExecutionKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>  
            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE {
              ?s ?p ?o .
            }"""^^xsd:string ;
        ] .
        
:RemoveLARContent
  a bt:Update ;
  rdfs:label "Update: Remove LAR Content" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:LocalAgentsKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          DELETE {
            ?s ?o ?p .
          }
          WHERE {
            ?s ?o ?p .
          }         
          """^^xsd:string ;
    ]) .

:UpdateLARAgentKnowledge
  a bt:Update ;
  rdfs:label "Delete LAR Agent Knowledge" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        DELETE {
          ?agent welcome:knowsLocalAgents ?repoName . 
        }
        INSERT {
          ?agent welcome:needsPopulateLAR "localRepo" .
        }       
        WHERE {
          ?agent rdf:type ajan:Agent .
        }"""^^xsd:string ;
    ]) .

:WriteTriplesLAR
  a bt:Write ;
  rdfs:label "Write Triples in LAR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:LocalAgentsKnowledge ;
    bt:sparql """
      PREFIX ajan: <http://www.ajan.de/ajan-ns#>
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      CONSTRUCT { 
        ?s ?p ?o .
        ?s rdf:type ajan:Agent .
      } WHERE  {
        ?s ?p ?o .
        ?s rdf:type ajan:Agent .
      }"""^^xsd:string ;
  ] .
  
:UpdateAgentKnowsLAR
  a bt:Update ;
  rdfs:label "Update: Agent Knows LAR" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>          
          DELETE {
            welcome:myWelcomeAgent welcome:needsPopulateLAR "localRepo" .
          }
          INSERT {
            ?agent welcome:knowsLocalAgents ajan:LocalAgentsKnowledge . 
          }
           WHERE {
            ?agent rdf:type ajan:Agent .
          }         
          """^^xsd:string ;
    ]) .
    
:UpdateLARExecutionKnowledge
  a bt:Update ;
  rdfs:label "Update: LAR in Execution Knowledge" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>  
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>           
          DELETE {
            ?s ?p ?o .
            ?s rdf:type ajan:Agent.
          } WHERE {             
            ?s ?p ?o .
            ?s rdf:type ajan:Agent .
            
          }"""^^xsd:string ;
    ]) .
    
#=============================================================================================
# HandshakeBT

:EventHandlerHandshake
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Handshake" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#ReceiveHandshakeEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>            
            CONSTRUCT {
              ?sub rdf:type welcome:Handshaking .
            }
            WHERE { 
              ?sub rdf:type welcome:Handshaking .
              ?s ?p ?o .
            } """^^xsd:string ;
        ] .

:UpdateCreateHeaderAppMessage
	a bt:Update ;
	rdfs:label "Update: Header Message for App" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE{
						?headerSubject welcome:hasHeaderValue ?typeval .
						?headerValSubject welcome:hasHeaderValue ?typeHeaderval .
					}
					INSERT {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?id .					
						welcome:headerMsgType welcome:hasHeaderName "X-Msg-Type" .
						welcome:headerMsgType welcome:hasHeaderValue "DisplayUI " .
					} 
					WHERE { 
						?du rdf:type welcome:DialogueUser .
						?msg welcome:hasCorrelationID ?correlationID .
						?du welcome:hasUserId ?idObject .
						?idObject welcome:hasValue ?id .
						OPTIONAL {?headerSubject welcome:hasHeaderValue ?typeval .}
						OPTIONAL {?headerValSubject welcome:hasHeaderValue ?typeHeaderval .}
					}
					"""^^xsd:string ;
		]) .
    
:MessageSendAgentReadiness
  a myWelcome:Message ;
  rdfs:label "Message: Send Agent Readiness to App - Handshake"^^xsd:string ;
  rdfs:comment "Message: Send Agent Readiness to App - Handshake"^^xsd:string ;
  bt:targetBase ajan:AgentKnowledge ;  
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?hdrName ?fieldValue
        WHERE {
            ?headerName welcome:hasHeaderName ?hdrName .
            ?headerName welcome:hasHeaderValue ?fieldValue .          
        }"""^^xsd:string
    ] ; 
    http-core:headers ([
          a http-core:Header ;            
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "application/ld+json"
        ]
    ) ;     
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>    
            CONSTRUCT {
              ?agent welcome:hasMessage "is ready" .
            }
            WHERE {
              ?agent rdf:type ajan:Agent .
            }"""^^xsd:string
      ]
    ] ;    
  ] ;
  bt:queryUri [
  a bt:SelectQuery ;
  a bt:QueryUri ;
  bt:originBase ajan:AgentKnowledge ;
  bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT ?requestURI 
        WHERE
        {
          welcome:dispatcher welcome:hasAddress ?partialAddress .
          BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
        }"""^^xsd:string
  ] . 
# bt:queryUri [
# a bt:SelectQuery ;
# a bt:QueryUri ;
# bt:originBase ajan:AgentKnowledge ;  
# bt:sparql """
#       PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#       PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#       SELECT ?requestURI 
#       WHERE
#       {
#         welcome:dispatcher welcome:hasAddress ?partialAddress .
#         BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#       }"""^^xsd:string
# ] .

#:DeleteHeaderDispatcherMessageinLAKR
# a bt:Update ;
#  rdfs:label "Update: Delete Header Readiness Message in LAKR" ;
#  bt:query ([
#    a bt:UpdateQuery ;
#    bt:originBase ajan:AgentKnowledge ;
#    bt:sparql """
#          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
#          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#          DELETE {
#            welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
#           welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
#            welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
#            welcome:headerUserID welcome:hasHeaderValue ?userID .           
#          } 
#          WHERE { 
#            welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
#           welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
#            welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
#            welcome:headerUserID welcome:hasHeaderValue ?userID .
#          }
#          """^^xsd:string ;
#    ]) .
#=============================================================================================
# ProcessSpeechActsBehavior

:EventSpeaktoavatar
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Speak to Avatar" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#SpeakAvatarEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:ExecutionKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>            
            CONSTRUCT {               
              welcome:TCN_SpeakToAvatar rdf:type welcome:speakToAvatar .
            }
            WHERE { 
              welcome:TCN_SpeakToAvatar rdf:type welcome:speakToAvatar .
            }"""^^xsd:string ;
        ] .

:WriteAgentNameinExecution
  a bt:Write ;
  rdfs:label "Write: Agent Name in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>  
      PREFIX ajan: <http://www.ajan.de/ajan-ns#>
      CONSTRUCT  {
        ?agentName rdf:type ajan:Agent .
      }
      WHERE { 
        ?agentName rdf:type ajan:Agent .
      } """^^xsd:string ;
  ] .
  
:UpdateCreateOpeningDIPPart1
  a bt:Update ;
  rdfs:label "Update: Create Opening DIP 1" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>           
          INSERT {
            welcome:Opening rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .  
            welcome:Opening welcome:hasDIPStatus welcome:Unknown .
            welcome:Opening welcome:isCurrentDIP "true"^^xsd:boolean . 
            welcome:Opening welcome:hasSlot welcome:confirmCommunication .
            welcome:confirmCommunication rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
            welcome:confirmCommunication welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
            welcome:confirmCommunication welcome:hasTemplateId "TConfirmCommunication"^^xsd:string .
            welcome:confirmCommunication welcome:hasInputRDFContents welcome:Unknown .
            welcome:confirmCommunication welcome:hasTCNAnswer welcome:Unknown .
            welcome:confirmCommunication welcome:hasStatus welcome:Pending .
            welcome:confirmCommunication welcome:hasNumberAttempts 0 .
            welcome:confirmCommunication welcome:confidenceScore "0.0"^^xsd:float .
            welcome:confirmCommunication welcome:isOptional "false"^^xsd:boolean .
            welcome:confirmCommunication welcome:dependsOn welcome:Unknown .
            welcome:confirmCommunication welcome:associatedWith welcome:Unknown .
          } 
          WHERE { 
            ?agentName rdf:type ajan:Agent .
          }
          """^^xsd:string ;
    ]) .

:UpdateCreateOpeningDIPPart2
  a bt:Update ;
  rdfs:label "Update: Create Opening DIP Part 2" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          INSERT {
            welcome:Opening welcome:hasSlot welcome:confirmLanguage .
            welcome:confirmLanguage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
            welcome:confirmLanguage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Language"^^xsd:anyURI .
            welcome:confirmLanguage welcome:hasTemplateId "TConfirmLanguage"^^xsd:string .
            welcome:confirmLanguage welcome:hasInputRDFContents welcome:Unknown .
            welcome:confirmLanguage welcome:hasTCNAnswer welcome:Unknown .
            welcome:confirmLanguage welcome:hasStatus welcome:Pending .
            welcome:confirmLanguage welcome:hasNumberAttempts 0 .
            welcome:confirmLanguage welcome:confidenceScore "0.0"^^xsd:float .
            welcome:confirmLanguage welcome:isOptional "false"^^xsd:boolean .           
            welcome:confirmLanguage welcome:dependsOn welcome:Unknown .
            welcome:confirmLanguage welcome:associatedWith welcome:Unknown .
          } 
          WHERE { 
            ?agentName rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .

:UpdateCreateOpeningDIPPart3
  a bt:Update ;
  rdfs:label "Update: Create Opening DIP Part 3" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          INSERT {
            welcome:Opening welcome:hasSlot welcome:obtainRequest .
            welcome:obtainRequest rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
            welcome:obtainRequest welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#ServiceRequest"^^xsd:anyURI .
            welcome:obtainRequest welcome:hasTemplateId "TObtainMatterConcern"^^xsd:string .
            welcome:obtainRequest welcome:hasStatus welcome:Completed .
            welcome:obtainRequest welcome:hasNumberAttempts 0 .
            welcome:obtainRequest welcome:confidenceScore "0.0"^^xsd:float .  
            welcome:obtainRequest welcome:hasInputRDFContents welcome:Unknown .
            welcome:obtainRequest welcome:hasTCNAnswer welcome:Unknown .
            welcome:obtainRequest welcome:isOptional "false"^^xsd:boolean . 
            welcome:obtainRequest welcome:dependsOn welcome:Unknown .
            welcome:obtainRequest welcome:associatedWith welcome:Unknown .
          } 
          WHERE { 
            ?agentName rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .

:UpdateCreateHeaderKMSMessage
  a bt:Update ;
  rdfs:label "Update: Header KMS Message" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          DELETE {
            ?headerName welcome:hasHeaderName ?hdrName .
            ?headerName welcome:hasHeaderValue ?fieldValue .            
          } 
          INSERT {
            welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
            welcome:headerCorrelation welcome:hasHeaderValue ?correlationID . 
          } 
          WHERE {             
            ?msg welcome:hasCorrelationID ?correlationID .
            OPTIONAL {?headerName welcome:hasHeaderName ?hdrName . }
            OPTIONAL {?headerName welcome:hasHeaderValue ?fieldValue . }          
          }
          """^^xsd:string ;
    ]) .
    
:SendDIPtoKMS
  a myWelcome:Message ;
  rdfs:label "Message: Send DIP to KMS"^^xsd:string ;
  rdfs:comment "Message: Send DIP to KMS"^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;  
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?hdrName ?fieldValue
        WHERE {
            ?headerName welcome:hasHeaderName ?hdrName .
            ?headerName welcome:hasHeaderValue ?fieldValue .          
        }"""^^xsd:string
    ] ; 
    http-core:headers ([
          a http-core:Header ;            
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle;charset=UTF-8" 
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/plain"
        ]
    ) ; 
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            PREFIX welcomeService: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
            CONSTRUCT {
              ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI . 
              ?dip welcome:hasDIPStatus ?status .
              ?dip welcome:isCurrentDIP ?isCurrentValue .
              ?dip welcome:belongsTo ?someService . 
              ?dip welcome:hasSlot ?slotDIP .
              ?slotDIP rdf:type ?slotType .
              ?slotDIP welcome:hasOntologyType ?slotOntoType .
              ?slotDIP welcome:hasInputRDFContents ?slotRDFContents .
              ?slotRDFContents ?reifiRDFContentsPred ?reifiRDFContentsObj .
              ?slotDIP welcome:hasStatus ?slotStatus .
              ?slotDIP welcome:hasNumberAttempts ?NbAttempts .
              ?slotDIP welcome:confidenceScore ?confScore .
              ?slotDIP welcome:isOptional ?opt .
              ?slotDIP welcome:dependsOn ?dependency .
              ?slotDIP welcome:associatedWith ?association .
              ?slotDIP welcome:hasTemplateId ?templateID .
              ?slotDIP welcome:hasTCNAnswer welcome:Unknown .
            }
            WHERE {
              ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI . 
              ?dip welcome:hasDIPStatus ?status .
              ?dip welcome:isCurrentDIP ?isCurrentValue .
              OPTIONAL { ?dip welcome:belongsTo ?someService . }
              ?dip welcome:hasSlot ?slotDIP .
              ?slotDIP rdf:type ?slotType .
              ?slotDIP welcome:hasOntologyType ?slotOntoType .
              ?slotDIP welcome:hasInputRDFContents ?slotRDFContents .
              OPTIONAL { ?slotRDFContents ?reifiRDFContentsPred ?reifiRDFContentsObj .}
              ?slotDIP welcome:hasStatus ?slotStatus .
              ?slotDIP welcome:hasNumberAttempts ?NbAttempts .
              ?slotDIP welcome:confidenceScore ?confScore .
              ?slotDIP welcome:isOptional ?opt .
              OPTIONAL { ?slotDIP welcome:hasTemplateId ?templateID . }
              OPTIONAL {?slotDIP welcome:hasTCNAnswer ?tcnAnswer .}
              OPTIONAL {?slotDIP welcome:dependsOn ?dependency .}
                OPTIONAL {?slotDIP welcome:associatedWith ?association .}
            }"""^^xsd:string
      ]
    ] ;    
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          SELECT ?requestURI
          WHERE {
            welcome:KMS welcome:hasURI ?requestURI .
          }"""^^xsd:string
  ] .
# bt:queryUri [
# a bt:SelectQuery ;
# a bt:QueryUri ;
# bt:originBase ajan:AgentKnowledge ;  
# bt:sparql """
#       PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#       PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#       SELECT ?requestURI 
#       WHERE
#       {
#         welcome:dispatcher welcome:hasAddress ?partialAddress .
#         BIND(CONCAT(STR(?partialAddress), "/kms/receiveDIP") AS ?requestURI )
#       }"""^^xsd:string
# ] .

#:UpdateExecutionDeleteDIP
# a bt:Update ;
#  rdfs:label "Update: Delete DIP from Execution" ;
#  bt:query ( [
#    a bt:UpdateQuery ;
#    bt:originBase ajan:ExecutionKnowledge ;
#    bt:sparql """
#          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
#          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#          PREFIX welcomeService: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
#          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>               
#          DELETE {
#            ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
#            ?dip welcome:hasDIPStatus ?status .
#            ?dip welcome:isCurrentDIP "true"^^xsd:boolean .
#            ?dip welcome:hasSlot ?slots .
#            ?slots rdf:type ?slotType .
#            ?slots welcome:hasOntologyType ?ontoType .
#            ?slots welcome:hasInputRDFContents ?RDFContents .
#            ?slots welcome:hasTCNAnswer ?tcnAnswer .            
#            ?slots welcome:hasStatus ?slotsStatus .   
#            ?slots welcome:hasNumberAttempts ?NbAttempts .
#            ?slots welcome:confidenceScore ?confScore .
#            ?slots welcome:isOptional ?optional . 
#            ?slots welcome:hasTemplateId ?templateID .
#            ?slots welcome:dependsOn ?dependency .
#            ?slots welcome:associatedWith ?association .            
#          } WHERE { 
#            ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
#           ?dip welcome:hasDIPStatus ?status .
#            ?dip welcome:isCurrentDIP "true"^^xsd:boolean .
#            ?dip welcome:hasSlot ?slots .
#            ?slots rdf:type ?slotType .
#            ?slots welcome:hasOntologyType ?ontoType .
#            ?slots welcome:hasInputRDFContents ?RDFContents . 
#            ?slots welcome:hasStatus ?slotsStatus .   
#            ?slots welcome:hasNumberAttempts ?NbAttempts .
#            ?slots welcome:confidenceScore ?confScore .
#            ?slots welcome:isOptional ?optional . 
#            OPTIONAL {?slots welcome:hasTemplateId ?templateID .}
#           OPTIONAL {?slots welcome:hasTCNAnswer ?tcnAnswer .}
#            OPTIONAL {?slots welcome:dependsOn ?dependency .}
#            OPTIONAL {?slots welcome:associatedWith ?association .}
#          }"""^^xsd:string ;
#    ]) .

:EventDIP_OR_ServiceRequest
  a bt:HandleEvent ;
  rdfs:label "EventHandler: DIP OR Service Request" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#EventDIPORServiceRequest> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>            
            CONSTRUCT {               
              ?dip welcome:hasNamedGraph ?dipGraph .
              welcome:BT welcome:hasActiveDIP ?dipId .          
            }
            WHERE { 
                ?dip welcome:hasNamedGraph ?dipGraph .
                ?dip welcome:DIPId ?dipId .
            }"""^^xsd:string ;
        ] .

:WriteActiveDIPinExecution
  a bt:Write ;
  rdfs:label "Write: Active DIP in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
      CONSTRUCT  {
        ?bt welcome:hasActiveDIP ?dipId . 
        ?dip welcome:hasNamedGraph ?dipGraph .
        ?s ?p ?o .
      }
      WHERE { 
        ?bt welcome:hasActiveDIP ?dipId . 
        ?dip welcome:hasNamedGraph ?dipGraph .
        { GRAPH ?dipGraph {?s ?p ?o . }}
      } """^^xsd:string ;
  ] .

:ConditionDIPIncomplete
  a bt:Condition ;
  rdfs:label "Condition: DIP Incomplete?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
          PREFIX fn: <http://www.w3.org/2005/xpath-functions#>
          ASK
          WHERE { 
              {
                ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                ?dip welcome:hasSlot ?slot .
                ?dip welcome:DIPId ?id .
                ?slot welcome:hasStatus ?status .
                ?slot welcome:hasNumberAttempts ?NbAtt .
              }
              FILTER (regex(str(?status), "Pending") || regex(str(?status), "FailedAnalysis") || regex(str(?status), "PendingAgreement") || regex(str(?status), "TCNElaborateRequest") || regex(str(?status), "TCNClarifyRequest") || regex(str(?status), "TopicSwitch") || regex(str(?status), "UnclearAnalysis"))
          }"""^^xsd:string ;
    ]) .

:UpdateIncompleteDIP
  a bt:Update ;
  rdfs:label "Update: DIP Incomplete" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          DELETE {
            ?dip welcome:hasDIPStatus ?statusDIP .  
          } INSERT {
            ?dip welcome:hasDIPStatus welcome:Incomplete .
          }
          WHERE {
            ?dip welcome:hasNamedGraph ?dipGraph .
            welcome:BT welcome:hasActiveDIP ?dipId .
            GRAPH ?dipGraph {
              ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              OPTIONAL { ?dip welcome:hasDIPStatus ?status . }
              ?dip welcome:DIPId ?dipId .
            }         
          }"""^^xsd:string ;
    ]) .

:EventProducerSpecificBTDIPIncomplete
  a bt:EventProducer ;
  rdfs:label "EventProducer: Trigger Specific BT - Incomplete DIP" ;
  ajan:event agents:SpecificBTEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:execute "IncompleteDIP" .              
            }
            WHERE {
              ?s rdf:type ajan:Agent .
            }"""^^xsd:string ;
        ] . 
        
:ConditionDIPCompleteOrUndefinedOrUnfinished
  a bt:Condition ;
  rdfs:label "Condition: DIP Complete or Undefined or Unfinished?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX fn: <http://www.w3.org/2005/xpath-functions#>
          ASK
          WHERE { 
              {
                {
                  ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                  ?dip welcome:hasSlot ?slot .
                  ?dip welcome:DIPId ?id .
                  ?slot welcome:hasStatus ?status .
                  ?slot welcome:hasNumberAttempts ?NbAtt .
                }
                FILTER (
                    !regex(str(?status), "Pending") && 
                    !regex(str(?status), "FailedAnalysis") && 
                    !regex(str(?status), "PendingAgreement") && 
                    !regex(str(?status), "TCNElaborateRequest") && 
                    !regex(str(?status), "TCNClarifyRequest") && 
                    !regex(str(?status), "TopicSwitch") && 
                    !regex(str(?status), "UnclearAnalysis")
                )
              }
              UNION
              {
                ?dipName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                ?dipName welcome:DIPId ?id .
                ?dipName welcome:hasSlot ?mandatorySlotName.
                ?mandatorySlotName welcome:hasStatus welcome:Undefined .
              }
              UNION
              {
                ?dipName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                ?dipName welcome:DIPId ?id .
                ?dipName welcome:hasSlot ?unfinishedSlotName.
                ?unfinishedSlotName welcome:hasStatus welcome:Unfinished .
              }
          }"""^^xsd:string ;
    ]) .

:UpdateCompleteDIP
  a bt:Update ;
  rdfs:label "Update: DIP Complete" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          DELETE { 
            ?dip welcome:hasDIPStatus ?status . 
          } INSERT {
            ?dip welcome:hasDIPStatus welcome:Complete .
          }
          WHERE {   
              ?dip welcome:hasNamedGraph ?dipGraph .
              welcome:BT welcome:hasActiveDIP ?dipId .
              GRAPH ?dipGraph {
                ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                OPTIONAL {?dip welcome:hasDIPStatus ?status }.
                ?dip welcome:DIPId ?dipId .
              }
          }"""^^xsd:string ;
    ]) .

:ConditionDIPIsNotOpening
  a bt:Condition ;
  rdfs:label "Condition: Active DIP is not Opening?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX welcomeService: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
          ASK
          WHERE { 
            ?dip welcome:hasNamedGraph ?dipGraph .
            ?dip welcome:DIPId ?id .  
            ?stg welcome:hasActiveDIP ?id . 
            ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            FILTER (
              !(  STRENDS(str(?dip), "#Opening") ||
                  STRENDS(str(?dip), ":Opening") )
            )             
          } """^^xsd:string ;
    ]) .
    
:EventProducerSpecificBTDIPComplete
  a bt:EventProducer ;
  rdfs:label "EventProducer: Trigger Specific BT - Complete DIP" ;
  ajan:event agents:SpecificBTEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:execute "CompleteDIP" .
            }
            WHERE {
              ?s rdf:type ajan:Agent .
            }"""^^xsd:string ;
        ] . 

:ConditionalNoServiceRequest
  a bt:Condition ;
  rdfs:label "Condition: No Service Request?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK 
          WHERE { 
              ?dip welcome:hasNamedGraph ?dipGraph .
              GRAPH ?dipGraph 
              {
                FILTER NOT EXISTS {
                          ?container rdf:type welcome:SpeechActContainer .
                          ?container welcome:hasSpeechActType welcome:Commit .
                          }
              }             
          }"""^^xsd:string ;
    ]) .

:CreateClosingUponFailureNoRequest_Part1
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure DIP - No Service Request or No SSC output - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ClosingUponFailure rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ClosingUponFailure welcome:hasDIPStatus welcome:Unknown .
						welcome:ClosingUponFailure welcome:isCurrentDIP "true"^^xsd:boolean .
						welcome:ClosingUponFailure welcome:hasSlot welcome:informMessage .
						welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informMessage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string .
						welcome:informMessage welcome:hasInputRDFContents welcome:reifiedReasonSTReasonNoFoundService .
						welcome:informMessage welcome:hasStatus welcome:Pending .
						welcome:informMessage welcome:hasNumberAttempts 0 .
						welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .						
					} WHERE { 
						?s rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
:CreateClosingUponFailureNoRequest_Part2
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure DIP - No Service Request or No SSC output - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:informMessage welcome:isOptional "false"^^xsd:boolean .
						welcome:informMessage welcome:dependsOn welcome:Unknown .
						welcome:informMessage welcome:associatedWith welcome:Unknown .
						welcome:reifiedReasonSTReasonNoFoundService rdf:type rdf:Statement .
						welcome:reifiedReasonSTReasonNoFoundService rdf:subject welcome:subTemplate .
						welcome:reifiedReasonSTReasonNoFoundService rdf:predicate welcome:isReason .
						welcome:reifiedReasonSTReasonNoFoundService rdf:object "STReasonNoFoundService"^^xsd:string .
					} WHERE { 
						?s rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:ConditionServiceRequest
  a bt:Condition ;
  rdfs:label "Condition: Commit exists?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK 
          WHERE { 
              ?dip welcome:hasNamedGraph ?dipGraph .
              GRAPH ?dipGraph 
              {
                ?container rdf:type welcome:SpeechActContainer .
                ?container welcome:hasSpeechActType welcome:Commit .
              }             
          }"""^^xsd:string ;
    ]) .

:DeletePreviousServiceRequestinExecution
  a bt:Update ;
  rdfs:label "Update: Delete Previous Service Request from Execution" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					DELETE {
							?container rdf:type welcome:SpeechActContainer .
							?container welcome:hasSpeechActType welcome:Commit .
							?container welcome:hasSpeechActObject ?o .
							?o rdf:type service:Service . 
							?o service:presents ?profile .
							?profile ?relprofile ?objprof .
					} WHERE { 
							?container rdf:type welcome:SpeechActContainer .
							?container welcome:hasSpeechActType welcome:Commit .
							?container welcome:hasSpeechActObject ?o .
							?o rdf:type service:Service . 
							?o service:presents ?profile .
							?profile ?relprofile ?objprof .
					}"""^^xsd:string ;
    ]) .
    
:WriteServiceRequestinExecution
	a bt:Write ;
	rdfs:label "Write: Service Request in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#> 
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
			CONSTRUCT  {
					?container rdf:type welcome:SpeechActContainer .
					?container welcome:hasSpeechActType welcome:Commit .
					?container welcome:hasSpeechActObject ?o .
					?o rdf:type service:Service . 
					?o service:presents ?profile .
					?profile ?relprofile ?objprof .	
			}
			WHERE { 
				?bt welcome:hasActiveDIP ?dipId . 
				?dip welcome:hasNamedGraph ?dipGraph .
				GRAPH ?dipGraph { 
					?container rdf:type welcome:SpeechActContainer .
					?container welcome:hasSpeechActType welcome:Commit .
					?container welcome:hasSpeechActObject ?o .
					?o rdf:type service:Service . 
					?o service:presents ?profile .
					?profile ?relprofile ?objprof .	
				}
			}"""^^xsd:string ;
	] .

:InvokeMatchmaker
	a ssc:ServiceComputing ;
	rdfs:label "SSC Plugin: Matchmaker" ;
	ssc:serviceRequest [
				a bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:targetBase ajan:LocalServicesKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
						PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 	
						PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>						
						CONSTRUCT {
							?o rdf:type service:Service . 
							?o service:presents ?profile .
							?profile ?relprofile ?objprof .
						}
						WHERE { 
							?s rdf:type welcome:SpeechActContainer .
							?s welcome:hasSpeechActType welcome:Commit .
							?s welcome:hasSpeechActObject ?o .
							?o rdf:type service:Service . 
							?o service:presents ?profile .
							?profile ?relprofile ?objprof .							
						} """^^xsd:string ;
			] ;
	ssc:serviceOffer [
				a bt:SelectQuery ;
				bt:originBase ajan:LocalServicesKnowledge ;
				bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					SELECT ?s ?o ?p ?g
					WHERE {
						{ GRAPH ?g { ?s ?o ?p } }
					}"""^^xsd:string ;
			] ;
	ssc:filterModel "text-similarity.filter"^^xsd:string .

:ConditionMatchmakerOutput
  a bt:Condition ;
  rdfs:label "Condition: MatchmakerOutput?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          ASK
          WHERE {
            ?ssc ssc:hasResultOffer ?MatchmakerOffer .
            FILTER NOT EXISTS {?ssc ssc:hasResultOffer welcome:Unknown .}
          }"""^^xsd:string ;
    ]) .
    
:PDDL2SPARQLPlugin
  a ssc:PDDL2SPARQL ;
  rdfs:label "PDDL2SPARQL Plugin: Map Precondition" ;
  ssc:servicePrecondition [
        a bt:ConstructQuery ;
        bt:originBase ajan:LocalServicesKnowledge ;
        bt:targetBase ajan:AgentKnowledge ;
        bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
          PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#> 
          PREFIX pddlexpr: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/PDDLExpression.owl#>  
          PREFIX expr: <http://www.daml.org/services/owl-s/1.1/generic/Expression.owl#>
          CONSTRUCT {
            ?MatchmakerOffer welcome:hasPrecondition ?precondition .
          }
          WHERE { 
            ?ssc ssc:hasResultOffer ?MatchmakerOffer .
            GRAPH ?g {
              ?MatchmakerOffer service:describedBy ?process .
              ?process process:hasPrecondition ?precondClass .
              ?precondClass expr:expressionBody ?precondition .
            }
          }"""^^xsd:string ;
      ] .

:ConditionPreconditionHolds
	a bt:Condition ;
	rdfs:label "Condition: Precondition holds?" ;
	bt:query ( [
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					ASK
					WHERE {
						?query welcome:hasPreconditionResult "true"^^<http://www.w3.org/2001/XMLSchema#boolean> .	
					}"""^^xsd:string ;
		]) .

:ConditionAtomicService 
  a bt:Condition ;
  rdfs:label "Condition: Atomic Service?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
          PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
          ASK
          WHERE {
            ?ssc ssc:hasResultOffer ?MatchmakerOffer .
            ?MatchmakerOffer rdf:type service:Service .
            ?MatchmakerOffer service:describedBy ?process .
            ?process rdf:type process:AtomicProcess .
          }"""^^xsd:string ;
    ]) .

:CreateAtomicServiceDIP
  a bt:Write ;
  rdfs:label "Write: Create DIP from Atomic" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
      PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
      PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      CONSTRUCT  {
            ?dipName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            ?dipName welcome:belongsTo ?matchmakerOffer .
            ?dipName welcome:isCurrentDIP "true"^^xsd:boolean .
            ?dipName welcome:hasDIPStatus welcome:Unknown .
            ?dipName welcome:hasSlot ?input .
            ?input rdf:type ?slotType .
            ?input welcome:hasOntologyType ?paramTypeInput .
            ?input welcome:hasTemplateId ?templateIdInput .           
            ?input welcome:isOptional ?optionalInput .
            ?input welcome:hasInputRDFContents welcome:Unknown .
            ?input welcome:hasTCNAnswer welcome:Unknown .
            ?input welcome:hasStatus welcome:Pending .
            ?input welcome:dependsOn ?dependency .
            ?input welcome:associatedWith ?association .
            ?input welcome:hasNumberAttempts 0 .
            ?input welcome:confidenceScore "0.0"^^xsd:float .         
      }
      WHERE { 
          {
            ?ssc ssc:hasResultOffer ?matchmakerOffer .
            ?matchmakerOffer rdf:type service:Service .
            ?service service:describedBy ?process . 
            ?process process:hasInput ?input .
            ?input process:parameterType ?paramTypeInput .
            ?input welcome:hasDIP ?dipName .
            ?input welcome:hasSlotType ?slotType .
            ?input welcome:isOptional ?optionalInput .              
            OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
            OPTIONAL {?input welcome:dependsOn ?val}
            OPTIONAL {?input welcome:associatedWith ?asso}
            BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
            BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).  
          }
      } """^^xsd:string ;
  ] .
  
:ConditionComposedService
  a bt:Condition ;
  rdfs:label "Condition: Composed Service?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
          PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
          ASK
          WHERE {
            ?ssc ssc:hasResultOffer ?MatchmakerOffer .
            ?MatchmakerOffer rdf:type service:Service .
            ?MatchmakerOffer service:describedBy ?process .
            ?process rdf:type process:CompositeProcess .
          }"""^^xsd:string ;
    ]) .

:CreateComposedServiceDIP
  a bt:Write ;
  rdfs:label "Write: Create DIP from Composite" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
      PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
      PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      CONSTRUCT  {
            ?atomicProcess rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            ?atomicProcess welcome:belongsTo ?matchmakerOffer .
            ?atomicProcess welcome:isCurrentDIP "true"^^xsd:boolean .
            ?atomicProcess welcome:hasDIPStatus welcome:Unknown .
            ?atomicProcess welcome:hasSlot ?inputAtomic .
            ?inputAtomic rdf:type ?slotType .
            ?inputAtomic welcome:hasOntologyType ?paramTypeInput .
            ?inputAtomic welcome:hasTemplateId ?templateInput .
            ?inputAtomic welcome:isOptional ?optionalOutput .
            ?inputAtomic welcome:hasInputRDFContents welcome:Unknown .
            ?inputAtomic welcome:hasTCNAnswer welcome:Unknown .
            ?inputAtomic welcome:hasStatus welcome:Pending .
            ?inputAtomic welcome:dependsOn ?dependency .
            ?inputAtomic welcome:associatedWith ?association .
            ?inputAtomic welcome:hasNumberAttempts 0 .
            ?inputAtomic welcome:confidenceScore "0.0"^^xsd:float . 
      }
      WHERE { 
          {?ssc ssc:hasResultOffer ?matchmakerOffer .
          ?matchmakerOffer service:describedBy ?Compositeprocess . 
          ?Compositeprocess process:hasInput ?inputComposite .
          ?perform process:process ?atomicProcess .
          ?atomicProcess rdf:type process:AtomicProcess . 
          ?atomicProcess process:hasInput ?inputAtomic .
          ?inputAtomic rdf:type process:Input .         
          ?perform process:hasDataFrom ?inputBinding .
          ?inputBinding rdf:type process:InputBinding .
          ?inputAtomic process:parameterType ?paramTypeInput .
          ?inputAtomic welcome:hasSlotType ?slotType .                    
          OPTIONAL { 
            ?inputAtomic welcome:hasTemplateId ?templateInput .
          }
          ?inputAtomic welcome:isOptional ?optionalOutput .         
          ?inputBinding process:toParam ?inputAtomic .
          ?inputBinding process:valueSource ?valOf .
          ?valOf rdf:type process:ValueOf .
          ?valOf process:theVar ?inputComposite .
          OPTIONAL {?inputAtomic welcome:dependsOn ?val}
          OPTIONAL {?inputAtomic welcome:associatedWith ?asso}
          BIND(IF(EXISTS{?inputAtomic welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
          BIND(IF(EXISTS{?inputAtomic welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association). 
          }         
      }"""^^xsd:string ;
  ] .

:WriteSSCResultinAgentKB
  a bt:Write ;
  rdfs:label "Write: SSC Result in Agent KB" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
      PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#> 
      PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
      CONSTRUCT { 
        ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
        ?MatchmakerOffer ssc:hasServiceName ?servName .       
      } WHERE  {
        ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
        ?MatchmakerOffer rdf:type service:Service .
        ?MatchmakerOffer service:presents ?profile .
        ?profile profile:serviceName ?servName .
      }"""^^xsd:string ;
  ] .

:EventProducerFirstInteractionMove
  a bt:EventProducer ;
  rdfs:label "EventProducer: Trigger First Interaction Move" ;
  ajan:event agents:FirstInteractionBTEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#> 
            PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
            PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:hasFirstMove "ServiceInteraction" .
            }
            WHERE {
              ?s rdf:type ajan:Agent . 
            }"""^^xsd:string ;
        ] . 

:EventProducerAlternativeFirstInteractionMove
  a bt:EventProducer ;
  rdfs:label "EventProducer: Trigger Alternative First Interaction Move" ;
  ajan:event agents:FirstInteractionBTEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:hasFirstMove "FirstAlternativeMove" .
            }
            WHERE {
              ?s rdf:type ajan:Agent .
            }"""^^xsd:string ;
        ] . 

:InvokePlanner
  a ssc:ServiceComputing ;
  rdfs:label "SSC Plugin: Planner" ;
  ssc:domainDefinition [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>            
        CONSTRUCT {
            ?s welcome:hasPDDLDomain ?p .
        }
        WHERE { 
            ?s welcome:hasPDDLDomain ?p .
        } """^^xsd:string ;
  ] ;
  ssc:problemInit [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>            
          CONSTRUCT {
            ?o welcome:hasInitState ?goal .
          }
          WHERE { 
            ?s rdf:type welcome:SpeechActContainer .
            ?s welcome:hasSpeechActType welcome:Commit .
            ?s welcome:hasSpeechActObject ?o .
            ?o welcome:hasInitState ?initialState .
          } """^^xsd:string ;
    ] ; 
  ssc:problemGoal [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>            
        CONSTRUCT {
          ?o welcome:hasGoalState ?goal .
        }
        WHERE { 
          ?s rdf:type welcome:SpeechActContainer .
          ?s welcome:hasSpeechActType welcome:Commit .
          ?s welcome:hasSpeechActObject ?o .
          ?o welcome:hasGoalState?initialState .
        } """^^xsd:string ;
  ] . 

:ConditionPlannerOutput
  a bt:Condition ;
  rdfs:label "Condition: PlannerOutput?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          ASK
          WHERE {
            ?ssc ssc:hasComposedService ?compositeService . 
          }"""^^xsd:string ;
    ]) .
    
:EventDefaultStatementNoOpinion
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Default Statement Non Opinion" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#EventStatementNonOpinion> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>            
            CONSTRUCT {               
              ?s rdf:type welcome:SpeechActContainer .
              ?s welcome:hasSpeechActType welcome:Statement-non-opinion .
            }
            WHERE { 
              ?s rdf:type welcome:SpeechActContainer .
              ?s welcome:hasSpeechActType welcome:Statement-non-opinion .
            }"""^^xsd:string ;
        ] .

:CreateClosingUponFailureInternalErrorPart1
  a bt:Update ;
  rdfs:label "Update: Create Closing Upon Failure DIP - Internal Error Part 1" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>                    
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
          INSERT {
            welcome:ClosingUponFailure rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            welcome:ClosingUponFailure welcome:hasDIPStatus welcome:Unknown .
            welcome:ClosingUponFailure welcome:isCurrentDIP "true"^^xsd:boolean .
            welcome:ClosingUponFailure welcome:hasSlot welcome:informMessage .
            welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
            welcome:informMessage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
            welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string .            
            welcome:informMessage welcome:hasStatus welcome:Pending . 
            welcome:informMessage welcome:dependsOn welcome:Unknown .
            welcome:informMessage welcome:associatedWith welcome:Unknown .
          } WHERE { 
            ?a rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .

:CreateClosingUponFailureInternalErrorPart2
  a bt:Update ;
  rdfs:label "Update: Create Closing Upon Failure DIP - Internal Error Part 2" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>                    
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
          INSERT {
            welcome:informMessage welcome:hasNumberAttempts 0 .
            welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .
            welcome:informMessage welcome:isOptional "false"^^xsd:boolean . 
            welcome:informMessage welcome:hasInputRDFContents welcome:reifiedReason2  .
            welcome:reifiedReason2 rdf:type rdf:Statement .
            welcome:reifiedReason2 rdf:subject welcome:subTemplate .
            welcome:reifiedReason2 rdf:predicate welcome:isReason .
            welcome:reifiedReason2 rdf:object "STReasonInternalFailure"^^xsd:string .
          } WHERE { 
            welcome:ClosingUponFailure welcome:hasSlot welcome:informMessage .
          }"""^^xsd:string ;
    ]) .


#=============================================================================================
#GenericInteractionDIFEScenarioBT

:EventHandlerFirstInteractionMove
  a bt:HandleEvent ;
  rdfs:label "EventHandler: First Scenario Specific Interaction Move" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#FirstInteractionBTEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>          
            PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:hasFirstMove ?val .
            }
            WHERE { 
              welcome:myWelcomeAgent welcome:hasFirstMove ?val .          
            }"""^^xsd:string ;
        ] .

:DeletePrecondition
  a bt:Update ;
  rdfs:label "Update: Delete Service Precondition Result in LAKR" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          DELETE {
            ?MatchmakerOffer welcome:hasPrecondition ?precondition .
            ?query welcome:hasPreconditionResult ?preconVal . 
          }
           WHERE {
            ?s ?p ?o .
            OPTIONAL { ?MatchmakerOffer welcome:hasPrecondition ?precondition .}
            OPTIONAL { ?query welcome:hasPreconditionResult ?preconVal .}
          }         
          """^^xsd:string ;
    ]) .

:DeleteSSCResultinLSR
  a bt:Update ;
  rdfs:label "Update: Delete SSC Result in LSR" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#> 
          DELETE {
            ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
          }
          WHERE {   
            ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
          }"""^^xsd:string ;
    ]) .

:ConditionServiceFirstInteraction
  a bt:Condition ;
  rdfs:label "Condition: First Move of a Found Service?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE { 
              welcome:myWelcomeAgent welcome:hasFirstMove "ServiceInteraction".             
          }"""^^xsd:string ;
    ]) .
    
:ConditionFirstMoveFirstReceptionService
  a bt:Condition ;
  rdfs:label "Condition: First Move for First Reception Service BT?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
          ASK
          WHERE { 
              ?sscSubj ssc:hasResultOffer reception:FirstReceptionService .
          }"""^^xsd:string ;
    ]) .
    
:WriteObtainRegistrationStatus2Execution
  a bt:Write ;
  rdfs:label "Write: Obtain Registration Status in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:ObtainRegistrationStatus rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:ObtainRegistrationStatus welcome:belongsTo reception:FirstReceptionService .
			reception:ObtainRegistrationStatus welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:ObtainRegistrationStatus welcome:hasDIPStatus welcome:Unknown .
			reception:ObtainRegistrationStatus welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:ObtainRegistrationStatus .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	  
	}"""^^xsd:string ;
  ] .


:ConditionFirstMoveCVCreation
  a bt:Condition ;
  rdfs:label "Condition: First Move for CV Creation BT?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
          PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
          ASK
          WHERE { 
              ?sscSubj ssc:hasResultOffer employment:createCV .
          }"""^^xsd:string ;
    ]) .

:WriteCVPurposeDIP2Execution
  a bt:Write ;
  rdfs:label "Write: CV Purpose DIP in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						employment:CVPurpose rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:CVPurpose welcome:belongsTo employment:createCV .
						employment:CVPurpose welcome:isCurrentDIP "true"^^xsd:boolean .
						employment:CVPurpose welcome:hasDIPStatus welcome:Unknown .
						employment:CVPurpose welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						employment:createCV rdf:type service:Service .
						employment:createCV service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP employment:CVPurpose .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
  ] . 
  
:ConditionExistingIncompleteCV
	a bt:Condition ;
	rdfs:label "Condition: TCN Already has an Incomplete CV ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					ASK
					WHERE { 
							welcome:tcn_user welcome:hasCVStatus ?cvStatus .
							?cvStatus rdf:type welcome:CVStatus .
							?cvStatus welcome:hasValue "Incomplete" .
					}"""^^xsd:string ;
		]) .
		
:UpdateCVPurpose_ExistingIncompleteDIP2Execution
	a bt:Update ;
	rdfs:label "Update: Incomplete CV Template" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>	
					DELETE {
						employment:informServicePurpose welcome:hasTemplateId ?templateServicePurpose .						
						employment:informDisclaimerCVModification welcome:hasTemplateId ?templateDisclaimerCV .
						employment:obtainCVCreationInterest welcome:hasTemplateId ?templateCVCreationInterest .
					}
					INSERT { 
						employment:informServicePurpose welcome:hasTemplateId "TInformServicePurpose_CV"^^xsd:string . 
						employment:informDisclaimerCVModification welcome:hasTemplateId "TInformDisclaimerCVModification_CV"^^xsd:string .
						employment:obtainCVCreationInterest welcome:hasTemplateId "TObtainCVContinueInterest"^^xsd:string .
					}
					WHERE {		
						employment:CVPurpose rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:CVPurpose welcome:hasSlot employment:informServicePurpose .
						employment:CVPurpose welcome:hasSlot employment:informDisclaimerCVModification .
						employment:CVPurpose welcome:hasSlot employment:obtainCVCreationInterest .
						employment:informServicePurpose welcome:hasTemplateId ?templateServicePurpose .						
						employment:informDisclaimerCVModification welcome:hasTemplateId ?templateDisclaimerCV .
						employment:obtainCVCreationInterest welcome:hasTemplateId ?templateCVCreationInterest .
					}"""^^xsd:string ;
		]) .
		
:ConditionExistingCompleteCV
	a bt:Condition ;
	rdfs:label "Condition: TCN Already has a Complete CV ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					ASK
					WHERE { 
							welcome:tcn_user welcome:hasCVStatus ?cvStatus .
							?cvStatus rdf:type welcome:CVStatus .
							?cvStatus welcome:hasValue "Complete" .
					}"""^^xsd:string ;
		]) .
		
:UpdateCVPurpose_ExistingCompleteDIP2Execution
	a bt:Update ;
	rdfs:label "Update: Complete CV Template" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>	
					DELETE {
						employment:informServicePurpose welcome:hasTemplateId ?templateServicePurpose .						
						employment:informDisclaimerCVModification welcome:hasTemplateId ?templateDisclaimerCV .
						employment:obtainCVCreationInterest welcome:hasTemplateId ?templateCVCreationInterest .
					}
					INSERT { 
						employment:informServicePurpose welcome:hasTemplateId "TInformServicePurpose_CV"^^xsd:string . 
						employment:informDisclaimerCVModification welcome:hasTemplateId "TInformDisclaimerCVModification_CV"^^xsd:string .
						employment:obtainCVCreationInterest welcome:hasTemplateId "TObtainCVReviewInterest"^^xsd:string .
					}
					WHERE {		
						employment:CVPurpose rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:CVPurpose welcome:hasSlot employment:informServicePurpose .
						employment:CVPurpose welcome:hasSlot employment:informDisclaimerCVModification .
						employment:CVPurpose welcome:hasSlot employment:obtainCVCreationInterest .
						employment:informServicePurpose welcome:hasTemplateId ?templateServicePurpose .						
						employment:informDisclaimerCVModification welcome:hasTemplateId ?templateDisclaimerCV .
						employment:obtainCVCreationInterest welcome:hasTemplateId ?templateCVCreationInterest .
					}"""^^xsd:string ;
		]) .
		
:ConditionNoCV
	a bt:Condition ;
	rdfs:label "Condition: no CV exists ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					ASK
					WHERE { 
							welcome:tcn_user welcome:hasCVStatus ?cvStatus .
							?cvStatus rdf:type welcome:CVStatus .
							?cvStatus welcome:hasValue "None" .
					}"""^^xsd:string ;
		]) .
		
:UpdateCVPurpose_NoCVDIP2Execution
	a bt:Update ;
	rdfs:label "Update: No CV Template" ;
	bt:query ( [
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>	
					DELETE {
						employment:informServicePurpose welcome:hasTemplateId ?templateServicePurpose .						
						employment:informDisclaimerCVModification welcome:hasTemplateId ?templateDisclaimerCV .
						employment:obtainCVCreationInterest welcome:hasTemplateId ?templateCVCreationInterest .
					}
					INSERT { 
						employment:informServicePurpose welcome:hasTemplateId "TInformServicePurpose_noCV"^^xsd:string . 
						employment:informDisclaimerCVModification welcome:hasTemplateId "TInformDisclaimerCVModification_noCV"^^xsd:string .
						employment:obtainCVCreationInterest welcome:hasTemplateId "TObtainCVCreationInterest"^^xsd:string .
					}
					WHERE {		
						employment:CVPurpose rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:CVPurpose welcome:hasSlot employment:informServicePurpose .
						employment:CVPurpose welcome:hasSlot employment:informDisclaimerCVModification .
						employment:CVPurpose welcome:hasSlot employment:obtainCVCreationInterest .
						employment:informServicePurpose welcome:hasTemplateId ?templateServicePurpose .						
						employment:informDisclaimerCVModification welcome:hasTemplateId ?templateDisclaimerCV .
						employment:obtainCVCreationInterest welcome:hasTemplateId ?templateCVCreationInterest .
					}"""^^xsd:string ;
		]) .

:ConditionFirstMoveSchooling
	a bt:Condition ;
	rdfs:label "Condition: First Move for Schooling BT?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX preregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
					PREFIX simulateAppointment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SimulateAppointmentService.owl#>
					PREFIX fullpreregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FullPreregistration.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE { 
							?sscSubj ssc:hasResultOffer schooling:diplomaRecognition .
					}"""^^xsd:string ;
		]) .
		
:WriteScenarioIntroductionSchoolingDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Scenario Introduction Schooling DIP in Execution" ;
	bt:query [
    a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX preregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
			PREFIX simulateAppointment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SimulateAppointmentService.owl#>
			PREFIX fullpreregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FullPreregistration.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						schooling:ScenarioIntroduction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:ScenarioIntroduction welcome:belongsTo schooling:diplomaRecognition .
						schooling:ScenarioIntroduction welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:ScenarioIntroduction welcome:hasDIPStatus welcome:Unknown .
						schooling:ScenarioIntroduction welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:ScenarioIntroduction .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
			} """^^xsd:string ;
  ] . 
  
:WriteCreateInformContactNGOFarewellDIP2Execution_Part1
	a bt:Write ;
	rdfs:label "Write: Create Inform Contact NGO Farewell DIP in Execution - Part 1" ;
	bt:query [
    a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 	
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					CONSTRUCT {
						welcome:ContactNGOFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ContactNGOFarewell welcome:hasDIPStatus welcome:Unknown .
						welcome:ContactNGOFarewell welcome:isCurrentDIP "true"^^xsd:boolean . 
						welcome:ContactNGOFarewell welcome:hasSlot welcome:informInabilityAssist .						
						welcome:informInabilityAssist rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .	
						welcome:informInabilityAssist welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .	
						welcome:informInabilityAssist welcome:hasTemplateId "TInformInabilityAssist"^^xsd:string .
						welcome:informInabilityAssist welcome:hasInputRDFContents welcome:Unknown .
						welcome:informInabilityAssist welcome:hasTCNAnswer welcome:Unknown .
						welcome:informInabilityAssist welcome:hasStatus welcome:Pending .
						welcome:informInabilityAssist welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informInabilityAssist welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informInabilityAssist welcome:isOptional "false"^^xsd:boolean .
						welcome:informInabilityAssist welcome:dependsOn welcome:Unknown .
						welcome:informInabilityAssist welcome:associatedWith welcome:Unknown .	
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	 ] . 
		
:WriteCreateInformContactNGOFarewellDIP2Execution_Part2
	a bt:Write ;
	rdfs:label "Write: Create Inform Contact NGO Farewell DIP in Execution - Part 2" ;
	bt:query [
    a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 	
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					CONSTRUCT {
						welcome:ContactNGOFarewell welcome:hasSlot welcome:informGenericPRAKSISContact .						
						welcome:informGenericPRAKSISContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .	
						welcome:informGenericPRAKSISContact welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .	
						welcome:informGenericPRAKSISContact welcome:hasTemplateId "TInformPRAKSISContact"^^xsd:string .
						welcome:informGenericPRAKSISContact welcome:hasInputRDFContents welcome:Unknown .
						welcome:informGenericPRAKSISContact welcome:hasTCNAnswer welcome:Unknown .
						welcome:informGenericPRAKSISContact welcome:hasStatus welcome:Pending .
						welcome:informGenericPRAKSISContact welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informGenericPRAKSISContact welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informGenericPRAKSISContact welcome:isOptional "false"^^xsd:boolean .
						welcome:informGenericPRAKSISContact welcome:dependsOn welcome:Unknown .
						welcome:informGenericPRAKSISContact welcome:associatedWith welcome:Unknown .	
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	 ] . 

:WriteCreateInformContactNGOFarewellDIP2Execution_Part3
	a bt:Write ;
	rdfs:label "Write: Create Inform Contact NGO Farewell DIP in Execution - Part 3" ;
	bt:query [
    a bt:ConstructQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 	
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					CONSTRUCT {								
						welcome:ContactNGOFarewell welcome:hasSlot welcome:informContactNGOFarewell .
						welcome:informContactNGOFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .	
						welcome:informContactNGOFarewell welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .	
						welcome:informContactNGOFarewell welcome:hasTemplateId "TInformNormalClosingFarewell"^^xsd:string .
						welcome:informContactNGOFarewell welcome:hasInputRDFContents welcome:Unknown .
						welcome:informContactNGOFarewell welcome:hasTCNAnswer welcome:Unknown .
						welcome:informContactNGOFarewell welcome:hasStatus welcome:Pending .
						welcome:informContactNGOFarewell welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informContactNGOFarewell welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informContactNGOFarewell welcome:isOptional "false"^^xsd:boolean .	
						welcome:informContactNGOFarewell welcome:dependsOn welcome:Unknown .
						welcome:informContactNGOFarewell welcome:associatedWith welcome:Unknown .
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	 ] . 
		
:DeleteSSCResultinAgentKB
  a bt:Update ;
  rdfs:label "Update: Delete SSC Result in Agent KB" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
          PREFIX simulateAppointment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SimulateAppointmentService.owl#>
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>   
          DELETE {
            ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
            ?MatchmakerOffer ssc:hasServiceName ?servName . 
          }
          WHERE {   
            OPTIONAL {
              ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
              ?MatchmakerOffer ssc:hasServiceName ?servName .
            }
          }"""^^xsd:string ;
    ]) .

:DeleteFirstInteractionFlaginLAKR
  a bt:Update ;
  rdfs:label "Update: Delete First Interaction Flag in LAKR" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          DELETE {
            welcome:myWelcomeAgent welcome:hasFirstMove ?val .    
          }
          WHERE { 
            welcome:myWelcomeAgent welcome:hasFirstMove ?val .  
          }         
          """^^xsd:string ;
    ]) .

:EventHandlerSpecificBT
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Specific BT" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#SpecificBTEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>         
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:execute ?val .     
            }
            WHERE { 
              welcome:myWelcomeAgent welcome:execute ?val .           
            }"""^^xsd:string ;
        ] .

:DeletePreviousFlaginExecution
  a bt:Update ;
  rdfs:label "Update: Delete Previous Specific BT Flag in Execution" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          DELETE {
            welcome:myWelcomeAgent welcome:execute ?val .   
          } WHERE { 
            OPTIONAL{
              welcome:myWelcomeAgent welcome:execute ?val . 
            }
          }"""^^xsd:string ;
    ]) .

:WriteSpecificBTFlaginExecution
  a bt:Write ;
  rdfs:label "Write: Specific BT Flag in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
        welcome:myWelcomeAgent welcome:execute ?val . 
      }
      WHERE {
        welcome:myWelcomeAgent welcome:execute ?val . 
      }"""^^xsd:string ;
  ] .

:DeleteSpecificBTFlaginAgentKB
  a bt:Update ;
  rdfs:label "Update: Delete Specific BT Flag in LAKR" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          DELETE {
            welcome:myWelcomeAgent welcome:execute ?val .   
          } WHERE { 
            welcome:myWelcomeAgent welcome:execute ?val . 
          }"""^^xsd:string ;
    ]) .
    
:ConditionalFlagIncomplete
  a bt:Condition ;
  rdfs:label "Condition: Specific BT Flag Incomplete?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE { 
              welcome:myWelcomeAgent welcome:execute "IncompleteDIP" .  
          }"""^^xsd:string ;
    ]) .

:SendIncompleteOrMultipleDIPDMS
	a myWelcome:Message ;
	rdfs:label "Message: Send Multiple or Incomplete DIP to DMS"^^xsd:string ;
	rdfs:comment "Message: Send Multiple or Incomplete DIP to DMS"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
		  a bt:SelectQuery;
		  a bt:QueryUri ;
		  bt:originBase ajan:AgentKnowledge ;
		  bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					SELECT DISTINCT ?hdrName ?fieldValue
					WHERE { 
							{
								VALUES ?hdrName {"X-Turn-ID"}
								?turn welcome:hasTurnID ?fieldValue .
							}
							
							UNION
							{
							   VALUES ?hdrName {"X-Correlation-ID"}
							   ?msg welcome:hasCorrelationID ?fieldValue .
							}
							UNION
							{
							   VALUES ?hdrName {"X-Language"}
								welcome:tcn_user welcome:hasLanguageCode ?lang .
								?lang rdf:type welcome:LanguageCode .
								?lang welcome:hasValue ?fieldValue .
							}
							UNION
							{
								VALUES ?hdrName {"X-Avatar-Gender"}
								welcome:Avatar welcome:hasGender welcome:Gender .
								welcome:Gender welcome:hasValue ?fieldValue .	
							}
							UNION
							{
								VALUES ?hdrName {"X-User-ID"}
								?du rdf:type welcome:DialogueUser .
								?du welcome:hasUserId ?idObject .
								?idObject welcome:hasValue ?fieldValue .
							}
							UNION
							{
								VALUES (?hdrName ?fieldValue) {
								("X-Msg-Type" "dialogueResponse")
								}
							}
					}"""^^xsd:string
		] ;
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle;charset-UTF8"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;	
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX preregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
						PREFIX simulateAppointment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SimulateAppointmentService.owl#>
						PREFIX fullpreregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FullPreregistration.owl#>
						PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
						PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						CONSTRUCT {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .					
							?dip welcome:DIPId ?id .
							?dip welcome:isCurrentDIP ?current .
							?dip welcome:hasSlot ?slots .
							?slots rdf:type ?slotType .
							?slots welcome:hasTemplateId ?templateID .	
							?slots welcome:hasInputRDFContents ?RDFContents .
							?slots welcome:hasTCNAnswer ?tcnAnswer .
							?slots welcome:hasOntologyType ?ontoType .
							?tcnAnswer ?reifiPredAnswer ?reifiedObjAnswer .
							?RDFContents ?ReifiPredi ?ReifiObj .					
							?slots welcome:hasStatus ?slotsStatus .		
							?slots welcome:hasNumberAttempts ?NbAttempts .
							?slots welcome:confidenceScore ?confScore .
							?slots welcome:isOptional ?optional .
							?slots welcome:dependsOn ?val .
							?slots welcome:associatedWith ?asso .
						}
						WHERE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .					
							?dip welcome:DIPId ?id .
							?dip welcome:isCurrentDIP ?current .
							?dip welcome:hasSlot ?slots .
							?slots rdf:type ?slotType .
							?slots welcome:hasOntologyType ?ontoType .							
							?slots welcome:hasStatus ?slotsStatus .		
							?slots welcome:hasNumberAttempts ?NbAttempts .
							?slots welcome:confidenceScore ?confScore .
							?slots welcome:isOptional ?optional .	
							OPTIONAL { ?slots welcome:hasTemplateId ?templateID . }
							OPTIONAL {?slots welcome:dependsOn ?val .}
							OPTIONAL {?slots welcome:associatedWith ?asso .}
							OPTIONAL { 
								{?slots welcome:hasTCNAnswer ?tcnAnswer .}
								UNION
								{?slots welcome:hasTCNAnswer ?tcnAnswer .
								 ?tcnAnswer ?reifiPredAnswer ?reifiedObjAnswer .}
							}
							OPTIONAL { 
								{?slots welcome:hasInputRDFContents ?RDFContents . }
								UNION
								{?slots welcome:hasInputRDFContents ?RDFContents .
								?RDFContents ?ReifiPredi ?ReifiObj .}
							}
						}"""^^xsd:string
			]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/toTcn?log=true") AS ?requestURI )
   			}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .

:ConditionalNormalClosing_ContactNGO_ClosingFailureComplete
  a bt:Condition ;
  rdfs:label "Condition: Normal Closing or ContactNGO or Closing Failure Complete" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
		  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          ASK
          WHERE {
              {
                ?bt welcome:hasActiveDIP ?id . 
                reception:NormalClosing rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                reception:NormalClosing welcome:DIPId ?id .
              }
              UNION
              {
                ?bt welcome:hasActiveDIP ?id . 
                welcome:NormalClosing rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                welcome:NormalClosing welcome:DIPId ?id .
              }
              UNION
              {
                ?bt welcome:hasActiveDIP ?id .
                welcome:ContactNGOFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                welcome:ContactNGOFarewell welcome:DIPId ?id .
              }
              UNION
              {
                ?bt welcome:hasActiveDIP ?id .
                welcome:NormalClosingFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                welcome:NormalClosingFarewell welcome:DIPId ?id .
              }
              UNION
              {
                ?bt welcome:hasActiveDIP ?id .
                welcome:ClosingUponFailure rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                welcome:ClosingUponFailure welcome:DIPId ?id .
              }
              UNION
              {
                ?bt welcome:hasActiveDIP ?id .
                welcome:ClosingUponFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
                welcome:ClosingUponFailureFarewell welcome:DIPId ?id .
              }
          }"""^^xsd:string ;
    ]) .
    
#:SucessFinishScenario
# a bt:Success ;
# rdfs:label "Scenario Finished"^^xsd:string .

:MessageSendDialogueFinishNotification
  a myWelcome:Message ;
  rdfs:label "Message: Send Dialogue Finished Notification to App"^^xsd:string ;
  rdfs:comment "Message: Send Dialogue Finished Notification to App"^^xsd:string ;
  bt:targetBase ajan:AgentKnowledge ;  
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?hdrName ?fieldValue
        WHERE {
            ?headerName welcome:hasHeaderName ?hdrName .
            ?headerName welcome:hasHeaderValue ?fieldValue .          
        }"""^^xsd:string
    ] ; 
    http-core:headers ([
          a http-core:Header ;            
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "application/ld+json"
        ]
    ) ;     
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>    
            CONSTRUCT {
              welcome:notificationTitle welcome:EndDialogue  "true" .  
            }
            WHERE {
              ?bt welcome:hasActiveDIP ?id .
            }"""^^xsd:string
      ]
    ] ;    
  ] ;
  bt:queryUri [
  a bt:SelectQuery ;
  a bt:QueryUri ;
  bt:originBase ajan:AgentKnowledge ;
  bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT ?requestURI 
        WHERE
        {
          welcome:dispatcher welcome:hasAddress ?partialAddress .
          BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
        }"""^^xsd:string
  ] . 
# bt:queryUri [
# a bt:SelectQuery ;
# a bt:QueryUri ;
# bt:originBase ajan:AgentKnowledge ;  
# bt:sparql """
#       PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#       PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#       SELECT ?requestURI 
#       WHERE
#       {
#         welcome:dispatcher welcome:hasAddress ?partialAddress .
#         BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#       }"""^^xsd:string
# ] .

:ConditionExecuteFirstReception
  a bt:Condition ;
  rdfs:label "Condition: Execute First Reception Service BT?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
          ASK
          WHERE { 
              ?bt welcome:hasActiveDIP ?dipId . 
              ?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              ?dip welcome:DIPId ?id .
              ?dip welcome:belongsTo <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#FirstReceptionService> .
          }"""^^xsd:string ;
    ]) .
    
:EventProducerExecuteFirstReceptionBT                                                                   a bt:EventProducer ;
  a bt:EventProducer ;
  rdfs:label "EventProducer: Execute First Reception BT" ;
  ajan:event agents:FirstReceptionServiceEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:executeScenario "FirstReception" .
            }
            WHERE {
              ?s rdf:type ajan:Agent .
            }"""^^xsd:string ;
        ] . 

:ConditionExecuteSchoolingBT
	a bt:Condition ;
	rdfs:label "Condition: Execute Schooling BT?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX preregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
					PREFIX simulateAppointment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SimulateAppointmentService.owl#>
					PREFIX fullpreregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FullPreregistration.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE { 
							?bt welcome:hasActiveDIP ?dipId . 
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							?dip welcome:DIPId ?id .
							?dip welcome:belongsTo <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#diplomaRecognition>
					}"""^^xsd:string ;
		]) .

:EventProducerExecuteSchoolingBT
	a bt:EventProducer ;
	rdfs:label "EventProducer: Execute Schooling BT" ;
	ajan:event agents:SchoolingMasterEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:ExecutionKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:topic welcome:informed "Master" .
						}
						WHERE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						}"""^^xsd:string ;
	] .	
	
:EventProducerExecuteCVCreationBT
  a bt:EventProducer ;
  rdfs:label "EventProducer: Execute the CV Creation BT" ;
  ajan:event agents:CVCreationEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:executeScenario "CVCreation" .
            }
            WHERE {
              ?s rdf:type ajan:Agent .
            }"""^^xsd:string ;
        ] . 
        
:UpdateCreateNormalClosingPart1
  a bt:Update ;
  rdfs:label "Update: Create Normal Closing DIP Part 1" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>          
          INSERT {
            welcome:NormalClosing rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            welcome:NormalClosing welcome:hasDIPStatus welcome:Unknown .
            welcome:NormalClosing welcome:hasSlot welcome:informEnd .
            welcome:NormalClosing welcome:isCurrentDIP "true"^^xsd:boolean . 
            welcome:informEnd rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
            welcome:informEnd welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI . 
            welcome:informEnd welcome:hasTemplateId "TInformEnd"^^xsd:string .
            welcome:informEnd welcome:hasInputRDFContents welcome:Unknown .
            welcome:informEnd welcome:hasTCNAnswer welcome:Unknown .
            welcome:informEnd welcome:hasStatus welcome:Pending .
            welcome:informEnd welcome:hasNumberAttempts "0"^^xsd:int .
            welcome:informEnd welcome:confidenceScore "0.0"^^xsd:float .
            welcome:informEnd welcome:isOptional "false"^^xsd:boolean . 
            welcome:informEnd welcome:dependsOn welcome:Unknown .
            welcome:informEnd welcome:associatedWith welcome:Unknown .  
          } 
          WHERE { 
            ?s rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .

:UpdateCreateNormalClosingPart2
  a bt:Update ;
  rdfs:label "Update: Create Normal Closing DIP Part 2" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>          
          INSERT {
            welcome:NormalClosing welcome:hasSlot welcome:obtainConfirmation .
            welcome:obtainConfirmation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#ConfirmationRequest"^^xsd:anyURI . 
            welcome:obtainConfirmation welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
            welcome:obtainConfirmation welcome:hasTemplateId "TObtainConfirmation"^^xsd:string .
            welcome:obtainConfirmation welcome:hasInputRDFContents welcome:Unknown .
            welcome:obtainConfirmation welcome:hasTCNAnswer welcome:Unknown .
            welcome:obtainConfirmation welcome:hasStatus welcome:Pending .
            welcome:obtainConfirmation welcome:hasNumberAttempts "0"^^xsd:int .
            welcome:obtainConfirmation welcome:confidenceScore "0.0"^^xsd:float .
            welcome:obtainConfirmation welcome:isOptional "false"^^xsd:boolean .
            welcome:obtainConfirmation welcome:dependsOn welcome:Unknown .
            welcome:obtainConfirmation welcome:associatedWith welcome:Unknown . 
          } 
          WHERE { 
            ?s rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .
    
:DeleteActiveDIPinAgentKB
  a bt:Update ;
  rdfs:label "Update: Remove Active DIPs in LAKR" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          DELETE {
            ?bt welcome:hasActiveDIP ?id .  
            ?dip welcome:hasNamedGraph ?dipGraph .
          }
           WHERE {
            OPTIONAL { ?bt welcome:hasActiveDIP ?id .}  
            OPTIONAL { ?dip welcome:hasNamedGraph ?dipGraph .}          
          }"""^^xsd:string ;
    ]) .

:WriteNormalClosingDIP2Execution
  a bt:Write ;
  rdfs:label "Write:Normal Closing DIP in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      CONSTRUCT  {
        reception:NormalClosing rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
        reception:NormalClosing welcome:belongsTo ?service .
        reception:NormalClosing welcome:hasDIPStatus ?status .
        reception:NormalClosing welcome:isCurrentDIP "true"^^xsd:boolean .
        reception:NormalClosing welcome:hasSlot ?slots .
        ?slots rdf:type ?slotType .
        ?slots welcome:hasOntologyType ?ontoType .
        ?slots welcome:hasInputRDFContents welcome:Unknown .  
        ?slots welcome:hasTCNAnswer welcome:Unknown .
        ?slots welcome:hasStatus welcome:Pending .    
        ?slots welcome:hasNumberAttempts 0 .
        ?slots welcome:confidenceScore "0.0"^^xsd:float .
        ?slots welcome:isOptional ?optional .
        ?slots welcome:dependsOn ?depend .
        ?slots welcome:associatedWith ?associate .        
        ?slots welcome:hasTemplateId ?templateID .  
      }
      WHERE {
        reception:NormalClosing rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
        reception:NormalClosing welcome:belongsTo ?service .
        reception:NormalClosing welcome:hasDIPStatus ?status .
        reception:NormalClosing welcome:isCurrentDIP "true"^^xsd:boolean .
        reception:NormalClosing welcome:hasSlot ?slots .
        ?slots rdf:type ?slotType .
        ?slots welcome:hasOntologyType ?ontoType .
        ?slots welcome:hasInputRDFContents ?RDFContents . 
        ?slots welcome:hasStatus ?slotsStatus .   
        ?slots welcome:hasNumberAttempts ?NbAttempts .
        ?slots welcome:confidenceScore ?confScore .
        ?slots welcome:isOptional ?optional . 
        ?slots welcome:dependsOn ?depend .
        ?slots welcome:associatedWith ?associate .
        OPTIONAL { ?slots welcome:hasTemplateId ?templateID .}
        OPTIONAL {?slots welcome:hasTCNAnswer ?tcnAnswer .}                 
      }"""^^xsd:string ;
  ] .

:UpdateCreateClosingUponFailureDIP2Execution
  a bt:Update ;
  rdfs:label "Update: Create Closing Upon Failure DIP. Confirmation Required to Continue Scenario" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>                    
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          INSERT {
            welcome:ClosingUponFailure rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            welcome:ClosingUponFailure welcome:hasDIPStatus welcome:Unknown .
            welcome:ClosingUponFailure welcome:isCurrentDIP "true"^^xsd:boolean .
            welcome:ClosingUponFailure welcome:hasSlot welcome:informMessage .
            welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
            welcome:informMessage welcome:hasOntologyType  "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
            welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string . 
            welcome:informMessage welcome:hasInputRDFContents welcome:reifiedConfirmation .
            welcome:informMessage welcome:hasStatus welcome:Pending .
            welcome:informMessage welcome:hasNumberAttempts "0"^^xsd:int .
            welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .
            welcome:informMessage welcome:isOptional "false"^^xsd:boolean .
            welcome:informMessage welcome:dependsOn welcome:Unknown .
            welcome:informMessage welcome:associatedWith welcome:Unknown .
            welcome:reifiedConfirmation rdf:type rdf:Statement .
            welcome:reifiedConfirmation rdf:subject welcome:subTemplate .
            welcome:reifiedConfirmation rdf:predicate welcome:isReason .
            welcome:reifiedConfirmation rdf:object "STReasonNoConfirmation"^^xsd:string .            
          } WHERE { 
            ?s ?o ?p .
          }"""^^xsd:string ;
    ]) .

:WriteInformServiceNGOSupportDIP2Execution
  a bt:Write ;
  rdfs:label "Write: Inform Service NGO Support DIP in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/PreregistrationProcedureService.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
      CONSTRUCT  {
        reception:InformServiceNGOSupport rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
        reception:InformServiceNGOSupport welcome:belongsTo ?service .
        reception:InformServiceNGOSupport welcome:hasDIPStatus ?status .
        reception:InformServiceNGOSupport welcome:isCurrentDIP "true"^^xsd:boolean .
        reception:InformServiceNGOSupport welcome:hasSlot ?slots .
        ?slots rdf:type ?slotType .
        ?slots welcome:hasOntologyType ?ontoType .
        ?slots welcome:hasInputRDFContents welcome:Unknown .  
        ?slots welcome:hasTCNAnswer welcome:Unknown .
        ?slots welcome:hasStatus welcome:Pending .    
        ?slots welcome:hasNumberAttempts 0 .
        ?slots welcome:confidenceScore "0.0"^^xsd:float .
        ?slots welcome:isOptional ?optional .
        ?slots welcome:dependsOn ?depend .
        ?slots welcome:associatedWith ?associate .        
        ?slots welcome:hasTemplateId ?templateID .
      }
      WHERE {
        reception:InformServiceNGOSupport rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
        reception:InformServiceNGOSupport welcome:belongsTo ?service .
        reception:InformServiceNGOSupport welcome:hasDIPStatus ?status .
        reception:InformServiceNGOSupport welcome:isCurrentDIP "true"^^xsd:boolean .
        reception:InformServiceNGOSupport welcome:hasSlot ?slots .
        ?slots rdf:type ?slotType .
        ?slots welcome:hasOntologyType ?ontoType .
        ?slots welcome:hasInputRDFContents ?RDFContents . 
        ?slots welcome:hasStatus ?slotsStatus .   
        ?slots welcome:hasNumberAttempts ?NbAttempts .
        ?slots welcome:confidenceScore ?confScore .
        ?slots welcome:isOptional ?optional .       
        ?slots welcome:dependsOn ?depend .
        ?slots welcome:associatedWith ?associate .
        OPTIONAL { ?slots welcome:hasTemplateId ?templateID . }
        OPTIONAL { ?slots welcome:hasTCNAnswer ?tcnAnswer .}          
      }"""^^xsd:string ;
  ] .


#=============================================================================================
# SpecificFirstReceptionBT

:ConditionalUndefinedDIP
	a bt:Condition ;
	rdfs:label "Condition: A mandatory info is missing ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							?dipName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							?dipName welcome:DIPId ?id .
							?dipName welcome:hasSlot ?mandatorySlotName.
							?mandatorySlotName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
							?mandatorySlotName welcome:hasStatus welcome:Undefined .	
					}"""^^xsd:string ;
		]) .
		
:UpdateCreateClosingUponFailureUndefinedSlotDIP2Execution_Part1
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure DIP - Missing Mandatory Info - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ClosingUponFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ClosingUponFailureFarewell welcome:hasDIPStatus welcome:Unknown .
						welcome:ClosingUponFailureFarewell welcome:isCurrentDIP "true"^^xsd:boolean .
						welcome:ClosingUponFailureFarewell welcome:hasSlot welcome:informMessage .
						welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informMessage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string . 
						welcome:informMessage welcome:hasInputRDFContents welcome:reifiedReasonSTReasonValueMissed .
						welcome:informMessage welcome:dependsOn welcome:Unknown .
						welcome:informMessage welcome:associatedWith welcome:Unknown .
						welcome:informMessage welcome:hasStatus welcome:Pending .
						welcome:informMessage welcome:hasNumberAttempts 0 .
						welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informMessage welcome:isOptional "false"^^xsd:boolean .				
						welcome:reifiedReasonSTReasonValueMissed rdf:type rdf:Statement .
						welcome:reifiedReasonSTReasonValueMissed rdf:subject welcome:subTemplate .
						welcome:reifiedReasonSTReasonValueMissed rdf:predicate welcome:isReason .
						welcome:reifiedReasonSTReasonValueMissed rdf:object "STReasonValueMissed"^^xsd:string .
					} WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:UpdateCreateClosingUponFailureUndefinedSlotDIP2Execution_Part2
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure DIP - Missing Mandatory Info - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ClosingUponFailureFarewell welcome:hasSlot welcome:informClosingFailureFarewell .
						welcome:informClosingFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informClosingFailureFarewell welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informClosingFailureFarewell welcome:hasTemplateId "TInformClosingFailureFarewell"^^xsd:string . 
						welcome:informClosingFailureFarewell welcome:hasInputRDFContents welcome:Unknown .
						welcome:informClosingFailureFarewell welcome:hasStatus welcome:Pending .
						welcome:informClosingFailureFarewell welcome:hasNumberAttempts 0 .
						welcome:informClosingFailureFarewell welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informClosingFailureFarewell welcome:isOptional "false"^^xsd:boolean .
						welcome:informClosingFailureFarewell welcome:dependsOn welcome:Unknown .
						welcome:informClosingFailureFarewell welcome:associatedWith welcome:Unknown .
					} WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
    
:ConditionalAnyConfirmInfoNot_UndefinedValue
	a bt:Condition ;
	rdfs:label "Condition: Any Confirmation Not - Undefined Value" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX simulateAppointment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SimulateAppointmentService.owl#>
					PREFIX fullpreregistration: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FullPreregistration.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							?dipName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							?dipName welcome:DIPId ?id .						
							?dipName welcome:hasSlot ?slotName .	
							?slotName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#ConfirmationRequest"^^xsd:anyURI .
							?slotName welcome:hasStatus welcome:Undefined .			
					}"""^^xsd:string ;
		]) .
		
:UpdateCreateContactNGOFarewellSimulationDIP2Execution_Part1
	a bt:Update ;
	rdfs:label "Update: Create Contact NGO Farewell Simulation - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ContactNGOFarewellSimulation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ContactNGOFarewellSimulation welcome:hasDIPStatus welcome:Unknown .
						welcome:ContactNGOFarewellSimulation welcome:isCurrentDIP "true"^^xsd:boolean .
						welcome:ContactNGOFarewellSimulation welcome:belongsTo <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SimulateAppointmentService.owl#simulatePraksisAppointmentService> .
						welcome:ContactNGOFarewellSimulation welcome:hasSlot welcome:informGenericPRAKSISContact, welcome:obtainContactNGOSimulationConfirmation, welcome:flagMoreSimulations .						
					} WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
:UpdateCreateContactNGOFarewellSimulationDIP2Execution_Part2
	a bt:Update ;
	rdfs:label "Update: Create Contact NGO Farewell Simulation - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {											
						welcome:informGenericPRAKSISContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informGenericPRAKSISContact welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informGenericPRAKSISContact welcome:hasTemplateId "TInformInabilityAssistAndContacts"^^xsd:string . 
						welcome:informGenericPRAKSISContact welcome:hasInputRDFContents welcome:Unknown .
						welcome:informGenericPRAKSISContact welcome:hasStatus welcome:Pending .
						welcome:informGenericPRAKSISContact welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informGenericPRAKSISContact welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informGenericPRAKSISContact welcome:isOptional "false"^^xsd:boolean .
						welcome:informGenericPRAKSISContact welcome:dependsOn welcome:Unknown .
						welcome:informGenericPRAKSISContact welcome:associatedWith welcome:Unknown .
					} WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
:UpdateCreateContactNGOFarewellSimulationDIP2Execution_Part3
	a bt:Update ;
	rdfs:label "Update: Create Contact NGO Farewell Simulation - Part 3" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {										
						welcome:obtainContactNGOSimulationConfirmation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
						welcome:obtainContactNGOSimulationConfirmation welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
						welcome:obtainContactNGOSimulationConfirmation welcome:hasTemplateId "TObtainContactNGOSimulationConfirmation"^^xsd:string . 
						welcome:obtainContactNGOSimulationConfirmation welcome:hasInputRDFContents welcome:Unknown .
						welcome:obtainContactNGOSimulationConfirmation welcome:hasStatus welcome:Pending .
						welcome:obtainContactNGOSimulationConfirmation welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:obtainContactNGOSimulationConfirmation welcome:confidenceScore "0.0"^^xsd:float .
						welcome:obtainContactNGOSimulationConfirmation welcome:isOptional "false"^^xsd:boolean .
						welcome:obtainContactNGOSimulationConfirmation welcome:dependsOn welcome:Unknown .
						welcome:obtainContactNGOSimulationConfirmation welcome:associatedWith welcome:Unknown .
					} WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
:UpdateCreateContactNGOFarewellSimulationDIP2Execution_Part4
	a bt:Update ;
	rdfs:label "Update: Create Contact NGO Farewell Simulation - Part 4" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {												
						welcome:flagMoreSimulations rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI .
						welcome:flagMoreSimulations welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#OfficerRoleFlag"^^xsd:anyURI .
						welcome:flagMoreSimulations welcome:hasInputRDFContents welcome:Unknown .
						welcome:flagMoreSimulations welcome:hasStatus welcome:Pending .
						welcome:flagMoreSimulations welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:flagMoreSimulations welcome:confidenceScore "0.0"^^xsd:float .
						welcome:flagMoreSimulations welcome:isOptional "false"^^xsd:boolean .
						welcome:flagMoreSimulations welcome:dependsOn welcome:Unknown .
						welcome:flagMoreSimulations welcome:associatedWith welcome:Unknown .
					} WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:UpdateCreateClosingUponFailureFarewellUnknownDIP_Part1
  a bt:Update ;
  rdfs:label "Update: Create Closing Upon Failure Farewell DIP - Unknown DIP Part 1" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>                    
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
          INSERT {
            welcome:ClosingUponFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            welcome:ClosingUponFailureFarewell welcome:hasDIPStatus welcome:Unknown .
            welcome:ClosingUponFailureFarewell welcome:isCurrentDIP "true"^^xsd:boolean .
            welcome:ClosingUponFailureFarewell welcome:hasSlot welcome:informMessage .
            welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
            welcome:informMessage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
            welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string .            
            welcome:informMessage welcome:hasStatus welcome:Pending .
            welcome:informMessage welcome:hasNumberAttempts 0 .
            welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .
            welcome:informMessage welcome:isOptional "false"^^xsd:boolean . 
            welcome:informMessage welcome:hasInputRDFContents welcome:reifiedReason2  .
            welcome:reifiedReason2 rdf:type rdf:Statement .
            welcome:reifiedReason2 rdf:subject welcome:subTemplate .
            welcome:reifiedReason2 rdf:predicate welcome:isReason .
            welcome:reifiedReason2 rdf:object "STReasonInternalFailure"^^xsd:string .             
          } WHERE { 
            ?a rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .

:UpdateCreateClosingUponFailureFarewellUnknownDIP_Part2
  a bt:Update ;
  rdfs:label "Update: Create Closing Upon Failure Farewell DIP - Unknown DIP Part 2" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>                    
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
          INSERT {
            welcome:ClosingUponFailureFarewell welcome:hasSlot welcome:informClosingFailureFarewell .
            welcome:informClosingFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
            welcome:informClosingFailureFarewell welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
            welcome:informClosingFailureFarewell welcome:hasTemplateId "TInformClosingFailureFarewell"^^xsd:string .            
            welcome:informClosingFailureFarewell welcome:hasStatus welcome:Pending .
            welcome:informClosingFailureFarewell welcome:hasNumberAttempts 0 .
            welcome:informClosingFailureFarewell welcome:confidenceScore "0.0"^^xsd:float .
            welcome:informClosingFailureFarewell welcome:isOptional "false"^^xsd:boolean .  
            welcome:informClosingFailureFarewell welcome:hasInputRDFContents welcome:Unknown  .
          } WHERE { 
            ?a rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .
    
:EventHandlerExecuteFirstReceptionBT
  a bt:HandleEvent ;
  rdfs:label "EventHandler: First Interaction Move" ;
  bt:event agents:FirstReceptionServiceEvent ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>          
            CONSTRUCT {
              welcome:myWelcomeAgent welcome:executeScenario "FirstReception" .
            }
            WHERE { 
              welcome:myWelcomeAgent welcome:executeScenario "FirstReception" .
            }
            """^^xsd:string ;
        ] .
        
:ConditionalObtainRegistrationStatusCompleteAndYesAnswer
  a bt:Condition ;
  rdfs:label "Condition: Obtain Registration Status Complete and Yes Answer?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:ObtainRegistrationStatus rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:ObtainRegistrationStatus welcome:DIPId ?id .
              reception:ObtainRegistrationStatus welcome:hasSlot reception:obtainStatus . 
              reception:obtainStatus welcome:hasInputRDFContents ?RDFContents .
              reception:obtainStatus welcome:hasTCNAnswer ?reifiedAnswer .
              ?reifiedAnswer rdf:type rdf:Statement .
              ?reifiedAnswer rdf:subject ?ReifiSub .
              ?reifiedAnswer rdf:predicate ?ReifiPredi .
              ?reifiedAnswer rdf:object ?answer .
              FILTER (STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "true"))
          }"""^^xsd:string ;
    ]) .

:WriteProposeService2Execution  
  a bt:Write ;
  rdfs:label "Write: Propose Service in Execution" ;
  bt:query [
    	a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:ProposeService welcome:belongsTo reception:FirstReceptionService .
			reception:ProposeService welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:ProposeService welcome:hasDIPStatus welcome:Unknown .
			reception:ProposeService welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:ProposeService .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .

:WriteSSCResultinExecution
  a bt:Write ;
  rdfs:label "Write: SSC Result in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
      PREFIX profile: <http://www.daml.org/services/owl-s/1.1/Profile.owl#>
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      CONSTRUCT { 
        ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
        ?MatchmakerOffer ssc:hasServiceName ?servName .       
      } WHERE  {
        ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
        ?MatchmakerOffer rdf:type service:Service .
        ?MatchmakerOffer service:presents ?profile .
        ?profile profile:serviceName ?servName .
      }"""^^xsd:string ;    
  ] .
  
:UpdateProposeService
  a bt:Update ;
  rdfs:label "Update: Propose Service with SSC Result" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#> 
          DELETE {
            reception:obtainInterest welcome:hasInputRDFContents ?RDFContents .
            ?RDFContents ?ReifiPredi ?ReifiObj .
          }
          INSERT {
            reception:obtainInterest welcome:hasInputRDFContents welcome:reifiedInterest .
            welcome:reifiedInterest rdf:type rdf:Statement .            
            welcome:reifiedInterest rdf:subject welcome:ServiceName .
            welcome:reifiedInterest rdf:predicate welcome:hasValue .
            welcome:reifiedInterest rdf:object ?servName .
          }
          WHERE {   
            reception:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            reception:ProposeService ?rel ?val .
            reception:ProposeService welcome:hasSlot reception:obtainInterest .
            reception:obtainInterest welcome:hasInputRDFContents ?RDFContents .
            ?sscSubj ssc:hasResultOffer ?MatchmakerOffer .
            ?MatchmakerOffer ssc:hasServiceName ?servName . 
            OPTIONAL {
              ?RDFContents ?ReifiPredi ?ReifiObj .
            }         
          }"""^^xsd:string ;
    ]) .

:ConditionalObtainRegistrationStatusCompleteAndNotAnswer
  a bt:Condition ;
  rdfs:label "Condition: Obtain Registration Status Complete and Not Answer?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:ObtainRegistrationStatus rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:ObtainRegistrationStatus welcome:DIPId ?id .
              reception:ObtainRegistrationStatus welcome:hasSlot reception:obtainStatus . 
              reception:obtainStatus welcome:hasInputRDFContents ?RDFContents .
              reception:obtainStatus welcome:hasTCNAnswer ?reifiedAnswer .
              ?reifiedAnswer rdf:type rdf:Statement .
              ?reifiedAnswer rdf:subject ?ReifiSub .
              ?reifiedAnswer rdf:predicate ?ReifiPredi .
              ?reifiedAnswer rdf:object ?answer .
              FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))
          }"""^^xsd:string ;
    ]) .

:WriteObtainRegistrationServiceInfo2Execution
  a bt:Write ;
  rdfs:label "Write: Obtain Registration Service Info in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:ObtainRegistrationServiceInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:ObtainRegistrationServiceInfo welcome:belongsTo reception:FirstReceptionService .
			reception:ObtainRegistrationServiceInfo welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:ObtainRegistrationServiceInfo welcome:hasDIPStatus welcome:Unknown .
			reception:ObtainRegistrationServiceInfo welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:ObtainRegistrationServiceInfo .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .

:ConditionalProposeServiceCompleteAndYes
  a bt:Condition ;
  rdfs:label "Condition: Propose Service DIP Complete? and Yes Answer" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:ProposeService welcome:DIPId ?id .
              reception:ProposeService welcome:hasSlot reception:obtainInterest . 
              reception:obtainInterest welcome:hasInputRDFContents ?RDFContents .
              reception:obtainInterest welcome:hasTCNAnswer ?reifiedAnswer .
              ?reifiedAnswer rdf:type rdf:Statement .
              ?reifiedAnswer rdf:subject ?ReifiSub .
              ?reifiedAnswer rdf:predicate ?ReifiPredi .
              ?reifiedAnswer rdf:object ?answer .
              FILTER (STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "true"))
          }"""^^xsd:string ;
    ]) .

:WriteInformFirstReception2Execution
  a bt:Write ;
  rdfs:label "Write: Inform First Reception in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:InformFirstReceptionService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:InformFirstReceptionService welcome:belongsTo reception:FirstReceptionService .
			reception:InformFirstReceptionService welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:InformFirstReceptionService welcome:hasDIPStatus welcome:Unknown .
			reception:InformFirstReceptionService welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:InformFirstReceptionService .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .

:ConditionalProposeServiceCompleteAndNot
  a bt:Condition ;
  rdfs:label "Condition: Propose Service DIP Complete? and Not Answer" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:ProposeService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:ProposeService welcome:DIPId ?id .
              reception:ProposeService welcome:hasSlot reception:obtainInterest . 
              reception:obtainInterest welcome:hasInputRDFContents ?RDFContents .
              reception:obtainInterest welcome:hasTCNAnswer ?reifiedAnswer .
              ?reifiedAnswer rdf:type rdf:Statement .
              ?reifiedAnswer rdf:subject ?ReifiSub .
              ?reifiedAnswer rdf:predicate ?ReifiPredi .
              ?reifiedAnswer rdf:object ?answer .
              FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))
          }"""^^xsd:string ;
    ]) .

:UpdateCreateInformContactNGO
  a bt:Update ;
  rdfs:label "Update: Create Inform Contact NGO DIP" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>   
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          INSERT {
            welcome:InformContactNGO rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            welcome:InformContactNGO welcome:hasDIPStatus welcome:Unknown .
            welcome:InformContactNGO welcome:hasSlot welcome:informGenericDTASFContact .
            welcome:InformContactNGO welcome:hasSlot welcome:obtainConfirmation .
            welcome:InformContactNGO welcome:isCurrentDIP "true"^^xsd:boolean . 
            welcome:informGenericDTASFContact rdf:type welcome:SystemInfo .
            welcome:informGenericDTASFContact welcome:hasOntologyType welcome:Template .
            welcome:informGenericDTASFContact welcome:hasTemplateId "TInformGenericContact"^^xsd:string .
            welcome:informGenericDTASFContact welcome:hasInputRDFContents welcome:Unknown .
            welcome:informGenericDTASFContact welcome:hasTCNAnswer welcome:Unknown .
            welcome:informGenericDTASFContact welcome:hasStatus welcome:Pending .
            welcome:informGenericDTASFContact welcome:hasNumberAttempts 0 .
            welcome:informGenericDTASFContact welcome:confidenceScore "0.0"^^xsd:float .
            welcome:informGenericDTASFContact welcome:isOptional "false"^^xsd:boolean .
			welcome:informGenericDTASFContact welcome:associatedWith welcome:Unknown .	
			welcome:informGenericDTASFContact welcome:dependsOn welcome:Unknown .
            welcome:obtainConfirmation rdf:type welcome:ConfirmationRequest .
            welcome:obtainConfirmation welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
            welcome:obtainConfirmation welcome:hasTemplateId "TObtainConfirmation"^^xsd:string .
            welcome:obtainConfirmation welcome:hasInputRDFContents welcome:Unknown .
            welcome:obtainConfirmation welcome:hasTCNAnswer welcome:Unknown .
            welcome:obtainConfirmation welcome:hasStatus welcome:Pending .
            welcome:obtainConfirmation welcome:hasNumberAttempts 0 .
            welcome:obtainConfirmation welcome:confidenceScore "0.0"^^xsd:float .
            welcome:obtainConfirmation welcome:isOptional "false"^^xsd:boolean . 
			welcome:obtainConfirmation welcome:associatedWith welcome:Unknown .	
			welcome:obtainConfirmation welcome:dependsOn welcome:Unknown .
          } WHERE {
            ?s rdf:type ajan:Agent .
          }"""^^xsd:string ;
    ]) .

:ConditionalObtainRegistrationServiceInfoComplete
  a bt:Condition ;
  rdfs:label "Condition: Obtain Registration Service Info Complete?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:ObtainRegistrationServiceInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:ObtainRegistrationServiceInfo welcome:DIPId ?id .
          }"""^^xsd:string ;
    ]) .

:WriteInformRegistrationService2Execution
  a bt:Write ;
  rdfs:label "Write: Inform Registration Service in Execution" ;
  bt:query [
   	a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:InformRegistrationService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:InformRegistrationService welcome:belongsTo reception:FirstReceptionService .
			reception:InformRegistrationService welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:InformRegistrationService welcome:hasDIPStatus welcome:Unknown .
			reception:InformRegistrationService welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:InformRegistrationService .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .

:DeletePreviousRegistrationOfficesinExecution
  a bt:Update ;
  rdfs:label "Update: Delete Previous Address Coordinates in Execution" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          DELETE {
            ?tcnIRI welcome:hasClosestRegistrationOffice ?officeIRI . 
            ?tcn rdf:type welcome:DialogueUser . 
            ?tcn welcome:long ?longvalue . 
            ?tcn welcome:lat ?latvalue . 
            ?office rdf:type welcome:RegistrationOffice . 
            ?office ?proOffice ?valOffice . 
          }
          WHERE { 
            OPTIONAL { ?tcnIRI welcome:hasClosestRegistrationOffice ?officeIRI . }
            OPTIONAL { ?tcn rdf:type welcome:DialogueUser . }
            OPTIONAL { ?tcn welcome:long ?longvalue . }
            OPTIONAL { ?tcn welcome:lat ?latvalue . }
            OPTIONAL { 
              ?office rdf:type welcome:RegistrationOffice . 
              ?office ?proOffice ?valOffice .
            }
          }"""^^xsd:string ;
    ]) .

:ConditionalCoordinateExists
  a bt:Condition ;
  rdfs:label "Condition: Coordinates of TCN and Registration Offices Exist?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
          PREFIX locn: <http://www.w3.org/ns/locn#>
          PREFIX daml: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#>
          ASK
          WHERE {
            ?tcn rdf:type welcome:DialogueUser .
            ?tcn welcome:hasCity ?city .
            ?city welcome:lat ?lat .
            ?city welcome:long ?long .
            ?office rdf:type welcome:RegistrationOffice .
            ?office locn:address ?address .
            ?address daml:physicalAddress ?value .
            ?address welcome:lat ?latOffice .
            ?address welcome:long ?longOffice .
          }"""^^xsd:string ;
    ]) .
    
:WriteCoordinatesinExecution
  a bt:Write ;
  rdfs:label "Write: TCN Address and Registration Office Coordinates in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      PREFIX locn: <http://www.w3.org/ns/locn#>
      PREFIX daml: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#>
      CONSTRUCT  {
        ?tcn rdf:type welcome:DialogueUser .
        ?tcn welcome:long ?long .
        ?tcn welcome:lat ?lat .
        ?office rdf:type welcome:RegistrationOffice .
        ?office locn:address ?address .
        ?office daml:physicalAddress ?value .
        ?office welcome:lat ?latOffice .
        ?office welcome:long ?longOffice .    
      }
      WHERE {
        ?tcn rdf:type welcome:DialogueUser .
        ?tcn welcome:hasCity ?city .
        ?city welcome:lat ?lat .
        ?city welcome:long ?long .
        ?office rdf:type welcome:RegistrationOffice .
        ?office locn:address ?address .
        ?address daml:physicalAddress ?value .
        ?address welcome:lat ?latOffice .
        ?address welcome:long ?longOffice .
      }"""^^xsd:string ;
  ] .

:InvokeClosestDistancePlugin
  a welcomePlugin:ClosestLocation ;
  rdfs:label "Welcome Plugin:Calculate Closest Registration Office" ;
  welcomePlugin:tcnLocation [
      a bt:ConstructQuery ;
      bt:originBase ajan:ExecutionKnowledge ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>            
          CONSTRUCT {
            ?tcn rdf:type welcome:DialogueUser .
            ?tcn welcome:long ?longvalue .
            ?tcn welcome:lat ?latvalue .
          }
          WHERE { 
            ?tcn rdf:type welcome:DialogueUser .
          ?tcn welcome:long ?longvalue .
            ?tcn welcome:lat ?latvalue .    
          }"""^^xsd:string ;
  ] ;
  welcomePlugin:registrationOfficeLocation [
      a bt:ConstructQuery ;
      bt:originBase ajan:ExecutionKnowledge ;
      bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          PREFIX locn: <http://www.w3.org/ns/locn#> 
          PREFIX actor: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#> 
          CONSTRUCT {
            ?office rdf:type welcome:RegistrationOffice .
            ?office locn:address ?address .
            ?office actor:physicalAddress ?value .
            ?office welcome:lat ?latval .
            ?office welcome:long ?longval . 
          }
          WHERE { 
            ?office rdf:type welcome:RegistrationOffice .
            ?office locn:address ?address .
            ?office actor:physicalAddress ?value .
            ?office welcome:lat ?latval .
            ?office welcome:long ?longval .       
          }"""^^xsd:string ;
  ] .

:WriteDefaultOfficeinExecution
  a bt:Write ;
  rdfs:label "Write: Default Registration Office Coordinates in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      PREFIX locn: <http://www.w3.org/ns/locn#>
      PREFIX daml: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#>
      PREFIX actor: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#>
      CONSTRUCT  {
        ?tcn welcome:hasClosestRegistrationOffice ?officeName .
        ?officeName locn:address ?address .
        ?officeName daml:physicalAddress ?physicalAddressValue .
      }
      WHERE {
            ?tcn rdf:type welcome:DialogueUser .
            ?tcn welcome:hasCountry ?tcn_country .
            ?tcn_country welcome:hasValue ?value .
            ?officeName rdf:type welcome:RegistrationOffice .
            ?officeName locn:address ?address .
            ?address welcome:hasCountry ?country .
            ?address actor:physicalAddress ?physicalAddressValue .
            ?country welcome:countryName ?name .
  			FILTER(?value = ?name)
        } LIMIT 3 """^^xsd:string ;
  ] .
  
:UpdateInformRegistrationServiceDIP
  a bt:Update ;
  rdfs:label "Update: Closest Office in Inform Registration Service DIP" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX daml: <http://www.daml.org/services/owl-s/1.1/ActorDefault.owl#>
          PREFIX locn: <http://www.w3.org/ns/locn#>
          DELETE {
            reception:informOfficeAddress welcome:hasInputRDFContents ?RDFContents .
            ?RDFContents ?proRDFContents ?valRDFContents .
          }
          INSERT{
            reception:informOfficeAddress welcome:hasInputRDFContents welcome:rdfInformClosestOffice .
            welcome:rdfInformClosestOffice a rdf:Statement .
            welcome:rdfInformClosestOffice rdf:subject welcome:Address .
            welcome:rdfInformClosestOffice rdf:predicate welcome:hasValue .
            welcome:rdfInformClosestOffice rdf:object ?value .
          }
          WHERE { 
            reception:InformRegistrationService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
            reception:InformRegistrationService welcome:hasSlot reception:informOfficeAddress .
            reception:informOfficeAddress welcome:hasInputRDFContents ?RDFContents .
            ?tcnIRI welcome:hasClosestRegistrationOffice ?officeIRI .
            ?officeIRI locn:address ?address .
            ?officeIRI daml:physicalAddress ?value .
            OPTIONAL {
              ?RDFContents ?proRDFContents ?valRDFContents .
            }
          }"""^^xsd:string ;
    ]) .

:ConditionalInformRegistrationServiceComplete
  a bt:Condition ;
  rdfs:label "Condition: Inform Registration Service Complete?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:InformRegistrationService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:InformRegistrationService welcome:DIPId ?id . 
          }"""^^xsd:string ;
    ]) .
    
:EventProducerNormalClosingScenario
  a bt:EventProducer ;
  rdfs:label "EventProducer: Alternataive Normal Closing Scenario" ;
  ajan:event <http://localhost:8090/rdf4j/repositories/agents#AlternativeCloseScenarioEvent> ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:AgentKnowledge;
          bt:sparql """
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            CONSTRUCT {
              welcome:DTASF welcome:hasAlternativeClosing "true" . 
            }
            WHERE {
              ?s rdf:type ajan:Agent . 
            }"""^^xsd:string ;
        ] . 

:ConditionalInformFirstReceptionServiceCompleteAndYesAnswer
  a bt:Condition ;
  rdfs:label "Condition: Inform First Reception DIP Complete? and Yes Answer" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>          
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:InformFirstReceptionService rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:InformFirstReceptionService welcome:DIPId ?id .
              reception:InformFirstReceptionService welcome:hasSlot reception:obtainInterestRegistration .
              reception:obtainInterestRegistration welcome:hasTCNAnswer ?reifiedAnswer . 
              ?reifiedAnswer rdf:type rdf:Statement .
              ?reifiedAnswer rdf:subject ?ReifiSub .
              ?reifiedAnswer rdf:predicate ?ReifiPredi .
              ?reifiedAnswer rdf:object ?answer .
              FILTER (STRENDS(str(?answer), "True") || STRENDS(str(?answer), "true") || STRENDS(str(?answer), "yes") || STRENDS(str(?answer), "Yes"))
          }"""^^xsd:string ;
  ]) .

:WritePersonalInfoFirstReceptionDIP2Execution
  a bt:Write ;
  rdfs:label "Write: Personal Info DIP in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:FillFormPersonalInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:FillFormPersonalInfo welcome:belongsTo reception:FirstReceptionService .
			reception:FillFormPersonalInfo welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:FillFormPersonalInfo welcome:hasDIPStatus welcome:Unknown .
			reception:FillFormPersonalInfo welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:FillFormPersonalInfo .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .
  
:ConditionalPersonalInfoComplete
  a bt:Condition ;
  rdfs:label "Condition: Personal Info DIP Complete?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>          
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:FillFormPersonalInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:FillFormPersonalInfo welcome:DIPId ?id .
          }"""^^xsd:string ;
  ]) .
  
:WriteAddressInfoDIP2Execution
  a bt:Write ;
  rdfs:label "Write: Address Info DIP in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:FillFormAddressInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:FillFormAddressInfo welcome:belongsTo reception:FirstReceptionService .
			reception:FillFormAddressInfo welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:FillFormAddressInfo welcome:hasDIPStatus welcome:Unknown .
			reception:FillFormAddressInfo welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:FillFormAddressInfo .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .

:ConditionalAddressInfoDIPComplete
  a bt:Condition ;
  rdfs:label "Condition: Address Info DIP Complete?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>          
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:FillFormAddressInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:FillFormAddressInfo welcome:DIPId ?id .
          }"""^^xsd:string ;
  ]) .

:WriteFillFormOtherDIP2Execution
  a bt:Write ;
  rdfs:label "Write: Fill Form Other Info DIP in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:FillFormOther rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:FillFormOther welcome:belongsTo reception:FirstReceptionService .
			reception:FillFormOther welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:FillFormOther welcome:hasDIPStatus welcome:Unknown .
			reception:FillFormOther welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:FillFormOther .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .

:ConditionalFillFormOtherDIPComplete
  a bt:Condition ;
  rdfs:label "Condition: Other Info DIP Complete?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>          
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:FillFormOther rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:FillFormOther welcome:DIPId ?id .
          }"""^^xsd:string ;
  ]) .
  
:WriteFillFormModulesDIP2Execution
  a bt:Write ;
  rdfs:label "Write: Fill Form Modules DIP in Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:FillFormModules rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:FillFormModules welcome:belongsTo reception:FirstReceptionService .
			reception:FillFormModules welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:FillFormModules welcome:hasDIPStatus welcome:Unknown .
			reception:FillFormModules welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:FillFormModules .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .
  
:ConditionalFillFormModulesDIPComplete
  a bt:Condition ;
  rdfs:label "Condition: Fill Form Modules DIP Complete?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>          
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:FillFormModules rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:FillFormModules welcome:DIPId ?id .
          }"""^^xsd:string ;
  ]) .
  
:WriteFillFormCourseDIP2Execution
  a bt:Write ;
  rdfs:label "Write: Fill Course Info DIP in Execution" ;
  bt:query [
   a bt:ConstructQuery ;
    bt:originBase ajan:LocalServicesKnowledge ;
	bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
      PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
	  PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
	  PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
      PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
      PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
      CONSTRUCT  {
			reception:FillFormCourse rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
			reception:FillFormCourse welcome:belongsTo reception:FirstReceptionService .
			reception:FillFormCourse welcome:isCurrentDIP "true"^^xsd:boolean .
			reception:FillFormCourse welcome:hasDIPStatus welcome:Unknown .
			reception:FillFormCourse welcome:hasSlot ?input .
			?input rdf:type ?slotType .
			?input welcome:hasOntologyType ?paramTypeInput .
			?input welcome:hasTemplateId ?templateIdInput .						
			?input welcome:isOptional ?optionalInput .
			?input welcome:hasInputRDFContents welcome:Unknown .
			?input welcome:hasTCNAnswer welcome:Unknown .
			?input welcome:hasStatus welcome:Pending .
			?input welcome:dependsOn ?dependency .
			?input welcome:associatedWith ?association .
			?input welcome:hasNumberAttempts 0 .
			?input welcome:confidenceScore "0.0"^^xsd:float .	
      }
      WHERE {
			reception:FirstReceptionService rdf:type service:Service .
			reception:FirstReceptionService service:describedBy ?process . 
			?process process:hasInput ?input .
			?input process:parameterType ?paramTypeInput .
			?input welcome:hasDIP reception:FillFormCourse .
			?input welcome:hasSlotType ?slotType .
			?input welcome:isOptional ?optionalInput .							
			OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
			OPTIONAL {?input welcome:dependsOn ?val}
			OPTIONAL {?input welcome:associatedWith ?asso}
			BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
			BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	        
	}"""^^xsd:string ;
  ] .
  
:ConditionalFillFormCourseDIPComplete
  a bt:Condition ;
  rdfs:label "Condition: Fill Form Course DIP Complete?" ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>          
          PREFIX reception: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/FirstReceptionService.owl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          ASK
          WHERE {
              ?bt welcome:hasActiveDIP ?id . 
              reception:FillFormCourse rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
              reception:FillFormCourse welcome:DIPId ?id .
          }"""^^xsd:string ;
  ]) .

:UpdateCreateHeaderAppNotificationMessage
  a bt:Update ;
  rdfs:label "Update: Header App Notification Message" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          DELETE {
            ?subjectHeaderName welcome:hasHeaderName ?headerName . 
            ?subjectHeaderValue welcome:hasHeaderValue ?headerValue .
          }
          INSERT {
            welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
            welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
            welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
            welcome:headerUserID welcome:hasHeaderValue ?id .  
			welcome:headerMsgType welcome:hasHeaderName "X-Msg-Type" .
			welcome:headerMsgType welcome:hasHeaderValue "DisplayUI" .			
          } 
          WHERE { 
            ?msg welcome:hasCorrelationID ?correlationID .
            ?du rdf:type welcome:DialogueUser .
            ?du welcome:hasUserId ?idObject .
            ?idObject welcome:hasValue ?id .
            OPTIONAL { ?subjectHeaderName welcome:hasHeaderName ?headerName . }
            OPTIONAL { ?subjectHeaderValue welcome:hasHeaderValue ?headerValue .}
          }
          """^^xsd:string ;
    ]) .
    
:SendNotification2App
  a myWelcome:Message ;
  rdfs:label "Message: Send Notification to App to Retrieve Content"^^xsd:string ;
  rdfs:comment "Message: Send Notification to App to Retrieve Content"^^xsd:string ;
  bt:targetBase ajan:AgentKnowledge ;  
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
          SELECT ?hdrName ?fieldValue
          WHERE {
              ?headerName welcome:hasHeaderName ?hdrName .
              ?headerName welcome:hasHeaderValue ?fieldValue .
          }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;            
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle;charset=UTF-8"^^xsd:string 
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "application/ld+json"
        ]
    ) ; 
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            CONSTRUCT {
              welcome:app welcome:retrieveFormContent "true" .
            }
            WHERE {
              ?s rdf:type ajan:Agent .
            }"""^^xsd:string
      ]
    ] ;    
  ] ;
  bt:queryUri [
  a bt:SelectQuery ;
  a bt:QueryUri ;
  bt:originBase ajan:AgentKnowledge ;
  bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT ?requestURI 
        WHERE
        {
          welcome:dispatcher welcome:hasAddress ?partialAddress .
          BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
        }"""^^xsd:string
  ] . 
# bt:queryUri [
# a bt:SelectQuery ;
# a bt:QueryUri ;
# bt:originBase ajan:AgentKnowledge ;  
# bt:sparql """
#       PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#       PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#       SELECT ?requestURI 
#       WHERE
#       {
#         welcome:dispatcher welcome:hasAddress ?partialAddress .
#         BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#       }"""^^xsd:string
# ] .

:EventHandlerNormalClosingScenario
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Normal Closing Scenario" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#CloseScenarioEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>         
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:TCN_Profile welcome:updated "true" .      
            }
            WHERE { 
              welcome:TCN_Profile welcome:updated "true" .            
            }"""^^xsd:string ;
        ] .

:EventHandlerAlternativeClosingScenario
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Alternative Normal Closing Scenario" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#AlternativeCloseScenarioEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>         
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              welcome:DTASF welcome:hasAlternativeClosing "true" .      
            }
            WHERE { 
              welcome:DTASF welcome:hasAlternativeClosing "true" .          
            }"""^^xsd:string ;
        ] .
        
#=============================================================================================
# CVCreation

:EventHandlerCVNotification
	a bt:HandleEvent ;
	rdfs:label "EventHandler: CV Created in the App" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#ReceiveKMSNotificationS7Event> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
								PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
								PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
								PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
								PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
								CONSTRUCT {
									welcome:KMSNotifies ?pre ?boolVal .
								}
								WHERE { 
									welcome:KMSNotifies ?pre ?boolVal .
								}"""^^xsd:string ;
				] .

:WriteNotificationToExecution
	a bt:Write ;
	rdfs:label "Write: KMS S7 Notification from LAKR to Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					CONSTRUCT  {
						welcome:KMSNotifies ?pred ?val .
					}
					WHERE {
						 welcome:KMSNotifies ?pred ?val .		
					}"""^^xsd:string ;
	] .
	
:DeleteS7NotificationFromLAKR
	a bt:Update ;
	rdfs:label "Update: Delete S7 Notification from LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>					
					DELETE {
						welcome:KMSNotifies ?pred ?val .
					} 
					WHERE { 
						welcome:KMSNotifies ?pred ?val .
					}"""^^xsd:string ;
		]) .


:ConditionIsPersonalInfoFinished
	a bt:Condition ;
	rdfs:label "Condition: Was the Personal Info Finished?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							welcome:KMSNotifies welcome:PersonalInfo "true" .									
					}"""^^xsd:string ;
		]) .

:UpdateCreateHeaderAppMessageDisplay
	a bt:Update ;
	rdfs:label "Update: Header Message for App - Display " ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE{
						?headerSubject welcome:hasHeaderValue ?typeval .
						?headerValSubject welcome:hasHeaderValue ?typeHeaderval .
					}
					INSERT {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?id .					
						welcome:headerMsgType welcome:hasHeaderName "X-Msg-Type" .
						welcome:headerMsgType welcome:hasHeaderValue "DisplayUI" .
					} 
					WHERE { 
						?du rdf:type welcome:DialogueUser .
						?msg welcome:hasCorrelationID ?correlationID .
						?du welcome:hasUserId ?idObject .
						?idObject welcome:hasValue ?id .
						OPTIONAL {?headerSubject welcome:hasHeaderValue ?typeval .}
						OPTIONAL {?headerValSubject welcome:hasHeaderValue ?typeHeaderval .}
					}
					"""^^xsd:string ;
		]) .
		
:MessageSendPersonalInfoSectionToApp 
	a myWelcome:Message ;
	rdfs:label "Message: Send Personal Info Section to App"^^xsd:string ;
	rdfs:comment "Message: Send Personal Info Section to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							welcome:app welcome:displayPersonalInfoSection "true" . 
						}
						WHERE {
							welcome:KMSNotifies ?pred ?val .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .

:ConditionIsEducationInformationFinished
	a bt:Condition ;
	rdfs:label "Condition: Was the Education Information Finished?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							welcome:KMSNotifies welcome:EducationInformation "true" .									
					}"""^^xsd:string ;
		]) .
		
:MessageSendEducationInformationSectionToApp
	a myWelcome:Message ;
	rdfs:label "Message: Education Information Section to App"^^xsd:string ;
	rdfs:comment "Message: Education Information Section to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							welcome:app welcome:displayEducationInformationSection "true" . 
						}
						WHERE {
							welcome:KMSNotifies ?pred ?val .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .

:ConditionIsOtherEducationInformationFinished
	a bt:Condition ;
	rdfs:label "Condition: Was the Other Education Information Finished?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							welcome:KMSNotifies welcome:OtherEducationInformation "true" .									
					}"""^^xsd:string ;
		]) .
		
:MessageSendOtherEducationInformationSectionToApp 
	a myWelcome:Message ;
	rdfs:label "Message: Send Other Education Information Section to App"^^xsd:string ;
	rdfs:comment "Message: Send Other Education Information Section to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							welcome:app welcome:displayOtherEducationInformationSection "true" . 
						}
						WHERE {
							welcome:KMSNotifies ?pred ?val .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .

:ConditionIsLanguageInformationFinished
	a bt:Condition ;
	rdfs:label "Condition: Was the Language Information Finished?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							welcome:KMSNotifies welcome:LanguageInformation "true" .									
					}"""^^xsd:string ;
		]) .
		
:MessageSendLanguageInformationSectionToApp
	a myWelcome:Message ;
	rdfs:label "Message: Send Language Information Section to App"^^xsd:string ;
	rdfs:comment "Message: Send Language Information Section to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							welcome:app welcome:displayLanguageInformationSection "true" . 
						}
						WHERE {
							welcome:KMSNotifies ?pred ?val .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .

:ConditionIsEmploymentInformationFinished
	a bt:Condition ;
	rdfs:label "Condition: Was the Employment Information Finished?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							welcome:KMSNotifies welcome:EmploymentInformation "true" .									
					}"""^^xsd:string ;
		]) .
		
:MessageSendEmploymentInformationSectionToApp 
	a myWelcome:Message ;
	rdfs:label "Message: Send Employment Information Section to App"^^xsd:string ;
	rdfs:comment "Message: Send Employment Information Section to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							welcome:app welcome:displayEmploymentInformationSection "true" . 
						}
						WHERE {
							welcome:KMSNotifies ?pred ?val .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .

:ConditionIsSkillInformationFinished
	a bt:Condition ;
	rdfs:label "Condition: Was the Skill Information Finished?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							welcome:KMSNotifies welcome:SkillInformation "true" .									
					}"""^^xsd:string ;
		]) .
		
:ConditionIsOtherInformationFinished
	a bt:Condition ;
	rdfs:label "Condition: Was the Other Information Finished?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							welcome:KMSNotifies welcome:OtherInformation "true" .									
					}"""^^xsd:string ;
		]) .
		
:MessageSendOtherInformationSectionToApp
	a myWelcome:Message ;
	rdfs:label "Message: Send Other Information Section to App"^^xsd:string ;
	rdfs:comment "Message: Send Other Information Section to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							welcome:app welcome:displayOtherInformationSection "true" . 
						}
						WHERE {
							welcome:KMSNotifies ?pred ?val .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .

:EventHandlerExecuteCVCreationBT
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Executing CV Creation Move" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#CVCreationEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
								PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
								PREFIX ajan: <http://www.ajan.de/ajan-ns#>
								PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
								CONSTRUCT {
									welcome:myWelcomeAgent welcome:executeScenario "CVCreation" .
								}
								WHERE { 
									welcome:myWelcomeAgent welcome:executeScenario "CVCreation" .
								}"""^^xsd:string ;
				] .
				
:ConditionalCVPurposeInterestYes
	a bt:Condition ;
	rdfs:label "Condition: CV Purpose Complete and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:CVPurpose rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:CVPurpose welcome:DIPId ?id .						
							employment:CVPurpose welcome:hasSlot employment:obtainCVCreationInterest .	
							employment:obtainCVCreationInterest welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))															
					}"""^^xsd:string ;
		]) .
		
:WritePersonalInfoDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Personal Info DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						employment:PersonalInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:PersonalInfo welcome:belongsTo employment:createCV .
						employment:PersonalInfo welcome:isCurrentDIP "true"^^xsd:boolean .
						employment:PersonalInfo welcome:hasDIPStatus welcome:Unknown .
						employment:PersonalInfo welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						employment:createCV rdf:type service:Service .
						employment:createCV service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP employment:PersonalInfo .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .

:ConditionalCVPurposeInterestNot
	a bt:Condition ;
	rdfs:label "Condition: CV Purpose and Confirmation Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:CVPurpose rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:CVPurpose welcome:DIPId ?id .						
							employment:CVPurpose welcome:hasSlot employment:obtainCVCreationInterest .	
							employment:obtainCVCreationInterest welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "False"))					
						}"""^^xsd:string ;
		]) .

:UpdateCreateInformContactNGOFarewell_GENERIC_DIP2Execution_Part1
	a bt:Update ;
	rdfs:label "Update: Create Inform Contact NGO Generic Farewell DIP - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 	
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ContactNGOFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ContactNGOFarewell welcome:hasDIPStatus welcome:Unknown .
						welcome:ContactNGOFarewell welcome:isCurrentDIP "true"^^xsd:boolean . 
						welcome:ContactNGOFarewell welcome:hasSlot welcome:informInabilityAssist .						
						welcome:informInabilityAssist rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .	
						welcome:informInabilityAssist welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .	
						welcome:informInabilityAssist welcome:hasTemplateId "TInformInabilityAssist"^^xsd:string .
						welcome:informInabilityAssist welcome:hasInputRDFContents welcome:Unknown .
						welcome:informInabilityAssist welcome:hasTCNAnswer welcome:Unknown .
						welcome:informInabilityAssist welcome:hasStatus welcome:Pending .
						welcome:informInabilityAssist welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informInabilityAssist welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informInabilityAssist welcome:isOptional "false"^^xsd:boolean .
						welcome:informInabilityAssist welcome:dependsOn welcome:Unknown .
						welcome:informInabilityAssist welcome:associatedWith welcome:Unknown .	
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
:UpdateCreateInformContactNGOFarewell_GENERIC_DIP2Execution_Part2
	a bt:Update ;
	rdfs:label "Update: Create Inform Contact NGO Generic Farewell DIP - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 	
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ContactNGOFarewell welcome:hasSlot welcome:informGenericContact .						
						welcome:informGenericContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .	
						welcome:informGenericContact welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .	
						welcome:informGenericContact welcome:hasTemplateId "TInformGenericContact"^^xsd:string .
						welcome:informGenericContact welcome:hasInputRDFContents welcome:Unknown .
						welcome:informGenericContact welcome:hasTCNAnswer welcome:Unknown .
						welcome:informGenericContact welcome:hasStatus welcome:Pending .
						welcome:informGenericContact welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informGenericContact welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informGenericContact welcome:isOptional "false"^^xsd:boolean .
						welcome:informGenericContact welcome:dependsOn welcome:Unknown .
						welcome:informGenericContact welcome:associatedWith welcome:Unknown .	
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:UpdateCreateInformContactNGOFarewell_GENERIC_DIP2Execution_Part3
	a bt:Update ;
	rdfs:label "Update: Create Inform Contact NGO Generic Farewell DIP - Part 3" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 	
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {								
						welcome:ContactNGOFarewell welcome:hasSlot welcome:informContactNGOFarewell .
						welcome:informContactNGOFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .	
						welcome:informContactNGOFarewell welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .	
						welcome:informContactNGOFarewell welcome:hasTemplateId "TInformNormalClosingFarewell"^^xsd:string .
						welcome:informContactNGOFarewell welcome:hasInputRDFContents welcome:Unknown .
						welcome:informContactNGOFarewell welcome:hasTCNAnswer welcome:Unknown .
						welcome:informContactNGOFarewell welcome:hasStatus welcome:Pending .
						welcome:informContactNGOFarewell welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informContactNGOFarewell welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informContactNGOFarewell welcome:isOptional "false"^^xsd:boolean .	
						welcome:informContactNGOFarewell welcome:dependsOn welcome:Unknown .
						welcome:informContactNGOFarewell welcome:associatedWith welcome:Unknown .
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
:ConditionalPersonalInfoConfirmationYes
	a bt:Condition ;
	rdfs:label "Condition: Personal Info and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:PersonalInfo rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:PersonalInfo welcome:DIPId ?id .						
							employment:PersonalInfo welcome:hasSlot employment:obtainPersonalInfoConfirmation .	
							employment:obtainPersonalInfoConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))															
					}"""^^xsd:string ;
		]) .

:WriteEducationInformationDIP2Execution 
	a bt:Write ;
	rdfs:label "Write: Education Information DIP in Execution" ;
	bt:query [
			a bt:ConstructQuery ;
			bt:originBase ajan:LocalServicesKnowledge ;
			bt:targetBase ajan:ExecutionKnowledge ;
			bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
				PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
				PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
				PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
				PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
				PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
				CONSTRUCT  {
							employment:EducationInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:EducationInformation welcome:belongsTo employment:createCV .
							employment:EducationInformation welcome:isCurrentDIP "true"^^xsd:boolean .
							employment:EducationInformation welcome:hasDIPStatus welcome:Unknown .
							employment:EducationInformation welcome:hasSlot ?input .
							?input rdf:type ?slotType .
							?input welcome:hasOntologyType ?paramTypeInput .
							?input welcome:hasTemplateId ?templateIdInput .						
							?input welcome:isOptional ?optionalInput .
							?input welcome:hasInputRDFContents welcome:Unknown .
							?input welcome:hasTCNAnswer welcome:Unknown .
							?input welcome:hasStatus welcome:Pending .
							?input welcome:dependsOn ?dependency .
							?input welcome:associatedWith ?association .
							?input welcome:hasNumberAttempts 0 .
							?input welcome:confidenceScore "0.0"^^xsd:float .					
				}
				WHERE { 
						{
							employment:createCV rdf:type service:Service .
							employment:createCV service:describedBy ?process . 
							?process process:hasInput ?input .
							?input process:parameterType ?paramTypeInput .
							?input welcome:hasDIP employment:EducationInformation .
							?input welcome:hasSlotType ?slotType .
							?input welcome:isOptional ?optionalInput .							
							OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
							OPTIONAL {?input welcome:dependsOn ?val}
							OPTIONAL {?input welcome:associatedWith ?asso}
							BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
							BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
						}
				} """^^xsd:string ;
	] .
	
:ConditionalEducationInformationConfirmationYes
	a bt:Condition ;
	rdfs:label "Condition: Education Information Complete and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:EducationInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:EducationInformation welcome:DIPId ?id .						
							employment:EducationInformation welcome:hasSlot employment:obtainEducationalInformationConfirmation .	
							employment:obtainEducationalInformationConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))															
					}"""^^xsd:string ;
		]) .

:WriteOtherEducationInformationDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Other Language Information DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
			bt:originBase ajan:LocalServicesKnowledge ;
			bt:targetBase ajan:ExecutionKnowledge ;
			bt:sparql """
				PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
				PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
				PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
				PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
				PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
				PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
				PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
				CONSTRUCT  {
							employment:OtherEducationInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:OtherEducationInformation welcome:belongsTo employment:createCV .
							employment:OtherEducationInformation welcome:isCurrentDIP "true"^^xsd:boolean .
							employment:OtherEducationInformation welcome:hasDIPStatus welcome:Unknown .
							employment:OtherEducationInformation welcome:hasSlot ?input .
							?input rdf:type ?slotType .
							?input welcome:hasOntologyType ?paramTypeInput .
							?input welcome:hasTemplateId ?templateIdInput .						
							?input welcome:isOptional ?optionalInput .
							?input welcome:hasInputRDFContents welcome:Unknown .
							?input welcome:hasTCNAnswer welcome:Unknown .
							?input welcome:hasStatus welcome:Pending .
							?input welcome:dependsOn ?dependency .
							?input welcome:associatedWith ?association .
							?input welcome:hasNumberAttempts 0 .
							?input welcome:confidenceScore "0.0"^^xsd:float .					
				}
				WHERE { 
						{
							employment:createCV rdf:type service:Service .
							employment:createCV service:describedBy ?process . 
							?process process:hasInput ?input .
							?input process:parameterType ?paramTypeInput .
							?input welcome:hasDIP employment:OtherEducationInformation .
							?input welcome:hasSlotType ?slotType .
							?input welcome:isOptional ?optionalInput .							
							OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
							OPTIONAL {?input welcome:dependsOn ?val}
							OPTIONAL {?input welcome:associatedWith ?asso}
							BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
							BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
						}
				} """^^xsd:string ;
	] .
	
:ConditionalOtherEducationInformationConfirmationYes
	a bt:Condition ;
	rdfs:label "Condition: Other Education Information Complete and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:OtherEducationInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:OtherEducationInformation welcome:DIPId ?id .						
							employment:OtherEducationInformation welcome:hasSlot employment:obtainMoreEducationalInformationConfirmation .	
							employment:obtainMoreEducationalInformationConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))															
					}"""^^xsd:string ;
		]) .
		
:WriteLanguageInformationDIP2Execution 
	a bt:Write ;
	rdfs:label "Write: Language Information DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						employment:LanguageInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:LanguageInformation welcome:belongsTo employment:createCV .
						employment:LanguageInformation welcome:isCurrentDIP "true"^^xsd:boolean .
						employment:LanguageInformation welcome:hasDIPStatus welcome:Unknown .
						employment:LanguageInformation welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						employment:createCV rdf:type service:Service .
						employment:createCV service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP employment:LanguageInformation .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalLanguageInformationConfirmationYes
	a bt:Condition ;
	rdfs:label "Condition: Language Information Complete and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:LanguageInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:LanguageInformation welcome:DIPId ?id .						
							employment:LanguageInformation welcome:hasSlot employment:obtainLanguageInformationConfirmation .	
							employment:obtainLanguageInformationConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))															
					}"""^^xsd:string ;
		]) .
		
:WriteEmploymentInformationDIP2Execution 
	a bt:Write ;
	rdfs:label "Write: Employment Information DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						employment:EmploymentInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:EmploymentInformation welcome:belongsTo employment:createCV .
						employment:EmploymentInformation welcome:isCurrentDIP "true"^^xsd:boolean .
						employment:EmploymentInformation welcome:hasDIPStatus welcome:Unknown .
						employment:EmploymentInformation welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						employment:createCV rdf:type service:Service .
						employment:createCV service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP employment:EmploymentInformation .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalEmploymentInformationConfirmationYes
	a bt:Condition ;
	rdfs:label "Condition: Employment Information Complete and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:EmploymentInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:EmploymentInformation welcome:DIPId ?id .						
							employment:EmploymentInformation welcome:hasSlot employment:obtainEmploymentInformationConfirmation .	
							employment:obtainEmploymentInformationConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))															
					}"""^^xsd:string ;
		]) .

:UpdateCreateHeaderAppMessageSkillList
	a bt:Update ;
	rdfs:label "Update: Header Message for App - Skill list" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE{
						?headerNameSubject welcome:hasHeaderName ?headerValName . 
						?headerValSubject welcome:hasHeaderValue ?headerVal . 
					}
					INSERT {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?id .					
						welcome:headerMsgType welcome:hasHeaderName "X-Msg-Type" .
						welcome:headerMsgType welcome:hasHeaderValue "CVSkills" .						
					} 
					WHERE { 
						?msg welcome:hasCorrelationID ?correlationID .
						?du rdf:type welcome:DialogueUser .
						?du welcome:hasUserId ?idObject .
						?idObject welcome:hasValue ?id .
						OPTIONAL { ?headerNameSubject welcome:hasHeaderName ?headerValName . }
						OPTIONAL { ?headerValSubject welcome:hasHeaderValue ?headerVal . }
					}
					"""^^xsd:string ;
		]) .
		
:MessageSendSkillNotificationtoApp
	a myWelcome:Message ;
	rdfs:label "Message: Send Skill List to App"^^xsd:string ;
	rdfs:comment "Message: Send Skill List to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							welcome:notificationTitle welcome:displaySkillList "true" . 
						}
						WHERE {
							welcome:KMSNotifies ?p ?o .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .

:WriteSkillInformationDIP2Execution 
	a bt:Write ;
	rdfs:label "Write: Skill Information DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						employment:SkillInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:SkillInformation welcome:belongsTo employment:createCV .
						employment:SkillInformation welcome:isCurrentDIP "true"^^xsd:boolean .
						employment:SkillInformation welcome:hasDIPStatus welcome:Unknown .
						employment:SkillInformation welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						employment:createCV rdf:type service:Service .
						employment:createCV service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP employment:SkillInformation .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalSkillInformation
	a bt:Condition ;
	rdfs:label "Condition: Skill Information Complete and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:SkillInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:SkillInformation welcome:DIPId ?id .					
					}"""^^xsd:string ;
		]) .
		
:WriteOtherInformationDIP2Execution 
	a bt:Write ;
	rdfs:label "Write: Other Information DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						employment:OtherInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:OtherInformation welcome:belongsTo employment:createCV .
						employment:OtherInformation welcome:isCurrentDIP "true"^^xsd:boolean .
						employment:OtherInformation welcome:hasDIPStatus welcome:Unknown .
						employment:OtherInformation welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						employment:createCV rdf:type service:Service .
						employment:createCV service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP employment:OtherInformation .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalOtherInformationConfirmationYes
	a bt:Condition ;
	rdfs:label "Condition: Other Information Complete and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:OtherInformation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:OtherInformation welcome:DIPId ?id .						
							employment:OtherInformation welcome:hasSlot employment:obtainOtherInformationConfirmation .	
							employment:obtainOtherInformationConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))															
					}"""^^xsd:string ;
		]) .

:MessageSendCVCreatedNotificationtoApp
	a myWelcome:Message ;
	rdfs:label "Message: Send CV Created Notification to App"^^xsd:string ;
	rdfs:comment "Message: Send Send CV Created Notification to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>		
						CONSTRUCT {
							welcome:app welcome:displayCVButton "true" . 
						}
						WHERE {
							?bt welcome:hasActiveDIP ?id . 
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .
		
:WriteCreateCVDocumentDIP2Execution 
	a bt:Write ;
	rdfs:label "Write: Create CV Document DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			CONSTRUCT  {
						employment:CreateCVDocument rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						employment:CreateCVDocument welcome:belongsTo employment:createCV .
						employment:CreateCVDocument welcome:isCurrentDIP "true"^^xsd:boolean .
						employment:CreateCVDocument welcome:hasDIPStatus welcome:Unknown .
						employment:CreateCVDocument welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						employment:createCV rdf:type service:Service .
						employment:createCV service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP employment:CreateCVDocument .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .

:ConditionalCreateCVDocumentYes
	a bt:Condition ;
	rdfs:label "Condition: Create CV Complete and Confirmation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							employment:CreateCVDocument rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							employment:CreateCVDocument welcome:DIPId ?id .						
							employment:CreateCVDocument welcome:hasSlot employment:obtainCVCompletionConfirmation .	
							employment:obtainCVCompletionConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))															
					}"""^^xsd:string ;
		]) .
		
:UpdateCreateNormalClosingS7DIP2Execution_Part1
	a bt:Update ;
	rdfs:label "Update: Create Normal Closing DIP for S7 - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>					
					INSERT {
						welcome:NormalClosingFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:NormalClosingFarewell welcome:hasDIPStatus welcome:Unknown .
						welcome:NormalClosingFarewell welcome:hasSlot welcome:informEnd .
						welcome:NormalClosingFarewell welcome:isCurrentDIP "true"^^xsd:boolean . 
						welcome:informEnd rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informEnd welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI . 
						welcome:informEnd welcome:hasTemplateId "TInformEnd_S7"^^xsd:string .
						welcome:informEnd welcome:hasInputRDFContents welcome:Unknown .
						welcome:informEnd welcome:hasTCNAnswer welcome:Unknown .
						welcome:informEnd welcome:hasStatus welcome:Pending .
						welcome:informEnd welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informEnd welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informEnd welcome:isOptional "false"^^xsd:boolean .	
						welcome:informEnd welcome:dependsOn welcome:Unknown .
						welcome:informEnd welcome:associatedWith welcome:Unknown .
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:UpdateCreateNormalClosingS7DIP2Execution_Part2
	a bt:Update ;
	rdfs:label "Update: Create Normal Closing DIP for S7 - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>					
					INSERT {
						welcome:NormalClosingFarewell welcome:hasSlot welcome:informNormalClosingFarewell .
						welcome:informNormalClosingFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#ConfirmationRequest"^^xsd:anyURI . 
						welcome:informNormalClosingFarewell welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
						welcome:informNormalClosingFarewell welcome:hasTemplateId "TInformNormalClosingFarewell"^^xsd:string .
						welcome:informNormalClosingFarewell welcome:hasInputRDFContents welcome:Unknown .
						welcome:informNormalClosingFarewell welcome:hasTCNAnswer welcome:Unknown .
						welcome:informNormalClosingFarewell welcome:hasStatus welcome:Pending .
						welcome:informNormalClosingFarewell welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informNormalClosingFarewell welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informNormalClosingFarewell welcome:isOptional "false"^^xsd:boolean .
						welcome:informNormalClosingFarewell welcome:dependsOn welcome:Unknown .
						welcome:informNormalClosingFarewell welcome:associatedWith welcome:Unknown .	
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
				]) .


#=============================================================================================
# SpecificSchoolingBT

:HandleEventMasterSchoolingBT
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Executing Schooling BT Master" ;
	ajan:event agents:SchoolingMasterEvent ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """
								PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
								PREFIX ajan: <http://www.ajan.de/ajan-ns#>
								PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
								CONSTRUCT {
									welcome:topic welcome:informed "Master" .
								}
								WHERE { 
									welcome:topic welcome:informed "Master" .
								}"""^^xsd:string ;
	] .
	
:ConditionalMasterDIP
	a bt:Condition ;
	rdfs:label "Condition: Is the Master DIP for Schooling ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:ScenarioIntroduction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:ScenarioIntroduction welcome:DIPId ?id .
							
					}"""^^xsd:string ;
		]) .
		
:ConditionalExecuteUorMasterRecognition
	a bt:Condition ;
	rdfs:label "Condition: Inform about University or Master Recognition ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:ScenarioIntroduction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:ScenarioIntroduction welcome:DIPId ?id .						
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagUMasterRecogRequested .	
							schooling:flagUMasterRecogRequested welcome:hasTCNAnswer ?reifiedAnswerRequested .
							?reifiedAnswerRequested rdf:type rdf:Statement .
							?reifiedAnswerRequested rdf:subject ?reifiedSubject .
							?reifiedAnswerRequested rdf:predicate ?reifiedPredicate .
							?reifiedAnswerRequested rdf:object ?answerRequested .
							FILTER (STRENDS(str(?answerRequested), "true") || STRENDS(str(?answerRequested), "True") || STRENDS(str(?answerRequested), "Yes") || STRENDS(str(?answerRequested), "yes"))	
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagUMasterRecogInformed .	
							schooling:flagUMasterRecogInformed welcome:hasTCNAnswer ?reifiedAnswerInformed .
							?reifiedAnswerInformed rdf:type rdf:Statement .
							?reifiedAnswerInformed rdf:subject ?reifiedSubjectInformed .
							?reifiedAnswerInformed rdf:predicate ?reifiedPredicateInformed .
							?reifiedAnswerInformed rdf:object ?answerRequestedInformed .							
							FILTER (STRENDS(str(?answerRequestedInformed), "Not") || STRENDS(str(?answerRequestedInformed), "not") || STRENDS(str(?answerRequestedInformed), "False") || STRENDS(str(?answerRequestedInformed), "false") || STRENDS(str(?answerRequestedInformed), "No") || STRENDS(str(?answerRequestedInformed), "no"))						
					}"""^^xsd:string ;
		]) .

:WriteUMasterDegreeDocumentsDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Create University or Master Degree Documents DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:UMasterDegreeDocuments rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:UMasterDegreeDocuments welcome:belongsTo schooling:diplomaRecognition .
						schooling:UMasterDegreeDocuments welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:UMasterDegreeDocuments welcome:hasDIPStatus welcome:Unknown .
						schooling:UMasterDegreeDocuments welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:UMasterDegreeDocuments .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .

:ConditionalExecuteProfSkillRecognition
	a bt:Condition ;
	rdfs:label "Condition: Inform about Professional Skill Recognition ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:ScenarioIntroduction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:ScenarioIntroduction welcome:DIPId ?id .						
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagProfSkillRecogRequested .	
							schooling:flagProfSkillRecogRequested welcome:hasTCNAnswer ?reifiedAnswerRequested .
							?reifiedAnswerRequested rdf:type rdf:Statement .
							?reifiedAnswerRequested rdf:subject ?reifiedSubject .
							?reifiedAnswerRequested rdf:predicate ?reifiedPredicate .
							?reifiedAnswerRequested rdf:object ?answerRequested .
							FILTER (STRENDS(str(?answerRequested), "true") || STRENDS(str(?answerRequested), "True") || STRENDS(str(?answerRequested), "Yes") || STRENDS(str(?answerRequested), "yes"))	
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagProfSkillRecogInformed .	
							schooling:flagProfSkillRecogInformed welcome:hasTCNAnswer ?reifiedAnswerInformed .
							?reifiedAnswerInformed rdf:type rdf:Statement .
							?reifiedAnswerInformed rdf:subject ?reifiedSubjectInformed .
							?reifiedAnswerInformed rdf:predicate ?reifiedPredicateInformed .
							?reifiedAnswerInformed rdf:object ?answerRequestedInformed .							
							FILTER (STRENDS(str(?answerRequestedInformed), "Not") || STRENDS(str(?answerRequestedInformed), "not") || STRENDS(str(?answerRequestedInformed), "False") || STRENDS(str(?answerRequestedInformed), "false") || STRENDS(str(?answerRequestedInformed), "No") || STRENDS(str(?answerRequestedInformed), "no"))						
					}"""^^xsd:string ;
		]) .
		
:WriteSkillAccreditationRequirementsDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Create Skill Accreditation Requirements DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:SkillAccreditationRequirements rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:SkillAccreditationRequirements welcome:belongsTo schooling:diplomaRecognition .
						schooling:SkillAccreditationRequirements welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:SkillAccreditationRequirements welcome:hasDIPStatus welcome:Unknown .
						schooling:SkillAccreditationRequirements welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:SkillAccreditationRequirements .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .

:ConditionalExecuteNonUQualificationRecognition
	a bt:Condition ;
	rdfs:label "Condition: Inform about Non University Qualification Recognition ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:ScenarioIntroduction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:ScenarioIntroduction welcome:DIPId ?id .						
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagNonUQualificationRequested .	
							schooling:flagNonUQualificationRequested welcome:hasTCNAnswer ?reifiedAnswerRequested .
							?reifiedAnswerRequested rdf:type rdf:Statement .
							?reifiedAnswerRequested rdf:subject ?reifiedSubject .
							?reifiedAnswerRequested rdf:predicate ?reifiedPredicate .
							?reifiedAnswerRequested rdf:object ?answerRequested .
							FILTER (STRENDS(str(?answerRequested), "true") || STRENDS(str(?answerRequested), "True") || STRENDS(str(?answerRequested), "Yes") || STRENDS(str(?answerRequested), "yes"))	
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagNonUQualificationInformed .	
							schooling:flagNonUQualificationInformed welcome:hasTCNAnswer ?reifiedAnswerInformed .
							?reifiedAnswerInformed rdf:type rdf:Statement .
							?reifiedAnswerInformed rdf:subject ?reifiedSubjectInformed .
							?reifiedAnswerInformed rdf:predicate ?reifiedPredicateInformed .
							?reifiedAnswerInformed rdf:object ?answerRequestedInformed .							
							FILTER (STRENDS(str(?answerRequestedInformed), "Not") || STRENDS(str(?answerRequestedInformed), "not") || STRENDS(str(?answerRequestedInformed), "False") || STRENDS(str(?answerRequestedInformed), "false") || STRENDS(str(?answerRequestedInformed), "No") || STRENDS(str(?answerRequestedInformed), "no"))						
					}"""^^xsd:string ;
		]) .
		
:WriteEducationDepartmentContactDIP2Execution  
	a bt:Write ;
	rdfs:label "Write: Create Skill Accreditation Requirements DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:EducationDepartmentContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:EducationDepartmentContact welcome:belongsTo schooling:diplomaRecognition .
						schooling:EducationDepartmentContact welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:EducationDepartmentContact welcome:hasDIPStatus welcome:Unknown .
						schooling:EducationDepartmentContact welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:EducationDepartmentContact .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalAllSubTopicsInformed
	a bt:Condition ;
	rdfs:label "Condition: Were all topics informed ?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:ScenarioIntroduction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:ScenarioIntroduction welcome:DIPId ?id .						
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagUMasterRecogRequested .	
							schooling:flagUMasterRecogRequested welcome:hasTCNAnswer ?reifiedAnswerRequested_UMaster .
							?reifiedAnswerRequested_UMaster rdf:type rdf:Statement .
							?reifiedAnswerRequested_UMaster rdf:subject ?reifiedSubject_UMaster .
							?reifiedAnswerRequested_UMaster rdf:predicate ?reifiedPredicate_UMaster .
							?reifiedAnswerRequested_UMaster rdf:object ?answerRequested_UMaster .
							FILTER (STRENDS(str(?answerRequested_UMaster), "true") || STRENDS(str(?answerRequested_UMaster), "True") || STRENDS(str(?answerRequested_UMaster), "Yes") || STRENDS(str(?answerRequested_UMaster), "yes"))	
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagUMasterRecogInformed .	
							schooling:flagUMasterRecogInformed welcome:hasTCNAnswer ?reifiedAnswerInformed_UMaster .
							?reifiedAnswerInformed_UMaster rdf:type rdf:Statement .
							?reifiedAnswerInformed_UMaster rdf:subject ?reifiedSubjectInformed_UMaster .
							?reifiedAnswerInformed_UMaster rdf:predicate ?reifiedPredicateInformed_UMaster .
							?reifiedAnswerInformed_UMaster rdf:object ?answerRequestedInformed_UMaster .							
							FILTER (STRENDS(str(?answerRequestedInformed_UMaster), "true") || STRENDS(str(?answerRequestedInformed_UMaster), "True") || STRENDS(str(?answerRequestedInformed_UMaster), "Yes") || STRENDS(str(?answerRequestedInformed_UMaster), "yes"))	
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagProfSkillRecogRequested .	
							schooling:flagProfSkillRecogRequested welcome:hasTCNAnswer ?reifiedAnswerRequested_ProfSkill .
							?reifiedAnswerRequested_ProfSkill rdf:type rdf:Statement .
							?reifiedAnswerRequested_ProfSkill rdf:subject ?reifiedSubject_ProfSkill .
							?reifiedAnswerRequested_ProfSkill rdf:predicate ?reifiedPredicate_ProfSkill .
							?reifiedAnswerRequested_ProfSkill rdf:object ?answerRequested_ProfSkill .
							FILTER (STRENDS(str(?answerRequested_ProfSkill), "true") || STRENDS(str(?answerRequested_ProfSkill), "True") || STRENDS(str(?answerRequested_ProfSkill), "Yes") || STRENDS(str(?answerRequested_ProfSkill), "yes"))	
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagProfSkillRecogInformed .	
							schooling:flagProfSkillRecogInformed welcome:hasTCNAnswer ?reifiedAnswerInformed_ProfSkill .
							?reifiedAnswerInformed_ProfSkill rdf:type rdf:Statement .
							?reifiedAnswerInformed_ProfSkill rdf:subject ?reifiedSubjectInformed_ProfSkill .
							?reifiedAnswerInformed_ProfSkill rdf:predicate ?reifiedPredicateInformed_ProfSkill .
							?reifiedAnswerInformed_ProfSkill rdf:object ?answerRequestedInformed_ProfSkill .							
							FILTER (STRENDS(str(?answerRequestedInformed_ProfSkill), "true") || STRENDS(str(?answerRequestedInformed_ProfSkill), "True") || STRENDS(str(?answerRequestedInformed_ProfSkill), "Yes") || STRENDS(str(?answerRequestedInformed_ProfSkill), "yes"))		
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagNonUQualificationRequested .	
							schooling:flagNonUQualificationRequested welcome:hasTCNAnswer ?reifiedAnswerRequested_NonUQualification .
							?reifiedAnswerRequested_NonUQualification rdf:type rdf:Statement .
							?reifiedAnswerRequested_NonUQualification rdf:subject ?reifiedSubject_NonUQualification .
							?reifiedAnswerRequested_NonUQualification rdf:predicate ?reifiedPredicate_NonUQualification .
							?reifiedAnswerRequested_NonUQualification rdf:object ?answerRequested_NonUQualification .
							FILTER (STRENDS(str(?answerRequested_NonUQualification), "true") || STRENDS(str(?answerRequested_NonUQualification), "True") || STRENDS(str(?answerRequested_NonUQualification), "Yes") || STRENDS(str(?answerRequested_NonUQualification), "yes"))	
							schooling:ScenarioIntroduction welcome:hasSlot schooling:flagNonUQualificationInformed .	
							schooling:flagNonUQualificationInformed welcome:hasTCNAnswer ?reifiedAnswerInformed_NonUQualification .
							?reifiedAnswerInformed_NonUQualification rdf:type rdf:Statement .
							?reifiedAnswerInformed_NonUQualification rdf:subject ?reifiedSubjectInformed_NonUQuali .
							?reifiedAnswerInformed_NonUQualification rdf:predicate ?reifiedPredicateInformed_NonUQuali .
							?reifiedAnswerInformed_NonUQualification rdf:object ?answerRequestedInformed_NonUQuali .							
							FILTER (STRENDS(str(?answerRequestedInformed_NonUQuali), "true") || STRENDS(str(?answerRequestedInformed_NonUQuali), "True") || STRENDS(str(?answerRequestedInformed_NonUQuali), "Yes") || STRENDS(str(?answerRequestedInformed_NonUQuali), "yes"))		
					}"""^^xsd:string ;
		]) .

:UpdateCreateNormalClosingFarewellS8DIP2Execution_Part1
	a bt:Update ;
	rdfs:label "Update: Create Normal Closing DIP for S8 - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>					
					INSERT {
						welcome:NormalClosingFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:NormalClosingFarewell welcome:hasDIPStatus welcome:Unknown .
						welcome:NormalClosingFarewell welcome:hasSlot welcome:informEnd .
						welcome:NormalClosingFarewell welcome:isCurrentDIP "true"^^xsd:boolean . 
						welcome:informEnd rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informEnd welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI . 
						welcome:informEnd welcome:hasTemplateId "TInformEnd_S8"^^xsd:string .
						welcome:informEnd welcome:hasInputRDFContents welcome:Unknown .
						welcome:informEnd welcome:hasTCNAnswer welcome:Unknown .
						welcome:informEnd welcome:hasStatus welcome:Pending .
						welcome:informEnd welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informEnd welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informEnd welcome:isOptional "false"^^xsd:boolean .	
						welcome:informEnd welcome:dependsOn welcome:Unknown .
						welcome:informEnd welcome:associatedWith welcome:Unknown .
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
					
:UpdateCreateNormalClosingFarewellS8DIP2Execution_Part2
	a bt:Update ;
	rdfs:label "Update: Create Normal Closing DIP for S8 - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>					
					INSERT {
						welcome:NormalClosingFarewell welcome:hasSlot welcome:informNormalClosingFarewell .
						welcome:informNormalClosingFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#ConfirmationRequest"^^xsd:anyURI . 
						welcome:informNormalClosingFarewell welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
						welcome:informNormalClosingFarewell welcome:hasTemplateId "TInformNormalClosingFarewell"^^xsd:string .
						welcome:informNormalClosingFarewell welcome:hasInputRDFContents welcome:Unknown .
						welcome:informNormalClosingFarewell welcome:hasTCNAnswer welcome:Unknown .
						welcome:informNormalClosingFarewell welcome:hasStatus welcome:Pending .
						welcome:informNormalClosingFarewell welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informNormalClosingFarewell welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informNormalClosingFarewell welcome:isOptional "false"^^xsd:boolean .
						welcome:informNormalClosingFarewell welcome:dependsOn welcome:Unknown .
						welcome:informNormalClosingFarewell welcome:associatedWith welcome:Unknown .	
					} 
					WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .
		
:UpdateCreateClosingUponFailureUnknownTopicDIP2Execution_Part1
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure - Unknown Topic - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ClosingUponFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:ClosingUponFailureFarewell welcome:hasDIPStatus welcome:Unknown .
						welcome:ClosingUponFailureFarewell welcome:isCurrentDIP "true"^^xsd:boolean .
						welcome:ClosingUponFailureFarewell welcome:hasSlot welcome:informMessage .
						welcome:informMessage rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informMessage welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informMessage welcome:hasTemplateId "TInformMessage"^^xsd:string . 
						welcome:informMessage welcome:hasInputRDFContents welcome:reifiedReasonSTReasonUnknownTopic .
						welcome:informMessage welcome:dependsOn welcome:Unknown .
						welcome:informMessage welcome:associatedWith welcome:Unknown .
						welcome:informMessage welcome:hasStatus welcome:Pending .
						welcome:informMessage welcome:hasNumberAttempts 0 .
						welcome:informMessage welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informMessage welcome:isOptional "false"^^xsd:boolean .				
						welcome:reifiedReasonSTReasonUnknownTopic rdf:type rdf:Statement .
						welcome:reifiedReasonSTReasonUnknownTopic rdf:subject welcome:subTemplate .
						welcome:reifiedReasonSTReasonUnknownTopic rdf:predicate welcome:isReason .
						welcome:reifiedReasonSTReasonUnknownTopic rdf:object "STReasonNoFoundService"^^xsd:string .
					} WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:UpdateCreateClosingUponFailureUnknownTopicDIP2Execution_Part2
	a bt:Update ;
	rdfs:label "Update: Create Closing Upon Failure - Unknown Topic - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 										
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#> 
					INSERT {
						welcome:ClosingUponFailureFarewell welcome:hasSlot welcome:informClosingFailureFarewell .
						welcome:informClosingFailureFarewell rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informClosingFailureFarewell welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI .
						welcome:informClosingFailureFarewell welcome:hasTemplateId "TInformClosingFailureFarewell"^^xsd:string . 
						welcome:informClosingFailureFarewell welcome:hasInputRDFContents welcome:Unknown .
						welcome:informClosingFailureFarewell welcome:hasStatus welcome:Pending .
						welcome:informClosingFailureFarewell welcome:hasNumberAttempts 0 .
						welcome:informClosingFailureFarewell welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informClosingFailureFarewell welcome:isOptional "false"^^xsd:boolean .
						welcome:informClosingFailureFarewell welcome:dependsOn welcome:Unknown .
						welcome:informClosingFailureFarewell welcome:associatedWith welcome:Unknown .
					} WHERE { 
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
		]) .

:EventProducerInformFirstTopic
	a bt:EventProducer ;
	rdfs:label "EventProducer: Inform first subtopic" ;
	ajan:event agents:InformSubTopicEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:ExecutionKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:subTopic welcome:informed welcome:flagUMasterRecogRequested .
						}
						WHERE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						}"""^^xsd:string ;
	] .	
	
:UpdateDeleteTopicSelected
	a bt:Update ;
	rdfs:label "Update: Delete Flag of Selected Topic" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					DELETE  {
						welcome:subTopic welcome:informed ?topic .
					}
					WHERE { 		
							welcome:subTopic welcome:informed ?topic .
					}"""^^xsd:string ;
		]) .


#=============================================================================================
# UMasterRecognitionSchoolingBT

:EventHandlerUMasterRecognition
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Executing University or Master Recognition Subtopic" ;
	ajan:event agents:InformSubTopicEvent ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """
								PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
								PREFIX ajan: <http://www.ajan.de/ajan-ns#>
								PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
								CONSTRUCT {
									welcome:subTopic welcome:informed welcome:flagUMasterRecogRequested .
								}
								WHERE { 
									welcome:subTopic welcome:informed welcome:flagUMasterRecogRequested .
								}"""^^xsd:string ;
	] .
	
:ConditionalOrientORSARUAppORDocTransOptORUMasterRecog_Yes
	a bt:Condition ;
	rdfs:label "Condition: Orientation Point or SARU Appoint. or Doc Trans. Opt. Or Recog. Process Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:InformationAndOrientation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:InformationAndOrientation welcome:DIPId ?id .						
								schooling:InformationAndOrientation welcome:hasSlot schooling:obtainAgreementProceed .	
								schooling:obtainAgreementProceed welcome:hasTCNAnswer ?reifiedAnswerProceed .
								?reifiedAnswerProceed rdf:type rdf:Statement .
								?reifiedAnswerProceed rdf:subject ?reifiedSubjectProc .
								?reifiedAnswerProceed rdf:predicate ?reifiedPredicateProc .
								?reifiedAnswerProceed rdf:object ?answerProc .
								FILTER (STRENDS(str(?answerProc), "true") || STRENDS(str(?answerProc), "True") || STRENDS(str(?answerProc), "Yes") || STRENDS(str(?answerProc), "yes"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:SARUAppointment rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:SARUAppointment welcome:DIPId ?id .						
								schooling:SARUAppointment welcome:hasSlot schooling:obtainSARUInfoConfirmation .	
								schooling:obtainSARUInfoConfirmation welcome:hasTCNAnswer ?reifiedAnswerSARU .
								?reifiedAnswerSARU rdf:type rdf:Statement .
								?reifiedAnswerSARU rdf:subject ?reifiedSubjectSARU .
								?reifiedAnswerSARU rdf:predicate ?reifiedPredicateSARU .
								?reifiedAnswerSARU rdf:object ?answerSARU .
								FILTER (STRENDS(str(?answerSARU), "true") || STRENDS(str(?answerSARU), "True") || STRENDS(str(?answerSARU), "Yes") || STRENDS(str(?answerSARU), "yes"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:DocumentTranslationOptions rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:DocumentTranslationOptions welcome:DIPId ?id .						
								schooling:DocumentTranslationOptions welcome:hasSlot schooling:obtainTranslationInfoConfirmation .	
								schooling:obtainTranslationInfoConfirmation welcome:hasTCNAnswer ?reifiedAnswerOpt .
								?reifiedAnswerOpt rdf:type rdf:Statement .
								?reifiedAnswerOpt rdf:subject ?reifiedSubjectOpt.
								?reifiedAnswerOpt rdf:predicate ?reifiedPredicateOpt .
								?reifiedAnswerOpt rdf:object ?answerOpt .
								FILTER (STRENDS(str(?answerOpt), "true") || STRENDS(str(?answerOpt), "True") || STRENDS(str(?answerOpt), "Yes") || STRENDS(str(?answerOpt), "yes"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:UMasterRecogProcess rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:UMasterRecogProcess welcome:DIPId ?id .						
								schooling:UMasterRecogProcess welcome:hasSlot schooling:obtainUMasterRecogInfoConfirmation .	
								schooling:obtainUMasterRecogInfoConfirmation welcome:hasTCNAnswer ?reifiedAnswerProcess .
								?reifiedAnswerProcess rdf:type rdf:Statement .
								?reifiedAnswerProcess rdf:subject ?reifiedSubjectProcess .
								?reifiedAnswerProcess rdf:predicate ?reifiedPredicateProcess .
								?reifiedAnswerProcess rdf:object ?answerProcess .
								FILTER (STRENDS(str(?answerProcess), "true") || STRENDS(str(?answerProcess), "True") || STRENDS(str(?answerProcess), "Yes") || STRENDS(str(?answerProcess), "yes"))	
							}
					}"""^^xsd:string ;
		]) .
		
:MessageUMasterRecognitionInformed
	a myWelcome:Message ;
	rdfs:label "Message: Send to KMS - University or Master SubTopic Informed"^^xsd:string ;
	rdfs:comment "Message: Send to KMS - University or Master SubTopic Informed"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
		  a bt:SelectQuery;
		  a bt:QueryUri ;
		  bt:originBase ajan:AgentKnowledge ;
		  bt:sparql """
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			SELECT ?hdrName ?fieldValue
			WHERE {
				?headerName welcome:hasHeaderName ?hdrName .
				?headerName welcome:hasHeaderValue ?fieldValue .          
			}"""^^xsd:string
		] ; 
		http-core:headers ([
			  a http-core:Header ;            
			  http-core:hdrName http-headers:accept ;
			  http-core:fieldValue "text/turtle;charset=UTF-8" 
			][
			  a http-core:Header ;
			  http-core:hdrName http-headers:content-type ;
			  http-core:fieldValue "text/plain"
			]
		) ; 		
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
						CONSTRUCT  {
							welcome:agent welcome:informed welcome:flagUMasterRecogRequested .
						}
						WHERE {							
							?dipName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
					welcome:KMS welcome:hasCoreNotification ?requestURI .
				}"""^^xsd:string
	] . 

:ConditionalUMasterDegreeDocuments_Yes
	a bt:Condition ;
	rdfs:label "Condition: University Master Degree Documents Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:UMasterDegreeDocuments rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:UMasterDegreeDocuments welcome:DIPId ?id .						
							schooling:UMasterDegreeDocuments welcome:hasSlot schooling:obtainDocumentsAvailability .	
							schooling:obtainDocumentsAvailability welcome:hasTCNAnswer ?reifiedAnswerAvailability .
							?reifiedAnswerAvailability rdf:type rdf:Statement .
							?reifiedAnswerAvailability rdf:subject ?reifiedSubjectAvailability .
							?reifiedAnswerAvailability rdf:predicate ?reifiedPredicateAvailability  .
							?reifiedAnswerAvailability rdf:object ?answerAvailability  .
							FILTER (STRENDS(str(?answerAvailability), "true") || STRENDS(str(?answerAvailability), "True") || STRENDS(str(?answerAvailability), "Yes") || STRENDS(str(?answerAvailability), "yes"))	
					}"""^^xsd:string ;
		]) .
		
:WriteDocumentTranslationDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Document Translation DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:DocumentTranslation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:DocumentTranslation welcome:belongsTo schooling:diplomaRecognition .
						schooling:DocumentTranslation welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:DocumentTranslation welcome:hasDIPStatus welcome:Unknown .
						schooling:DocumentTranslation welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:DocumentTranslation .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalUMasterDegreeDocuments_Not
	a bt:Condition ;
	rdfs:label "Condition: University Master Degree Documents Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:UMasterDegreeDocuments rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:UMasterDegreeDocuments welcome:DIPId ?id .						
							schooling:UMasterDegreeDocuments welcome:hasSlot schooling:obtainDocumentsAvailability .	
							schooling:obtainDocumentsAvailability welcome:hasTCNAnswer ?reifiedAnswerAvailability .
							?reifiedAnswerAvailability rdf:type rdf:Statement .
							?reifiedAnswerAvailability rdf:subject ?reifiedSubjectAvailability .
							?reifiedAnswerAvailability rdf:predicate ?reifiedPredicateAvailability  .
							?reifiedAnswerAvailability rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))	
					}"""^^xsd:string ;
		]) .
		
:WriteSARUAppointmentDIP2Execution
	a bt:Write ;
	rdfs:label "Write: SARU Appointment DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:SARUAppointment rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:SARUAppointment welcome:belongsTo schooling:diplomaRecognition .
						schooling:SARUAppointment welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:SARUAppointment welcome:hasDIPStatus welcome:Unknown .
						schooling:SARUAppointment welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:SARUAppointment .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalDocumentTranslation_Yes
	a bt:Condition ;
	rdfs:label "Condition: Document for Translation Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:DocumentTranslation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:DocumentTranslation welcome:DIPId ?id .						
							schooling:DocumentTranslation welcome:hasSlot schooling:obtainAvailableTranslation .	
							schooling:obtainAvailableTranslation welcome:hasTCNAnswer ?reifiedAnswerTrans .
							?reifiedAnswerTrans rdf:type rdf:Statement .
							?reifiedAnswerTrans rdf:subject ?reifiedSubjectTrans .
							?reifiedAnswerTrans rdf:predicate ?reifiedPredicateTrans  .
							?reifiedAnswerTrans rdf:object ?answerAvailability .
							FILTER (STRENDS(str(?answerAvailability), "true") || STRENDS(str(?answerAvailability), "True") || STRENDS(str(?answerAvailability), "Yes") || STRENDS(str(?answerAvailability), "yes"))	
					}"""^^xsd:string ;
		]) .
		
:WriteUMasterRecogProcessDIP2Execution
	a bt:Write ;
	rdfs:label "Write: University or Master Recog Process DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:UMasterRecogProcess rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:UMasterRecogProcess welcome:belongsTo schooling:diplomaRecognition .
						schooling:UMasterRecogProcess welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:UMasterRecogProcess welcome:hasDIPStatus welcome:Unknown .
						schooling:UMasterRecogProcess welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:UMasterRecogProcess .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalDocumentTranslation_Not
	a bt:Condition ;
	rdfs:label "Condition: Document for Translation Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:DocumentTranslation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:DocumentTranslation welcome:DIPId ?id .						
							schooling:DocumentTranslation welcome:hasSlot schooling:obtainAvailableTranslation .	
							schooling:obtainAvailableTranslation welcome:hasTCNAnswer ?reifiedAnswerTrans .
							?reifiedAnswerTrans rdf:type rdf:Statement .
							?reifiedAnswerTrans rdf:subject ?reifiedSubjectTrans .
							?reifiedAnswerTrans rdf:predicate ?reifiedPredicateTrans  .
							?reifiedAnswerTrans rdf:object ?answerAvailability .
							FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))	
					}"""^^xsd:string ;
		]) .
		
:WriteDocumentTranslationOptionsDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Document Translation Option DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:DocumentTranslationOptions rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:DocumentTranslationOptions welcome:belongsTo schooling:diplomaRecognition .
						schooling:DocumentTranslationOptions welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:DocumentTranslationOptions welcome:hasDIPStatus welcome:Unknown .
						schooling:DocumentTranslationOptions welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:DocumentTranslationOptions .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalDocTransOptORSARUAppORUMasterRecogProc_Not
	a bt:Condition ;
	rdfs:label "Condition: Translation Option or SARU Appoint or Recog Process Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:DocumentTranslationOptions rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:DocumentTranslationOptions welcome:DIPId ?id .						
								schooling:DocumentTranslationOptions welcome:hasSlot schooling:obtainTranslationInfoConfirmation .	
								schooling:obtainTranslationInfoConfirmation welcome:hasTCNAnswer ?reifiedAnswerTrans .
								?reifiedAnswerTrans rdf:type rdf:Statement .
								?reifiedAnswerTrans rdf:subject ?reifiedSubject .
								?reifiedAnswerTrans rdf:predicate ?reifiedPredicate .
								?reifiedAnswerTrans rdf:object ?answer .
								FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:SARUAppointment rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:SARUAppointment welcome:DIPId ?id .						
								schooling:SARUAppointment welcome:hasSlot schooling:obtainSARUInfoConfirmation .	
								schooling:obtainSARUInfoConfirmation welcome:hasTCNAnswer ?reifiedAnswerSARU .
								?reifiedAnswerSARU rdf:type rdf:Statement .
								?reifiedAnswerSARU rdf:subject ?reifiedSubjectSARU .
								?reifiedAnswerSARU rdf:predicate ?reifiedPredicateSARU .
								?reifiedAnswerSARU rdf:object ?answerSARU .
								FILTER (STRENDS(str(?answerSARU), "Not") || STRENDS(str(?answerSARU), "not") || STRENDS(str(?answerSARU), "False") || STRENDS(str(?answerSARU), "false") || STRENDS(str(?answerSARU), "No") || STRENDS(str(?answerSARU), "no"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:UMasterRecogProcess rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:UMasterRecogProcess welcome:DIPId ?id .						
								schooling:UMasterRecogProcess welcome:hasSlot schooling:obtainUMasterRecogInfoConfirmation .	
								schooling:obtainUMasterRecogInfoConfirmation welcome:hasTCNAnswer ?reifiedAnswerProcess .
								?reifiedAnswerProcess rdf:type rdf:Statement .
								?reifiedAnswerProcess rdf:subject ?reifiedSubjectProcess .
								?reifiedAnswerProcess rdf:predicate ?reifiedPredicateProcess .
								?reifiedAnswerProcess rdf:object ?answerProcess .
								FILTER (STRENDS(str(?answerProcess), "Not") || STRENDS(str(?answerProcess), "not") || STRENDS(str(?answerProcess), "False") || STRENDS(str(?answerProcess), "false") || STRENDS(str(?answerProcess), "No") || STRENDS(str(?answerProcess), "no"))	
							}
					}"""^^xsd:string ;
		]) .
		
:WriteInformationAndOrientationDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Information And Orientation DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:InformationAndOrientation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:InformationAndOrientation welcome:belongsTo schooling:diplomaRecognition .
						schooling:InformationAndOrientation welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:InformationAndOrientation welcome:hasDIPStatus welcome:Unknown .
						schooling:InformationAndOrientation welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:InformationAndOrientation .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalInformationAndOrientation_Not
	a bt:Condition ;
	rdfs:label "Condition: Information and Orientation Point Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:InformationAndOrientation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:InformationAndOrientation welcome:DIPId ?id .						
							schooling:InformationAndOrientation welcome:hasSlot schooling:obtainAgreementProceed .	
							schooling:obtainAgreementProceed welcome:hasTCNAnswer ?reifiedAnswerProceed .
							?reifiedAnswerProceed rdf:type rdf:Statement .
							?reifiedAnswerProceed rdf:subject ?reifiedSubjectProcess .
							?reifiedAnswerProceed rdf:predicate ?reifiedPredicateProcess  .
							?reifiedAnswerProceed rdf:object ?answer .
							FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))	
					}"""^^xsd:string ;
		]) .
		
:EventProducerInformSecondTopic
	a bt:EventProducer ;
	rdfs:label "EventProducer: Inform second subtopic" ;
	ajan:event agents:InformSubTopicEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:ExecutionKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:subTopic welcome:informed welcome:flagProfSkillRecogRequested .
						}
						WHERE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						}"""^^xsd:string ;
	] .	

#=============================================================================================
# ProfessionalSkillsRecognitionSchoolingBT	

:EventHandlerProfessionalSkillsRecognition
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Executing Professional Skills Recognition Subtopic" ;
	ajan:event agents:InformSubTopicEvent ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """
								PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
								PREFIX ajan: <http://www.ajan.de/ajan-ns#>
								PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
								CONSTRUCT {
									welcome:subTopic welcome:informed welcome:flagProfSkillRecogRequested .
								}
								WHERE { 
									welcome:subTopic welcome:informed welcome:flagProfSkillRecogRequested .
								}"""^^xsd:string ;
	] .
	
:ConditionalOrientationORAccreditationServiceORContactAppORCVProcess_Yes
	a bt:Condition ;
	rdfs:label "Condition: Orientation Yes or Accreditation Service or contact Appointment or CV Process Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {							
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:InformationAndOrientation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:InformationAndOrientation welcome:DIPId ?id .						
								schooling:InformationAndOrientation welcome:hasSlot schooling:obtainAgreementProceed .	
								schooling:obtainAgreementProceed welcome:hasTCNAnswer ?reifiedAnswer .
								?reifiedAnswer rdf:type rdf:Statement .
								?reifiedAnswer rdf:subject ?reifiedSubject .
								?reifiedAnswer rdf:predicate ?reifiedPredicate .
								?reifiedAnswer rdf:object ?answer .		
								FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:AccreditationServiceContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:AccreditationServiceContact welcome:DIPId ?id .						
								schooling:AccreditationServiceContact welcome:hasSlot schooling:obtainAgreementProceed .	
								schooling:obtainAgreementProceed welcome:hasTCNAnswer ?reifiedAnswerProceed .
								?reifiedAnswerProceed rdf:type rdf:Statement .
								?reifiedAnswerProceed rdf:subject ?reifiedSubjectProceed .
								?reifiedAnswerProceed rdf:predicate ?reifiedPredicateProceed .
								?reifiedAnswerProceed rdf:object ?answerProceed .		
								FILTER (STRENDS(str(?answerProceed), "true") || STRENDS(str(?answerProceed), "True") || STRENDS(str(?answerProceed), "Yes") || STRENDS(str(?answerProceed), "yes"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:ContactAppointment rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:ContactAppointment welcome:DIPId ?id .						
								schooling:ContactAppointment welcome:hasSlot schooling:obtainAppointmentContactConfirmation .	
								schooling:obtainAppointmentContactConfirmation welcome:hasTCNAnswer ?reifiedAnswerAppointment .
								?reifiedAnswerAppointment rdf:type rdf:Statement .
								?reifiedAnswerAppointment rdf:subject ?reifiedSubjectAppointment .
								?reifiedAnswerAppointment rdf:predicate ?reifiedPredicateAppointment .
								?reifiedAnswerAppointment rdf:object ?answerAppointment .		
								FILTER (STRENDS(str(?answerAppointment), "true") || STRENDS(str(?answerAppointment), "True") || STRENDS(str(?answerAppointment), "Yes") || STRENDS(str(?answerAppointment), "yes"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:CVCreationProcess rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:CVCreationProcess welcome:DIPId ?id .						
								schooling:CVCreationProcess welcome:hasSlot schooling:obtainCVAssistanceConfirmation .	
								schooling:obtainCVAssistanceConfirmation welcome:hasTCNAnswer ?reifiedAnswerCV .
								?reifiedAnswerCV rdf:type rdf:Statement .
								?reifiedAnswerCV rdf:subject ?reifiedSubjectCV .
								?reifiedAnswerCV rdf:predicate ?reifiedPredicateCV .
								?reifiedAnswerCV rdf:object ?answerCV .		
								FILTER (STRENDS(str(?answerCV), "true") || STRENDS(str(?answerCV), "True") || STRENDS(str(?answerCV), "Yes") || STRENDS(str(?answerCV), "yes"))	
							}
					}"""^^xsd:string ;
		]) .
		
:MessageProfessionalSkillRecognitionInformed
	a myWelcome:Message ;
	rdfs:label "Message: Send to KMS - Professional Skills SubTopic Informed"^^xsd:string ;
	rdfs:comment "Message: Send to KMS - Professional Skills SubTopic Informed"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
		  a bt:SelectQuery;
		  a bt:QueryUri ;
		  bt:originBase ajan:AgentKnowledge ;
		  bt:sparql """
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			SELECT ?hdrName ?fieldValue
			WHERE {
				?headerName welcome:hasHeaderName ?hdrName .
				?headerName welcome:hasHeaderValue ?fieldValue .          
			}"""^^xsd:string
		] ; 
		http-core:headers ([
			  a http-core:Header ;            
			  http-core:hdrName http-headers:accept ;
			  http-core:fieldValue "text/turtle;charset=UTF-8" 
			][
			  a http-core:Header ;
			  http-core:hdrName http-headers:content-type ;
			  http-core:fieldValue "text/plain"
			]
		) ; 		
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
						CONSTRUCT  {
							welcome:agent welcome:informed welcome:flagProfSkillRecogRequested .
						}
						WHERE {							
							?dipName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
					welcome:KMS welcome:hasCoreNotification ?requestURI .
				}"""^^xsd:string
	] . 

:ConditionalSkillAccreditationRequirements_Yes
	a bt:Condition ;
	rdfs:label "Condition: Skill Accrediation Requirements Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:SkillAccreditationRequirements rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:SkillAccreditationRequirements welcome:DIPId ?id .						
							schooling:SkillAccreditationRequirements welcome:hasSlot schooling:obtainRequirementsSatisfied .	
							schooling:obtainRequirementsSatisfied welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .		
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))	
					}"""^^xsd:string ;
		]) .
		
:WriteCVRequirementDIP2Execution
	a bt:Write ;
	rdfs:label "Write: CV Requirement DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:CVRequirement rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:CVRequirement welcome:belongsTo schooling:diplomaRecognition .
						schooling:CVRequirement welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:CVRequirement welcome:hasDIPStatus welcome:Unknown .
						schooling:CVRequirement welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:CVRequirement .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalSkillAccreditationRequirements_Not
	a bt:Condition ;
	rdfs:label "Condition: Skill Accrediation Requirements Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:SkillAccreditationRequirements rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:SkillAccreditationRequirements welcome:DIPId ?id .						
							schooling:SkillAccreditationRequirements welcome:hasSlot schooling:obtainRequirementsSatisfied .	
							schooling:obtainRequirementsSatisfied welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .		
							FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))
					}"""^^xsd:string ;
		]) .
		
:WriteContactAppointmentDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Contact Appointment DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:ContactAppointment rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:ContactAppointment welcome:belongsTo schooling:diplomaRecognition .
						schooling:ContactAppointment welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:ContactAppointment welcome:hasDIPStatus welcome:Unknown .
						schooling:ContactAppointment welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:ContactAppointment .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalCVRequirement_Yes
	a bt:Condition ;
	rdfs:label "Condition: CV Requirement Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:CVRequirement rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:CVRequirement welcome:DIPId ?id .						
							schooling:CVRequirement welcome:hasSlot schooling:obtainExistingCV .	
							schooling:obtainExistingCV welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .		
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))	
					}"""^^xsd:string ;
		]) .
		
:WriteNewCVCreationDIP2Execution
	a bt:Write ;
	rdfs:label "Write: New CV Creation DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:NewCVCreation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:NewCVCreation welcome:belongsTo schooling:diplomaRecognition .
						schooling:NewCVCreation welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:NewCVCreation welcome:hasDIPStatus welcome:Unknown .
						schooling:NewCVCreation welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:NewCVCreation .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalCVRequirement_Not
	a bt:Condition ;
	rdfs:label "Condition: CV Requirement Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:CVRequirement rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:CVRequirement welcome:DIPId ?id .						
							schooling:CVRequirement welcome:hasSlot schooling:obtainExistingCV .	
							schooling:obtainExistingCV welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .		
							FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))
					}"""^^xsd:string ;
		]) .
		
:WriteCVAssistanceDIP2Execution
	a bt:Write ;
	rdfs:label "Write: CV Assistance DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:CVAssistance rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:CVAssistance welcome:belongsTo schooling:diplomaRecognition .
						schooling:CVAssistance welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:CVAssistance welcome:hasDIPStatus welcome:Unknown .
						schooling:CVAssistance welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:CVAssistance .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalNewCVORCVAssistance_Yes
	a bt:Condition ;
	rdfs:label "Condition: New CV Creation or CV Assistance Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {							
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:NewCVCreation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:NewCVCreation welcome:DIPId ?id .						
								schooling:NewCVCreation welcome:hasSlot schooling:obtainNewCVAssistance .	
								schooling:obtainNewCVAssistance welcome:hasTCNAnswer ?reifiedAnswerNewCV .
								?reifiedAnswerNewCV rdf:type rdf:Statement .
								?reifiedAnswerNewCV rdf:subject ?reifiedSubjectNewCV .
								?reifiedAnswerNewCV rdf:predicate ?reifiedPredicateNewCV .
								?reifiedAnswerNewCV rdf:object ?answerNewCV .		
								FILTER (STRENDS(str(?answerNewCV), "true") || STRENDS(str(?answerNewCV), "True") || STRENDS(str(?answerNewCV), "Yes") || STRENDS(str(?answerNewCV), "yes"))	
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:CVAssistance rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:CVAssistance welcome:DIPId ?id .						
								schooling:CVAssistance welcome:hasSlot schooling:obtainCVAssistance .	
								schooling:obtainCVAssistance welcome:hasTCNAnswer ?reifiedAnswerAssistance .
								?reifiedAnswerAssistance rdf:type rdf:Statement .
								?reifiedAnswerAssistance rdf:subject ?reifiedSubjectAssistance .
								?reifiedAnswerAssistance rdf:predicate ?reifiedPredicateAssistance .
								?reifiedAnswerAssistance rdf:object ?answerAssistance .		
								FILTER (STRENDS(str(?answerAssistance), "true") || STRENDS(str(?answerAssistance), "True") || STRENDS(str(?answerAssistance), "Yes") || STRENDS(str(?answerAssistance), "yes"))	
							}
					}"""^^xsd:string ;
		]) .
		
:WriteCVCreationProcessDIP2Execution
	a bt:Write ;
	rdfs:label "Write: CV Creation Process DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:CVCreationProcess rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:CVCreationProcess welcome:belongsTo schooling:diplomaRecognition .
						schooling:CVCreationProcess welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:CVCreationProcess welcome:hasDIPStatus welcome:Unknown .
						schooling:CVCreationProcess welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:CVCreationProcess .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalNewCVORCVAssistance_Not
	a bt:Condition ;
	rdfs:label "Condition: New CV Creation or CV Assistance Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {							
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:NewCVCreation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:NewCVCreation welcome:DIPId ?id .						
								schooling:NewCVCreation welcome:hasSlot schooling:obtainNewCVAssistance .	
								schooling:obtainNewCVAssistance welcome:hasTCNAnswer ?reifiedAnswerNewCV .
								?reifiedAnswerNewCV rdf:type rdf:Statement .
								?reifiedAnswerNewCV rdf:subject ?reifiedSubjectNewCV .
								?reifiedAnswerNewCV rdf:predicate ?reifiedPredicateNewCV .
								?reifiedAnswerNewCV rdf:object ?answerNewCV .		
								FILTER (STRENDS(str(?answerNewCV), "Not") || STRENDS(str(?answerNewCV), "not") || STRENDS(str(?answerNewCV), "False") || STRENDS(str(?answerNewCV), "false") || STRENDS(str(?answerNewCV), "No") || STRENDS(str(?answerNewCV), "no"))
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:CVAssistance rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:CVAssistance welcome:DIPId ?id .						
								schooling:CVAssistance welcome:hasSlot schooling:obtainCVAssistance .	
								schooling:obtainCVAssistance welcome:hasTCNAnswer ?reifiedAnswerAssistance .
								?reifiedAnswerAssistance rdf:type rdf:Statement .
								?reifiedAnswerAssistance rdf:subject ?reifiedSubjectAssistance .
								?reifiedAnswerAssistance rdf:predicate ?reifiedPredicateAssistance .
								?reifiedAnswerAssistance rdf:object ?answerAssistance .		
								FILTER (STRENDS(str(?answerAssistance), "Not") || STRENDS(str(?answerAssistance), "not") || STRENDS(str(?answerAssistance), "False") || STRENDS(str(?answerAssistance), "false") || STRENDS(str(?answerAssistance), "No") || STRENDS(str(?answerAssistance), "no"))
							}
					}"""^^xsd:string ;
		]) .
		
:WriteAccreditationServiceContactDIP2Execution
	a bt:Write ;
	rdfs:label "Write: Accreditation Service Contact DIP in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:LocalServicesKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
			PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
			PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
			PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
			PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
			PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
			PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
			PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
			PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
						
			CONSTRUCT  {
						schooling:AccreditationServiceContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						schooling:AccreditationServiceContact welcome:belongsTo schooling:diplomaRecognition .
						schooling:AccreditationServiceContact welcome:isCurrentDIP "true"^^xsd:boolean .
						schooling:AccreditationServiceContact welcome:hasDIPStatus welcome:Unknown .
						schooling:AccreditationServiceContact welcome:hasSlot ?input .
						?input rdf:type ?slotType .
						?input welcome:hasOntologyType ?paramTypeInput .
						?input welcome:hasTemplateId ?templateIdInput .						
						?input welcome:isOptional ?optionalInput .
						?input welcome:hasInputRDFContents welcome:Unknown .
						?input welcome:hasTCNAnswer welcome:Unknown .
						?input welcome:hasStatus welcome:Pending .
						?input welcome:dependsOn ?dependency .
						?input welcome:associatedWith ?association .
						?input welcome:hasNumberAttempts 0 .
						?input welcome:confidenceScore "0.0"^^xsd:float .					
			}
			WHERE { 
					{
						schooling:diplomaRecognition rdf:type service:Service .
						schooling:diplomaRecognition service:describedBy ?process . 
						?process process:hasInput ?input .
						?input process:parameterType ?paramTypeInput .
						?input welcome:hasDIP schooling:AccreditationServiceContact .
						?input welcome:hasSlotType ?slotType .
						?input welcome:isOptional ?optionalInput .							
						OPTIONAL {?input welcome:hasTemplateId ?templateIdInput }
						OPTIONAL {?input welcome:dependsOn ?val}
						OPTIONAL {?input welcome:associatedWith ?asso}
						BIND(IF(EXISTS{?input welcome:dependsOn ?val}, ?val, welcome:Unknown) as ?dependency)
						BIND(IF(EXISTS{?input welcome:associatedWith ?asso}, ?asso, welcome:Unknown) as ?association).	
					}
			} """^^xsd:string ;
	] .
	
:ConditionalContactAppORCVProcess_Not
	a bt:Condition ;
	rdfs:label "Condition: Contact Appointment or CV Creation Process Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {							
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:ContactAppointment rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:ContactAppointment welcome:DIPId ?id .						
								schooling:ContactAppointment welcome:hasSlot schooling:obtainAppointmentContactConfirmation .	
								schooling:obtainAppointmentContactConfirmation welcome:hasTCNAnswer ?reifiedAnswerContact .
								?reifiedAnswerContact rdf:type rdf:Statement .
								?reifiedAnswerContact rdf:subject ?reifiedSubjectContact .
								?reifiedAnswerContact rdf:predicate ?reifiedPredicateContact .
								?reifiedAnswerContact rdf:object ?answerContact .		
								FILTER (STRENDS(str(?answerContact), "Not") || STRENDS(str(?answerContact), "not") || STRENDS(str(?answerContact), "False") || STRENDS(str(?answerContact), "false") || STRENDS(str(?answerContact), "No") || STRENDS(str(?answerContact), "no"))
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:CVCreationProcess rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:CVCreationProcess welcome:DIPId ?id .						
								schooling:CVCreationProcess welcome:hasSlot schooling:obtainCVAssistanceConfirmation .	
								schooling:obtainCVAssistanceConfirmation welcome:hasTCNAnswer ?reifiedAnswerAssistance .
								?reifiedAnswerAssistance rdf:type rdf:Statement .
								?reifiedAnswerAssistance rdf:subject ?reifiedSubjectAssistance .
								?reifiedAnswerAssistance rdf:predicate ?reifiedPredicateAssistance .
								?reifiedAnswerAssistance rdf:object ?answerAssistance .		
								FILTER (STRENDS(str(?answerAssistance), "Not") || STRENDS(str(?answerAssistance), "not") || STRENDS(str(?answerAssistance), "False") || STRENDS(str(?answerAssistance), "false") || STRENDS(str(?answerAssistance), "No") || STRENDS(str(?answerAssistance), "no"))
							}
					}"""^^xsd:string ;
		]) .
		
:ConditionalOrientationORAccreditationContact_Not
	a bt:Condition ;
	rdfs:label "Condition: Contact Appointment or CV Creation Process Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {							
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:InformationAndOrientation rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:InformationAndOrientation welcome:DIPId ?id .						
								schooling:InformationAndOrientation welcome:hasSlot schooling:obtainAgreementProceed .	
								schooling:obtainAgreementProceed welcome:hasTCNAnswer ?reifiedAnswerOrientation .
								?reifiedAnswerOrientation rdf:type rdf:Statement .
								?reifiedAnswerOrientation rdf:subject ?reifiedSubjectOrientation .
								?reifiedAnswerOrientation rdf:predicate ?reifiedPredicateOrientation .
								?reifiedAnswerOrientation rdf:object ?answerOrientation .		
								FILTER (STRENDS(str(?answerOrientation), "Not") || STRENDS(str(?answerOrientation), "not") || STRENDS(str(?answerOrientation), "False") || STRENDS(str(?answerOrientation), "false") || STRENDS(str(?answerOrientation), "No") || STRENDS(str(?answerOrientation), "no"))
							}
							UNION
							{
								?bt welcome:hasActiveDIP ?id . 
								schooling:AccreditationServiceContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
								schooling:AccreditationServiceContact welcome:DIPId ?id .						
								schooling:AccreditationServiceContact welcome:hasSlot schooling:obtainAgreementProceed .	
								schooling:obtainAgreementProceed welcome:hasTCNAnswer ?reifiedAnswerProceed .
								?reifiedAnswerProceed rdf:type rdf:Statement .
								?reifiedAnswerProceed rdf:subject ?reifiedSubjectProceed .
								?reifiedAnswerProceed rdf:predicate ?reifiedPredicateProceed .
								?reifiedAnswerProceed rdf:object ?answerProceed .		
								FILTER (STRENDS(str(?answerProceed), "Not") || STRENDS(str(?answerProceed), "not") || STRENDS(str(?answerProceed), "False") || STRENDS(str(?answerProceed), "false") || STRENDS(str(?answerProceed), "No") || STRENDS(str(?answerProceed), "no"))
							}
					}"""^^xsd:string ;
		]) .

:EventProducerInformThirdTopic
	a bt:EventProducer ;
	rdfs:label "EventProducer: Inform second subtopic" ;
	ajan:event agents:InformSubTopicEvent ;
	bt:content [
					a bt:ConstructQuery ;
					bt:originBase ajan:ExecutionKnowledge;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX ajan: <http://www.ajan.de/ajan-ns#>
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						CONSTRUCT {
							welcome:subTopic welcome:informed welcome:flagNonUQualificationRequested .
						}
						WHERE {
							?dip rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						}"""^^xsd:string ;
	] .	


#=============================================================================================
# NonUQualificationSchoolingBT

:EventHandlerNonUQualificationRecognition
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Executing Non University Qualification Subtopic" ;
	ajan:event agents:InformSubTopicEvent ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:ExecutionKnowledge ;
					bt:sparql """
								PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
								PREFIX ajan: <http://www.ajan.de/ajan-ns#>
								PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
								CONSTRUCT {
									welcome:subTopic welcome:informed welcome:flagNonUQualificationRequested .
								}
								WHERE { 
									welcome:subTopic welcome:informed welcome:flagNonUQualificationRequested .
								}"""^^xsd:string ;
	] .
	
:ConditionalEducationDepartmentContact_Yes
	a bt:Condition ;
	rdfs:label "Condition: Educational Department Contact Yes?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:EducationDepartmentContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:EducationDepartmentContact welcome:DIPId ?id .						
							schooling:EducationDepartmentContact welcome:hasSlot schooling:obtainEducationDepartmentConfirmation .	
							schooling:obtainEducationDepartmentConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .		
							FILTER (STRENDS(str(?answer), "true") || STRENDS(str(?answer), "True") || STRENDS(str(?answer), "Yes") || STRENDS(str(?answer), "yes"))	
					}"""^^xsd:string ;
		]) .
		
:MessageNonUniversityQualificationInformed
	a myWelcome:Message ;
	rdfs:label "Message: Send to KMS - Non University Qualification Informed"^^xsd:string ;
	rdfs:comment "Message: Send to KMS - Non University Qualification Informed"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
		  a bt:SelectQuery;
		  a bt:QueryUri ;
		  bt:originBase ajan:AgentKnowledge ;
		  bt:sparql """
			PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
			SELECT ?hdrName ?fieldValue
			WHERE {
				?headerName welcome:hasHeaderName ?hdrName .
				?headerName welcome:hasHeaderValue ?fieldValue .          
			}"""^^xsd:string
		] ; 
		http-core:headers ([
			  a http-core:Header ;            
			  http-core:hdrName http-headers:accept ;
			  http-core:fieldValue "text/turtle;charset=UTF-8" 
			][
			  a http-core:Header ;
			  http-core:hdrName http-headers:content-type ;
			  http-core:fieldValue "text/plain"
			]
		) ; 		
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
						CONSTRUCT  {
							welcome:agent welcome:informed welcome:flagNonUQualificationRequested .
						}
						WHERE {							
							?dipName rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:KMS welcome:hasCoreNotification ?requestURI .
				}"""^^xsd:string
	] . 

:ConditionalEducationDepartmentContact_Not
	a bt:Condition ;
	rdfs:label "Condition: Educational Department Contact Not?" ;
	bt:query ([
		a bt:AskQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX service: <http://www.daml.org/services/owl-s/1.1/Service.owl#>
					PREFIX process: <http://www.daml.org/services/owl-s/1.1/Process.owl#>
					PREFIX ssc: <http://www.ajan.de/behavior/scs-ns#>
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX simulateAppointment: <http://localhost:8080/welcome/integration/coordination/ajan/agents/welcome/services/SimulatePhoneAppointmentService.owl#>
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					PREFIX schooling: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/SchoolingDIFE.owl#>
					ASK
					WHERE {
							?bt welcome:hasActiveDIP ?id . 
							schooling:EducationDepartmentContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
							schooling:EducationDepartmentContact welcome:DIPId ?id .						
							schooling:EducationDepartmentContact welcome:hasSlot schooling:obtainEducationDepartmentConfirmation .	
							schooling:obtainEducationDepartmentConfirmation welcome:hasTCNAnswer ?reifiedAnswer .
							?reifiedAnswer rdf:type rdf:Statement .
							?reifiedAnswer rdf:subject ?reifiedSubject .
							?reifiedAnswer rdf:predicate ?reifiedPredicate .
							?reifiedAnswer rdf:object ?answer .		
							FILTER (STRENDS(str(?answer), "Not") || STRENDS(str(?answer), "not") || STRENDS(str(?answer), "False") || STRENDS(str(?answer), "false") || STRENDS(str(?answer), "No") || STRENDS(str(?answer), "no"))
					}"""^^xsd:string ;
		]) .
		
#=============================================================================================
# FAQBTBehavior - ExternalFAQBT - InternalFAQBT

:EventHandlerRetrievedExternalFAQs
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Receive External FAQ Notification" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#ExternalFAQEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
						CONSTRUCT {
							welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
							?bnode rdf:first ?faq1 .
							?bnode rdf:rest ?restSecondEl .
							?restSecondEl rdf:first ?faq2 . 
							?restSecondEl rdf:rest ?restThirdEl . 
							?restThirdEl rdf:first ?faq3 . 
						}
						WHERE { 		
							welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
							{							
								{
      								OPTIONAL {
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
											?bnode rdf:rest ?restSecondEl .
											?restSecondEl rdf:first ?faq2 .  
											?restSecondEl rdf:rest ?restThirdEl . 
											?restThirdEl rdf:first ?faq3 . 
     							 	}
    							}
								UNION
								{
      								OPTIONAL {
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
											?bnode rdf:rest ?restSecondEl .
											?restSecondEl rdf:first ?faq2 .  
 									} 
    							}
								UNION
								{
      								OPTIONAL { 	
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
									}
								}
						}
					}
					"""^^xsd:string ;
				] .

:EventHandlerRetrievedInternalFAQs
	a bt:HandleEvent ;
	rdfs:label "EventHandler: Receive Internal FAQ Notification" ;
	bt:event <http://localhost:8090/rdf4j/repositories/agents#InternalFAQEvent> ;
	bt:validate [
					a bt:ConstructQuery ;
					bt:targetBase ajan:AgentKnowledge ;
					bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
						CONSTRUCT {
							welcome:KMSNotifies welcome:FAQRequest "true" .
						}
						WHERE { 
							welcome:KMSNotifies welcome:FAQRequest "true" .
						} 
					"""^^xsd:string ;
				] .
				
:WriteExternalFAQNotifiationToExecution
	a bt:Write ;
	rdfs:label "Write: FAQ Notification in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					CONSTRUCT  {
						welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
						?bnode rdf:first ?faq1 .
						?restSecondEl rdf:first ?faq2 .
						?restThirdEl rdf:first ?faq3 .
					}
					WHERE { 		
							welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
							{							
								{
      								OPTIONAL {
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
											?bnode rdf:rest ?restSecondEl .
											?restSecondEl rdf:first ?faq2 .  
											?restSecondEl rdf:rest ?restThirdEl . 
											?restThirdEl rdf:first ?faq3 . 
     							 	}
    							}
								UNION
								{
      								OPTIONAL {
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
											?bnode rdf:rest ?restSecondEl .
											?restSecondEl rdf:first ?faq2 .  
 									} 
    							}
								UNION
								{
      								OPTIONAL { 	
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
									}
								}
						}
					}"""^^xsd:string ;
	] .

:WriteInternalFAQNotifiationToExecution
	a bt:Write ;
	rdfs:label "Write: Internal FAQ Notification in Execution" ;
	bt:query [
		a bt:ConstructQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:targetBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					CONSTRUCT  {
							welcome:KMSNotifies welcome:FAQRequest "true" .
					}
					WHERE {
							welcome:KMSNotifies welcome:FAQRequest "true" .
					}"""^^xsd:string ;
	] .
	
:UpdateDeleteExternalFAQNotificationAgentKnowledge
	a bt:Update ;
	rdfs:label "Update: Delete External FAQ Notification from LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					DELETE  {
						welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
						?bnode rdf:first ?faq1 .
						?bnode rdf:rest ?restSecondEl .
						?restSecondEl rdf:first ?faq2 .
						?restSecondEl rdf:rest ?restThirdEl .
						?restThirdEl rdf:first ?faq3 .
					}
					WHERE { 		
							welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
							{							
								{
      								OPTIONAL {
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
											?bnode rdf:rest ?restSecondEl .
											?restSecondEl rdf:first ?faq2 .  
											?restSecondEl rdf:rest ?restThirdEl . 
											?restThirdEl rdf:first ?faq3 . 
     							 	}
    							}
								UNION
								{
      								OPTIONAL {
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
											?bnode rdf:rest ?restSecondEl .
											?restSecondEl rdf:first ?faq2 .  
 									} 
    							}
								UNION
								{
      								OPTIONAL { 	
											welcome:KMSNotifies welcome:ExternalFaqID ?bnode .
											?bnode rdf:first ?faq1 .
									}
								}
						}
					}"""^^xsd:string ;
		]) .

:UpdateDeleteInternalFAQNotificationAgentKnowledge
	a bt:Update ;
	rdfs:label "Update: Delete Internal FAQ Notification from LAKR" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					DELETE{
						welcome:KMSNotifies welcome:FAQRequest ?val .
					}
					WHERE { 
						welcome:KMSNotifies welcome:FAQRequest ?val .
					}
					"""^^xsd:string ;
		]) .
		
#:ConditionInternalFAQ
#	a bt:Condition ;
#	rdfs:label "Condition: Internal FAQ?" ;
#	bt:query ([
#		a bt:AskQuery ;
#		bt:originBase ajan:ExecutionKnowledge ;
#		bt:sparql """
#					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
#					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
#					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
#					ASK
#					WHERE {
#							welcome:KMSNotifies welcome:FAQRequest ?val .													
#					}"""^^xsd:string ;
#		]) .
		
:UpdateCreateFAQDIPinExecution_Part1
	a bt:Update ;
	rdfs:label "Update: FAQ DIP in Execution - Part 1" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>			
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					INSERT  {
						welcome:FAQ rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#DIP"^^xsd:anyURI .
						welcome:FAQ welcome:hasDIPStatus welcome:Unknown .
						welcome:FAQ welcome:hasSlot welcome:informAnswer .
						welcome:FAQ welcome:isCurrentDIP "true"^^xsd:boolean . 
						welcome:informAnswer rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI .
						welcome:informAnswer welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI . 
						welcome:informAnswer welcome:hasTemplateId "TInformAnswer"^^xsd:string .
						welcome:informAnswer welcome:hasInputRDFContents welcome:Unknown .
						welcome:informAnswer welcome:hasTCNAnswer welcome:Unknown .
						welcome:informAnswer welcome:hasStatus welcome:Pending .
						welcome:informAnswer welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informAnswer welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informAnswer welcome:isOptional "false"^^xsd:boolean .	
						welcome:informAnswer welcome:dependsOn welcome:Unknown .
						welcome:informAnswer welcome:associatedWith welcome:Unknown .
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}
					"""^^xsd:string ;
		]) .	
		
:UpdateCreateFAQDIPinExecution_Part2
	a bt:Update ;
	rdfs:label "Update: FAQ DIP in Execution - Part 2" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>			
					INSERT  {											
						welcome:FAQ welcome:hasSlot welcome:obtainSatisfaction .
						welcome:obtainSatisfaction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI . 
						welcome:obtainSatisfaction welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
						welcome:obtainSatisfaction welcome:hasTemplateId "TObtainSatisfaction"^^xsd:string .
						welcome:obtainSatisfaction welcome:hasInputRDFContents welcome:Unknown .
						welcome:obtainSatisfaction welcome:hasTCNAnswer welcome:Unknown .
						welcome:obtainSatisfaction welcome:hasStatus welcome:Pending .
						welcome:obtainSatisfaction welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:obtainSatisfaction welcome:confidenceScore "0.0"^^xsd:float .
						welcome:obtainSatisfaction welcome:isOptional "false"^^xsd:boolean .
						welcome:obtainSatisfaction welcome:dependsOn welcome:Unknown .
						welcome:obtainSatisfaction welcome:associatedWith welcome:Unknown .	
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}
					"""^^xsd:string ;
		]) .	
		
:UpdateCreateFAQDIPinExecution_Part3
	a bt:Update ;
	rdfs:label "Update: FAQ DIP in Execution - Part 3" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>			
					INSERT  {
						welcome:FAQ welcome:hasSlot welcome:informFollowUpAnswer .
						welcome:informFollowUpAnswer rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI . 
						welcome:informFollowUpAnswer welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI . 
						welcome:informFollowUpAnswer welcome:hasTemplateId "TInformAnswer"^^xsd:string .
						welcome:informFollowUpAnswer welcome:hasInputRDFContents welcome:Unknown .
						welcome:informFollowUpAnswer welcome:hasTCNAnswer welcome:Unknown .
						welcome:informFollowUpAnswer welcome:hasStatus welcome:Pending .
						welcome:informFollowUpAnswer welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informFollowUpAnswer welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informFollowUpAnswer welcome:isOptional "false"^^xsd:boolean .
						welcome:informFollowUpAnswer welcome:dependsOn welcome:obtainSatisfaction .
						welcome:informFollowUpAnswer welcome:associatedWith welcome:Unknown .						
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	]) .

:UpdateCreateFAQDIPinExecution_Part4
	a bt:Update ;
	rdfs:label "Update: FAQ DIP in Execution - Part 4" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>			
					INSERT  {						
						welcome:FAQ welcome:hasSlot welcome:obtainFollowUpSatisfaction .
						welcome:obtainFollowUpSatisfaction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI . 
						welcome:obtainFollowUpSatisfaction welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
						welcome:obtainFollowUpSatisfaction welcome:hasTemplateId "TObtainFollowUpSatisfaction"^^xsd:string .
						welcome:obtainFollowUpSatisfaction welcome:hasInputRDFContents welcome:Unknown .
						welcome:obtainFollowUpSatisfaction welcome:hasTCNAnswer welcome:Unknown .
						welcome:obtainFollowUpSatisfaction welcome:hasStatus welcome:Pending .
						welcome:obtainFollowUpSatisfaction welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:obtainFollowUpSatisfaction welcome:confidenceScore "0.0"^^xsd:float .
						welcome:obtainFollowUpSatisfaction welcome:isOptional "false"^^xsd:boolean .
						welcome:obtainFollowUpSatisfaction welcome:dependsOn welcome:Unknown .
						welcome:obtainFollowUpSatisfaction welcome:associatedWith welcome:Unknown .
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	]) .
				
:UpdateCreateFAQDIPinExecution_Part5
	a bt:Update ;
	rdfs:label "Update: FAQ DIP in Execution - Part 5" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>			
					INSERT  {
						welcome:FAQ welcome:hasSlot welcome:obtainFAQSatisfaction .
						welcome:obtainFAQSatisfaction rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemDemand"^^xsd:anyURI . 
						welcome:obtainFAQSatisfaction welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
						welcome:obtainFAQSatisfaction welcome:hasInputRDFContents welcome:Unknown .
						welcome:obtainFAQSatisfaction welcome:hasTCNAnswer welcome:Unknown .
						welcome:obtainFAQSatisfaction welcome:hasStatus welcome:Pending .
						welcome:obtainFAQSatisfaction welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:obtainFAQSatisfaction welcome:confidenceScore "0.0"^^xsd:float .
						welcome:obtainFAQSatisfaction welcome:isOptional "false"^^xsd:boolean .
						welcome:obtainFAQSatisfaction welcome:dependsOn welcome:Unknown .
						welcome:obtainFAQSatisfaction welcome:associatedWith welcome:Unknown .						
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	]) .

:UpdateCreateFAQDIPinExecution_Part6
	a bt:Update ;
	rdfs:label "Update: FAQ DIP in Execution - Part 6" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>			
					INSERT  {						
						welcome:FAQ welcome:hasSlot welcome:informInabilityAssist .
						welcome:informInabilityAssist rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI . 
						welcome:informInabilityAssist welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI . 
						welcome:informInabilityAssist welcome:hasTemplateId "TInformInabilityAssist"^^xsd:string .
						welcome:informInabilityAssist welcome:hasInputRDFContents welcome:Unknown .
						welcome:informInabilityAssist welcome:hasTCNAnswer welcome:Unknown .
						welcome:informInabilityAssist welcome:hasStatus welcome:Pending .
						welcome:informInabilityAssist welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informInabilityAssist welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informInabilityAssist welcome:isOptional "false"^^xsd:boolean .
						welcome:informInabilityAssist welcome:dependsOn welcome:obtainSatisfaction,  welcome:obtainFollowUpSatisfaction .
						welcome:informInabilityAssist welcome:associatedWith welcome:Unknown .
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	]) .
				
:UpdateCreateFAQDIPinExecution_Part7
	a bt:Update ;
	rdfs:label "Update: FAQ DIP in Execution - Part 7" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>			
					INSERT  {
						welcome:FAQ welcome:hasSlot welcome:informGenericContact .
						welcome:informGenericContact rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#SystemInfo"^^xsd:anyURI . 
						welcome:informGenericContact welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Template"^^xsd:anyURI . 
						welcome:informGenericContact welcome:hasTemplateId "TInformGenericContact"^^xsd:string .
						welcome:informGenericContact welcome:hasInputRDFContents welcome:Unknown .
						welcome:informGenericContact welcome:hasTCNAnswer welcome:Unknown .
						welcome:informGenericContact welcome:hasStatus welcome:Pending .
						welcome:informGenericContact welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:informGenericContact welcome:confidenceScore "0.0"^^xsd:float .
						welcome:informGenericContact welcome:isOptional "false"^^xsd:boolean .
						welcome:informGenericContact welcome:dependsOn welcome:Unknown .
						welcome:informGenericContact welcome:associatedWith welcome:Unknown .						
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	]) .

:UpdateCreateFAQDIPinExecution_Part8
	a bt:Update ;
	rdfs:label "Update: FAQ DIP in Execution - Part 8" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:ExecutionKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
					PREFIX ajan: <http://www.ajan.de/ajan-ns#>			
					INSERT  {						
						welcome:FAQ welcome:hasSlot welcome:obtainContinueInterest .
						welcome:obtainContinueInterest rdf:type "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#ConfirmationRequest"^^xsd:anyURI . 
						welcome:obtainContinueInterest welcome:hasOntologyType "https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Boolean"^^xsd:anyURI .
						welcome:obtainContinueInterest welcome:hasTemplateId "TObtainContinueInterest"^^xsd:string .
						welcome:obtainContinueInterest welcome:hasInputRDFContents welcome:Unknown .
						welcome:obtainContinueInterest welcome:hasTCNAnswer welcome:Unknown .
						welcome:obtainContinueInterest welcome:hasStatus welcome:Pending .
						welcome:obtainContinueInterest welcome:hasNumberAttempts "0"^^xsd:int .
						welcome:obtainContinueInterest welcome:confidenceScore "0.0"^^xsd:float .
						welcome:obtainContinueInterest welcome:isOptional "false"^^xsd:boolean .
						welcome:obtainContinueInterest welcome:dependsOn welcome:Unknown .
						welcome:obtainContinueInterest welcome:associatedWith welcome:Unknown .
					}
					WHERE {
						?agent rdf:type ajan:Agent .
					}"""^^xsd:string ;
	]) .

:UpdateCreateHeaderAppMessageFAQSuggestion
	a bt:Update ;
	rdfs:label "Update: Header Message for App - FAQ Suggestion" ;
	bt:query ([
		a bt:UpdateQuery ;
		bt:originBase ajan:AgentKnowledge ;
		bt:sparql """
					PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
					PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
					PREFIX employment: <http://localhost:8060/welcome/integration/coordination/ajan/agents/welcome/services/CreateCV.owl#>
					DELETE{
						?headerNameSubject welcome:hasHeaderName ?headerValName . 
						?headerValSubject welcome:hasHeaderValue ?headerVal . 
					}
					INSERT {
						welcome:headerCorrelation welcome:hasHeaderName "X-Correlation-ID" .
						welcome:headerCorrelation welcome:hasHeaderValue ?correlationID .
						welcome:headerUserID welcome:hasHeaderName "X-User-ID" .
						welcome:headerUserID welcome:hasHeaderValue ?id .					
						welcome:headerMsgType welcome:hasHeaderName "X-Msg-Type" .
						welcome:headerMsgType welcome:hasHeaderValue "FAQSuggestion" .
					} 
					WHERE { 
						?msg welcome:hasCorrelationID ?correlationID .
						?du rdf:type welcome:DialogueUser .
						?du welcome:hasUserId ?idObject .
						?idObject welcome:hasValue ?id .
						OPTIONAL { ?headerNameSubject welcome:hasHeaderName ?headerValName . }
						OPTIONAL { ?headerValSubject welcome:hasHeaderValue ?headerVal . }
					}
					"""^^xsd:string ;
		]) .
				
:MessageSendFoundFAQtoApp
	a myWelcome:Message ;
	rdfs:label "Message: Send FAQ ID to App"^^xsd:string ;
	rdfs:comment "Message: Send FAQ ID to App"^^xsd:string ;
	bt:targetBase ajan:ExecutionKnowledge ;  
	myWelcome:correlatorId [
		a bt:SelectQuery;
		bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?correlatorId
				WHERE {
						?msg welcome:hasCorrelationID ?correlatorId .
				}"""^^xsd:string
	] ;
	bt:binding [
		a http-core:Request ;
		http-core:httpVersion "1.1"^^xsd:string ;
		http-core:mthd http-methods:POST ;
		bt:headers [
			a bt:SelectQuery;
			a bt:QueryUri ;
			bt:originBase ajan:AgentKnowledge ;
			bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				SELECT ?hdrName ?fieldValue
				WHERE {
						?headerName welcome:hasHeaderName ?hdrName .
						?headerName welcome:hasHeaderValue ?fieldValue .					
				}"""^^xsd:string
		] ;	
		http-core:headers ([
					a http-core:Header ;						
					http-core:hdrName http-headers:accept ;
					http-core:fieldValue "text/turtle"
				][
					a http-core:Header ;
					http-core:hdrName http-headers:content-type ;
					http-core:fieldValue "application/ld+json"
				]
		) ;			
		http-core:body [
			a actn:Payload ;
			bt:query [
				rdf:type bt:ConstructQuery ;
				bt:originBase ajan:ExecutionKnowledge ;
				bt:sparql """
						PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
						PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
						PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
						CONSTRUCT  {
							welcome:notificationTitle welcome:ExternalFAQ ?bnode .
							?bnode welcome:FAQId ?faq1 .
						}
						WHERE {							
							?bnode rdf:first ?faq1 .
						}"""^^xsd:string
		  ]
		] ;    
	] ;
	bt:queryUri [
	a bt:SelectQuery ;
	a bt:QueryUri ;
	bt:originBase ajan:AgentKnowledge ;
	bt:sparql """
				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
				SELECT ?requestURI 
				WHERE
				{
				  welcome:dispatcher welcome:hasAddress ?partialAddress .
				  BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )
				}"""^^xsd:string
	] . 
#	bt:queryUri [
#	a bt:SelectQuery ;
#	a bt:QueryUri ;
#	bt:originBase ajan:AgentKnowledge ;  
#	bt:sparql """
#				PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#				PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#				SELECT ?requestURI 
#				WHERE
#				{
#				  welcome:dispatcher welcome:hasAddress ?partialAddress .
#				  BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#				}"""^^xsd:string
#	] .
  
#=============================================================================================
# ShutdownBTBehavior

:EventHandlerShutdown
  a bt:HandleEvent ;
  rdfs:label "EventHandler: Shutdown Request" ;
  bt:event <http://localhost:8090/rdf4j/repositories/agents#AgentShutdownEvent> ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:AgentKnowledge ;
          bt:sparql """
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE { 
              ?s ?p ?o .      
            } 
          """^^xsd:string ;
        ] .

:ConditionAgentRunningBT
  a bt:Condition ;
  rdfs:label "Condition: Agent Runs a BT? " ;
  bt:query ([
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          ASK
          WHERE {
            ?agent welcome:hasBTRunning "true"^^xsd:boolean .
            ?agent rdf:type ajan:Agent .              
          }"""^^xsd:string ;
    ]) .
    
:UpdateAgentRunningYes
  a bt:Update ;
  rdfs:label "Update: Not Kill the Agent" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          DELETE {
            ?agent welcome:canBeKilled ?previousVal .
          }
          INSERT {
            ?agent welcome:canBeKilled "false"^^xsd:boolean .
          }
          WHERE {
            ?agent rdf:type ajan:Agent .
            OPTIONAL {
              ?agent welcome:canBeKilled ?previousVal .
            }
          }         
          """^^xsd:string ;
    ]) .

:UpdateAgentRunningNot
  a bt:Update ;
  rdfs:label "Update: Kill the Agent" ;
  bt:query ( [
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          DELETE {
            ?agent welcome:canBeKilled ?previousVal .
          }
          INSERT {
            ?agent welcome:canBeKilled "true"^^xsd:boolean .
          }
          WHERE {
            ?agent rdf:type ajan:Agent .
            OPTIONAL {
              ?agent welcome:canBeKilled ?previousVal .
            }
          }         
          """^^xsd:string ;
    ]) .

:MessageSendShutdownNotification
  a myWelcome:Message ;
  rdfs:label "Message: Send Shutdown Notification to WPM"^^xsd:string ;
  rdfs:comment "Message: Send Shutdown Notification to WPM"^^xsd:string ;
  bt:targetBase ajan:AgentKnowledge ;  
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?hdrName ?userID
        WHERE {
             VALUES ?hdrName {"X-User-ID"}
             ?du rdf:type welcome:DialogueUser .
             ?du welcome:hasUserId ?idObject .
            ?idObject welcome:hasValue ?id .
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;            
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle;charset=UTF-8"
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "application/ld+json"
        ]
    ) ; 
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:sparql """
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
            CONSTRUCT {
              ?agent welcome:canBeKilled ?val .
            }
            WHERE {
              ?agent welcome:canBeKilled ?val .
            }"""^^xsd:string
      ]
    ] ;    
  ] ;
  bt:queryUri [
  a bt:SelectQuery ;
  a bt:QueryUri ;
  bt:originBase ajan:AgentKnowledge ;
  bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
        SELECT ?requestURI 
        WHERE
        {
          welcome:dispatcher welcome:hasAddress ?partialAddress .
          BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentShutdownAcknowledgement") AS ?requestURI )
        }"""^^xsd:string
  ] . 
# bt:queryUri [
# a bt:SelectQuery ;
# a bt:QueryUri ;
# bt:originBase ajan:AgentKnowledge ;  
# bt:sparql """
#       PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
#       PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#       SELECT ?requestURI 
#       WHERE
#       {
#         welcome:dispatcher welcome:hasAddress ?partialAddress .
#         BIND(CONCAT(STR(?partialAddress), "/dms/receiveDIP") AS ?requestURI )
#       }"""^^xsd:string
# ] .

###################################################################
################### S4 and S9 #####################################
###################################################################

#-------------LCC Protocol BTs END--------------------------
#-------------LCC Protocol BT Nodes START--------------------------
:HandleStartLccAssessmentEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: start LCC Assessment Event" ;
  bt:event agents:StartLccAssessmentEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            #?s ?p ?o .

            ?subjectIri    rdf:type    welcome:LCCLesson ;
                      welcome:hasLessonId   ?lessonId ;
                      welcome:hasAssessmentDeadline     ?assessmentDeadline .
          }
          WHERE {
            #?s ?p ?o .
            ?subjectIri rdf:type    welcome:LCCLesson ;
                welcome:hasLessonId   ?lessonId ;
                welcome:hasAssessmentDeadline     ?assessmentDeadline .
          }"""^^xsd:string ;
        ] .

:MessageToAppToStartLccAssessment
  a myWelcome:Message ;
  rdfs:label "Message: Start LCC Assessment"^^xsd:string ;
  rdfs:comment ""^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT DISTINCT ?hdrName ?fieldValue
        WHERE { 
          {
#            ?headerName welcome:hasHeaderName ?hdrName .
#            ?headerName welcome:hasHeaderValue ?fieldValue .

             VALUES ?hdrName {"X-Correlation-ID"}
             OPTIONAL {
                  welcome:message  welcome:hasCorrelationID  ?corrId.
              }
              BIND( IF(BOUND(?corrId), ?corrId, "NoneInLakr") AS ?fieldValue)
          } UNION {
              VALUES ?hdrName {"X-User-ID"}
              
              OPTIONAL {
                  ?tcn_user   rdf:type  welcome:DialogueUser ;
                              welcome:hasUserId ?userIdBNode .
                  ?userIdBNode  welcome:hasValue  ?userId . 
              }

              BIND( IF(BOUND(?userId), ?userId, "NoneInLakr") AS ?fieldValue)
          }  UNION {
              VALUES ?hdrName {"X-Msg-Type"}
              VALUES ?fieldValue {"Assessment"}
          }           
        }

"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "application/ld+json"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "application/ld+json"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

            CONSTRUCT {
            ?subjectIri    rdf:type    welcome:LCCLesson ;
                      welcome:hasLessonId   ?lessonId ;
                      welcome:hasAssessmentDeadline     ?assessmentDeadline .
            }
            WHERE {
            ?subjectIri    rdf:type    welcome:LCCLesson ;
                      welcome:hasLessonId   ?lessonId ;
                      welcome:hasAssessmentDeadline     ?assessmentDeadline .
              }
        """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          SELECT DISTINCT ?requestURI
          WHERE {
            # LINE TO SEND TO DUMMY ENDPOINT
            #VALUES ?requestURI { "http://localhost:8092/app/inform"}
            
            # LINES TO SEND TO ACTUAL DISPATCHER Endpoint
            welcome:dispatcher welcome:hasAddress ?partialAddress .
            BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentNotification") AS ?requestURI )

          }"""^^xsd:string
  ] .

:SaveLccAssessmentConfig
  a bt:Write ;
  rdfs:label "Write: LCC Assessment Config info to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          CONSTRUCT {
            ?subjectIri    rdf:type    welcome:LCCLesson ;
                      welcome:hasLessonId   ?lessonId ;
                      welcome:hasAssessmentDeadline     ?assessmentDeadline .
          }
          WHERE {
            ?subjectIri    rdf:type    welcome:LCCLesson ;
                      welcome:hasLessonId   ?lessonId ;
                      welcome:hasAssessmentDeadline     ?assessmentDeadline .
          }
    """^^xsd:string ;
  ] .


:HandleLccAssessmentCompleteEvent
  a bt:HandleEvent ;
  rdfs:label "EventHandler: LCC Assessment Complete Event" ;
  bt:event agents:LccAssessmentCompleteEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            ?s ?p ?o .
            #?subjectIri rdf:type  welcome:LCCLesson ;
             #   welcome:hasLessonId    ?lessonId ;
             #                 welcome:hasAssessmentScore  ?assessmentScore ;
              #                welcome:hasReadingScore     ?readingScore ;
               #                 welcome:hasWritingScore     ?writingScore ;
                #                welcome:hasListeningScore   ?listeningScore ;
                 #               welcome:hasVocabularyScore  ?vocabularyScore .
          }
          WHERE {
            ?s ?p ?o .
            #?subjectIri rdf:type  welcome:LCCLesson ;
             #   welcome:hasLessonId    ?lessonId ;
              #                welcome:hasAssessmentScore  ?assessmentScore ;
               #               welcome:hasReadingScore     ?readingScore ;
                #                welcome:hasWritingScore     ?writingScore ;
                 #               welcome:hasListeningScore   ?listeningScore ;
                  #              welcome:hasVocabularyScore  ?vocabularyScore .
          }"""^^xsd:string ;
        ] .

:SaveLccAssessmentScores
  a bt:Write ;
  rdfs:label "Write: LCC Assessment Scores to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          CONSTRUCT {
          ?s ?p ?o .
          
          #  ?subjectIri rdf:type  welcome:LCCLesson ;
           #     welcome:hasLessonId    ?lessonId ;
            #                  welcome:hasAssessmentScore  ?assessmentScore ;
             #                 welcome:hasReadingScore     ?readingScore ;
              #                  welcome:hasWritingScore     ?writingScore ;
               #                 welcome:hasListeningScore   ?listeningScore ;
                #                welcome:hasVocabularyScore  ?vocabularyScore .
          }
          WHERE {
          ?s ?p ?o .
#            ?subjectIri rdf:type  welcome:LCCLesson ;
 #               welcome:hasLessonId    ?lessonId ;
  #                            welcome:hasAssessmentScore  ?assessmentScore ;
   #                           welcome:hasReadingScore     ?readingScore ;
    #                            welcome:hasWritingScore     ?writingScore ;
     #                           welcome:hasListeningScore   ?listeningScore ;
      #                          welcome:hasVocabularyScore  ?vocabularyScore .
          }
    """^^xsd:string ;
  ] .

:ComputeLccCpl
  a bt:Update ;
  rdfs:label "Update: Compute Course Progress Level of TCN" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          DELETE {
            welcome:tcn_user  welcome:hasLccCpl   ?existingCplScore .
          }
          INSERT{
            welcome:tcn_user  welcome:hasLccCpl ?cpl .
          }
          WHERE{

            {
            SELECT (AVG(?asmScore) as ?cpl)
            WHERE {
            ?subjectIri rdf:type  welcome:LCCLesson ;
                              welcome:hasAssessmentScore  ?assessmentScore .
            BIND((xsd:float(?assessmentScore)) AS ?asmScore)
            }
            }
            
            OPTIONAL{
              welcome:tcn_user  welcome:hasLccCpl   ?existingCplScore .
            }
          }
          """^^xsd:string ;
    ]) .

:WriteLccAttributesToEKB
  a bt:Write ;
  rdfs:label "Write LCC Attributes to EKB to be send to TP" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          CONSTRUCT {
            welcome:tcn_user
                      welcome:hasGender ?gender ;
                      welcome:hasNationality  ?nation ;
                      welcome:hasLccGenderPreference  ?genderPreference ;
                      welcome:hasLccNationPreference  ?nationPreference ;
                      welcome:hasName ?tcnName .
          }
          WHERE {
            welcome:tcn_user
                      welcome:hasGender ?genderBnode ;
                      welcome:hasNationality  ?nationBnode .
            ?genderBnode  welcome:hasValue  ?gender .
            ?nationBnode  welcome:hasValue  ?nation .

            OPTIONAL{
              welcome:tcn_user 
                              welcome:hasLccGenderPreference  ?lccGenderPrefBnode .
              ?lccGenderPrefBnode   welcome:hasValue  ?lccGenderPref .

              }
            BIND( IF(BOUND(?lccGenderPref), ?lccGenderPref, "None") AS ?genderPreference)


            OPTIONAL{
              welcome:tcn_user 
                              welcome:hasLccNationPreference  ?lccNationPrefBnode .
              ?lccNationPrefBnode   welcome:hasValue  ?lccNationPref .
            }
            BIND( IF(BOUND(?lccNationPref), ?lccNationPref, "None") AS ?nationPreference)

            OPTIONAL {
                welcome:tcn_user welcome:hasName  ?tcnNameNode .
                ?tcnNameNode  welcome:hasValue  ?tcnName .
            }
          }
    """^^xsd:string ;
  ] .

:WriteLccAttributesToEKB-old
  a bt:Write ;
  rdfs:label "Write: LCC Attributes to EKB to be send to TP" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          CONSTRUCT {
            welcome:DialogueUser
                      welcome:hasGender ?gender ;
                      welcome:hasNationality  ?nation ;
                      welcome:hasLccGenderPreference  ?lccGenderPref ;
                      welcome:hasLccNationPreference  ?lccNationPref ;
                      welcome:hasName ?tcnName .
          }
          WHERE {
            welcome:DialogueUser
                      welcome:hasGender ?gender ;
                      welcome:hasNationality  ?nation ;
                      welcome:hasLccGenderPreference  ?lccGenderPref ;
                      welcome:hasLccNationPreference  ?lccNationPref .
            OPTIONAL {
                welcome:tcn_user welcome:hasName  ?tcnNameNode .
                ?tcnNameNode  welcome:hasValue  ?tcnName .
            }
          }
    """^^xsd:string ;
  ] .

:WriteAgentId2Execution
  a bt:Write ;
  rdfs:label "Write: ID of agent to Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
      PREFIX ajan: <http://www.ajan.de/ajan-ns#>
      CONSTRUCT  {
        ?agentUri rdf:type  ajan:Agent, ajan:ThisAgent ;
              ajan:agentId  ?agentName .
      }
      WHERE {
        ?agentUri rdf:type  ajan:Agent ;
              ajan:agentId  ?agentName .
      } """^^xsd:string ;
  ] .
  
:MessageToTpToSubmitLccAssessmentInfo
  a myWelcome:Message ;
  rdfs:label "Message: Submit Assessment Scores to Teacher Panel"^^xsd:string ;
  rdfs:comment ""^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT DISTINCT ?hdrName ?fieldValue
        WHERE { 
          {
#            ?headerName welcome:hasHeaderName ?hdrName .
#            ?headerName welcome:hasHeaderValue ?fieldValue .

             VALUES ?hdrName {"X-Correlation-ID"}
             OPTIONAL {
                  welcome:message  welcome:hasCorrelationID  ?corrId.
              }
              BIND( IF(BOUND(?corrId), ?corrId, "NoneInLakr") AS ?fieldValue)
          } UNION {
              VALUES ?hdrName {"X-User-ID"}
              
              OPTIONAL {
                  ?tcn_user   rdf:type  welcome:DialogueUser ;
                              welcome:hasUserId ?userIdBNode .
                  ?userIdBNode  welcome:hasValue  ?userId . 
              }

              BIND( IF(BOUND(?userId), ?userId, "NoneInLakr") AS ?fieldValue)
          }  UNION {
              VALUES ?hdrName {"X-Msg-Type"}
              VALUES ?fieldValue {"Assessment-Scores"}
          }           
        }
        """^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            CONSTRUCT {
#            ?s ?p ?o.
            ?agentUri <http://www.ajan.de/ajan-ns#agentId> ?agentId ;
                  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasName> ?tcnName ;
                  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasGender> ?gender ;
                  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasNationality>  ?nation ;
                  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasLccGenderPreference>  ?lccGenderPref ;
                  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasLccNationPreference>  ?lccNationPref .
            ?subjectIri <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#LCCLesson> ;
                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasLessonId>    ?lessonId ;
                              <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasAssessmentScore>  ?assessmentScore ;
                              <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasReadingScore>     ?readingScore ;
                                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasWritingScore>     ?writingScore ;
                                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasListeningScore>   ?listeningScore ;
                                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasVocabularyScore>  ?vocabularyScore .
            }
            WHERE {
#            ?s ?p ?o .

            ?agentUri <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <http://www.ajan.de/ajan-ns#Agent> ;
                  <http://www.ajan.de/ajan-ns#agentId>  ?agentId .
            <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#tcn_user>
                      <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasGender> ?gender ;
                      <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasNationality>  ?nation ;
                      <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasLccGenderPreference>  ?lccGenderPref ;
                      <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasLccNationPreference>  ?lccNationPref .

            OPTIONAL {
                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#tcn_user> <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasName>  ?tcnName .
           }
           ?subjectIri <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#LCCLesson> ;
                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasLessonId>    ?lessonId ;
                              <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasAssessmentScore>  ?assessmentScore ;
                              <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasReadingScore>     ?readingScore ;
                                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasWritingScore>     ?writingScore ;
                                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasListeningScore>   ?listeningScore ;
                                <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasVocabularyScore>  ?vocabularyScore .
              }
        """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          # LINES TO SEND TO DUMMY ENDPOINT 
          #PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          #PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          #PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          #PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          #SELECT DISTINCT ?requestURI
          #WHERE {
          # VALUES ?requestURI { "http://localhost:8092/teacherPanel/inform"}

          #}

          # LINES TO SEND TO ACTUAL ENDPOINT OF DISPATCHER FOR TP 
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
          SELECT ?requestURI
          WHERE
          {
            welcome:dispatcher welcome:hasAddress ?partialAddress .
            BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/messageToTeacher") AS ?requestURI )
          }
          """^^xsd:string
  ] .


:HandleLccFinalResultEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: LCC Final Result Submission Event" ;
  bt:event agents:SubmitFinalLccResultEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            #?s ?p ?o .

            ?lccSolutionSubjectIri  rdf:type        welcome:LCCUseCase ;
                                              welcome:hasId     ?lccId ;
                                              welcome:hasFinalSolution    ?lccSolution .

            ?lccSolution        rdf:type        welcome:Grouping ;
                        welcome:hasMembers    ?group.

            ?group                rdf:type      welcome:Group ;
                        welcome:hasMembers    ?memberAgentId .
          }
          WHERE {
            #?s ?p ?o .
            ?lccSolutionSubjectIri  rdf:type        welcome:LCCUseCase ;
                                              welcome:hasId     ?lccId ;
                                              welcome:hasFinalSolution    ?lccSolution .

            ?lccSolution        rdf:type        welcome:Grouping ;
                        welcome:hasMembers    ?group.

            ?group                rdf:type      welcome:Group ;
                        welcome:hasMembers    ?memberAgentId .

          }"""^^xsd:string ;
        ] .

:SaveLccFinalResult
  a bt:Write ;
  rdfs:label "Write: LCC Final Result Submission by TP to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          CONSTRUCT {
            ?lccSolutionSubjectIri  rdf:type        welcome:LCCUseCase ;
                                              welcome:hasId     ?lccId ;
                                              welcome:hasFinalSolution    ?lccSolution .

            ?lccSolution        rdf:type        welcome:Grouping ;
                        welcome:hasMembers    ?group.

            ?group                rdf:type      welcome:Group ;
                        welcome:hasMembers    ?memberAgentId .
          }
          WHERE {
            ?lccSolutionSubjectIri  rdf:type        welcome:LCCUseCase ;
                                              welcome:hasId     ?lccId ;
                                              welcome:hasFinalSolution    ?lccSolution .

            ?lccSolution        rdf:type        welcome:Grouping ;
                        welcome:hasMembers    ?group.

            ?group                rdf:type      welcome:Group ;
                        welcome:hasMembers    ?memberAgentId .
          }
    """^^xsd:string ;
  ] .

:HandleStartLccProcessEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: start LCC Process Event" ;
  bt:event agents:StartLccProcessEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            #?s ?p ?o .
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasParticipants ?pAgentId ;
                welcome:hasLessonId ?lessonId ;
                welcome:hasDedicatedAgent ?dAgentId ;
                mac:hasId ?lccId ;
                welcome:hasSdWeight ?cplWeight ;
                welcome:hasMinSize     ?minSize ;
                welcome:hasMaxSize     ?maxSize ;
                welcome:hasAbsenceAllowance  ?allowedAbsence .
          }
          WHERE {
            #?s ?p ?o .
            ?bnode  rdf:type  welcome:LCCUseCase ;
                welcome:hasParticipants ?pAgentId ;
                welcome:hasLessonId ?lessonId ;
                welcome:hasDedicatedAgent ?dAgentId ;
                welcome:hasId ?lccId ;
                welcome:hasCPLWeight  ?cplWeight ;
                welcome:hasMinSize     ?minSize ;
                welcome:hasMaxSize     ?maxSize ;
                welcome:hasAbsenceAllowance  ?allowedAbsence .

          }"""^^xsd:string ;
        ] .

:WriteRootAddress2Exec
  a bt:Write ;
  rdfs:label "Write: Root Address of Agents to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          CONSTRUCT {
            ?agent  welcome:hasRootAddress  ?rootAddress .
          }
          WHERE {
            ?agent  rdf:type ajan:Agent .
            ?du   rdf:type  welcome:DialogueUser ;
                welcome:hasRootAddress  ?rootAddress .
          }
    """^^xsd:string ;
  ] .

:ConditionDedicatedAgent
  a bt:Condition ;
  rdfs:label "Condition: Is this Dedicated Agent?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          ASK
          WHERE {
            ?agent  rdf:type  ajan:Agent ;
                ajan:agentId  ?agentId .

            ?bnode  rdf:type  welcome:LCCUseCase ;
                welcome:hasDedicatedAgent ?agentId .
            }"""^^xsd:string ;
    ]) .

:ProduceLccDedicatedAgentBehaviorEvent
  a bt:EventProducer ;
  rdfs:label "EventProducer: LCC Dedicated Agent Behavior Event" ;
  ajan:event agents:LccDedicatedAgentBehaviorEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:ExecutionKnowledge;
          bt:sparql """
            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE {
              ?s ?p ?o .
            }"""^^xsd:string ;
        ] .

:WriteLccPersonalInfoToEKB
  a bt:Write ;
  rdfs:label "Write LCC Personal Info to EKB for the particular LCC Process" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            ?agent  welcome:hasLCCPersonalInfo  ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId .
          }
          WHERE {
            ?agent  rdf:type ajan:Agent .

            welcome:tcn_user
              welcome:hasGender ?genderBnode ;
              welcome:hasNationality  ?nationalityBnode .

            OPTIONAL {
                welcome:tcn_user    welcome:hasAttendedLessonIDs    ?attendedLessonId .
            }
            ?genderBnode  welcome:hasValue  ?gender .
            ?nationalityBnode   welcome:hasValue  ?nationality .
            OPTIONAL {
              welcome:tcn_user    welcome:hasLccCpl   ?lccCpl ;
            }
              #FILTER(!isIRI(?gender))
              
              {BIND(BNODE() AS ?bnode)}
          }
    """^^xsd:string ;
  ] .


:WriteAgentAddresses2Exec
  a bt:Insert ;
  rdfs:label "Insert: Addresses of other agents from LAR to Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:LocalAgentsKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX welcome-sw: <http://www.semanticweb.org/welcome#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            ?agentUri ajan:agentId  ?agentId, ?agentName ;
                      welcome:hasAddress  ?address .
          }
          WHERE {
              ?agentUri rdf:type  ajan:Agent ;
                        welcome:hasAddress ?address .
#              OPTIONAL {
 #               ?agentUri   ajan:agentId  ?agentId .   
  #            }

              OPTIONAL {
                ?agentUri   ajan:agentName  ?agentName .   
              }
              
          }
    """^^xsd:string ;
  ] .


:Message2DedicatedLccPersonalInfo
  a myWelcome:Message ;
  rdfs:label "Message: Return Personal Info to Dedicated agent for LCC"^^xsd:string ;
  rdfs:comment ""^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?hdrName ?fieldValue
        WHERE { 
            ?headerName welcome:hasHeaderName ?hdrName .
            ?headerName welcome:hasHeaderValue ?fieldValue .            
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            CONSTRUCT {
              ?agent  ajan:agentId  ?agentName ;
                  welcome:hasLCCPersonalInfo  ?bnode .

              ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                  welcome:hasGender ?gender ;
                  welcome:hasNationality  ?nationality ;
                  welcome:hasLccCpl   ?lccCpl ;
                  welcome:hasAttendedLessonIDs  ?attendedLessonId ;
                  mac:hasId ?lccId .
            }
            WHERE {
              ?agent  rdf:type ajan:Agent ;
                  ajan:agentId  ?agentName ;
                  welcome:hasLCCPersonalInfo  ?bnode .

              ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                  welcome:hasGender ?gender ;
                  welcome:hasNationality  ?nationality ;
                  welcome:hasLccCpl   ?lccCpl .
#                  welcome:hasAttendedLessonIDs  ?attendedLessonId .
              OPTIONAL {
                  ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                          welcome:hasAttendedLessonIDs  ?attendedLessonId .
              }
              ?bnode2 rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId .

        }"""^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          SELECT DISTINCT ?requestURI
          WHERE {

          #?agent rdf:type  ajan:Agent ;
          #   welcome:hasRootAddress ?rootAddress .

          ?bnode  rdf:type  welcome:LCCUseCase ;
              welcome:hasDedicatedAgent ?dAgentId .

          ?agentUri ajan:agentId  ?dAgentId ;
                welcome:hasAddress  ?address .

          BIND(CONCAT(?address, "?capability=receiveLccPersonalInfo") AS ?requestURI )
          }"""^^xsd:string
  ] .

:AddAttendanceLessonID
  a bt:Insert ;
  rdfs:label "Insert Agent has Attended given Lesson ID" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          CONSTRUCT {
            welcome:tcn_user  welcome:hasAttendedLessonIDs  ?lessonId .
          }
          WHERE {
            ?lccLessonIri   rdf:type  welcome:LCCLesson ;
                            welcome:hasLessonId   ?lessonId .
          }
    """^^xsd:string ;
  ] .


:InsertLccPersonalInfo2LakrWithLccId
  a bt:Insert ;
  rdfs:label "Insert: LCC Personal Info to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          CONSTRUCT {
            ?agent  welcome:hasLCCPersonalInfo  ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId ;
                mac:hasId ?lccId .

          }
          WHERE {
            ?agent  rdf:type ajan:Agent ;
                welcome:hasLCCPersonalInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId .

            ?bnode2 rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId .
          }
    """^^xsd:string ;
  ] .

:JustFail
  a bt:Fail ;
  rdfs:label "fail node"^^xsd:string .
  
:WriteLccPersonalInfo2LakrWithLccId
  a bt:Write ;
  rdfs:label "Write: LCC Personal Info to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          CONSTRUCT {
            ?agent  welcome:hasLCCPersonalInfo  ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId ;
                mac:hasId ?lccId .

          }
          WHERE {
            ?agent  rdf:type ajan:Agent ;
                welcome:hasLCCPersonalInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId .

            ?bnode2 rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId .
          }
    """^^xsd:string ;
  ] .
  
:Wait10Sec
  a bt:Wait ;
  rdfs:label "Wait 10 seconds" ;
  rdfs:comment "" ;
  bt:milliseconds "10000"^^xsd:int .

:UpdateLccProblem
  a bt:Update ;
  rdfs:label "Update: Add necessary LCC Problem Instance Fields" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          DELETE{
              ?bnode  rdf:type  welcome:LCCUseCase ;
                  ?p ?o .
          }
          INSERT{
              ?lccSubject rdf:type  welcome:LCCUseCase, mac:MACProblemInstance ;
                    ?p ?o ;
                    welcome:hasSdWeight   ?cplWeight ;
                    mac:hasUseCase  "LCC"^^xsd:string ;
                    mac:hasSolver "BOSS"^^xsd:string ;
                    mac:hasNumberOfAgents ?numOfAgents ;
                    mac:hasMinCoalitionSize ?minSize ;
                    mac:hasMaxCoalitionSize ?maxSize .
          }
          WHERE{
            {
              ?bnode  rdf:type  welcome:LCCUseCase ;
                  ?p ?o ;
                  welcome:hasSdWeight ?cplWeight ;
                  #welcome:hasCPLWeight ?cplWeight ;
                  welcome:hasMinSize  ?minSize ;
                  welcome:hasMaxSize  ?maxSize ;
                  mac:hasId ?lccId .
            }
            {
              SELECT (count(?pAgentId) as ?numOfAgents)
              WHERE {
                  ?bnode  rdf:type  welcome:LCCUseCase ;
                      mac:hasParticipants ?pAgentId .
              }
            }
            BIND( IRI(CONCAT(STR(welcome:LCC), STR(?lccId))) AS ?lccSubject )
          }
          """^^xsd:string ;
    ]) .

:WriteLccProblem2Lakr
  a bt:Write ;
  rdfs:label "Write: LCC Problem Instance to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          CONSTRUCT {
            ?agent  welcome:hasInvolvedInMac  ?macId .
            ?macUseCaseSubject  rdf:type  welcome:LCCUseCase, mac:MACProblemInstance ;
                      mac:hasId ?macId ;
                      welcome:hasStatus "Running" ;
                      welcome:hasStartTime  ?now ;
                      ?p  ?o .
          }
          WHERE {
            ?agent  rdf:type ajan:Agent .
            ?macUseCaseSubject  rdf:type  welcome:LCCUseCase ;
                      mac:hasId ?macId ;
                      ?p  ?o .
            BIND(NOW() AS ?now)
          }
    """^^xsd:string ;
  ] .

:ClearExecutionKnowledge
  a bt:Update ;
  rdfs:label "Update: Clear Execution Knowledge" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          DELETE{
            ?s ?p ?o .
          }
          WHERE{
            ?s ?p ?o .
          }
          """^^xsd:string ;
    ]) .

:HandleLccDedicatedAgentEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: dedicated agent behavior Event" ;
  bt:event agents:LccDedicatedAgentBehaviorEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }"""^^xsd:string ;
        ] .

:Wait4LccPersonalInfo
  a bt:Wait ;
  rdfs:label "Wait: wait for agents to return their Personal Info for LCC" ;
  rdfs:comment "" ;
  bt:milliseconds "25000"^^xsd:int .

:WriteCompleteLccPersonalInfo2Exec
  a bt:Write ;
  rdfs:label "Write: LCC Personal Info of all participant agents to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            ?agent  ajan:agentId  ?agentId ;
                welcome:hasLCCPersonalInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId ;
                mac:hasId ?lccId .

          }
          WHERE {
            ?agent  ajan:agentId  ?agentId ;
                welcome:hasLCCPersonalInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                mac:hasId ?lccId .

             OPTIONAL {
                  ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                          welcome:hasAttendedLessonIDs  ?attendedLessonId .
            }
          }
    """^^xsd:string ;
  ] .

:ConditionAllReturnedLccPersonalInfo
  a bt:Condition ;
  rdfs:label "Condition: did all LCC agents return their Personal Info?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX ajan: <http://www.ajan.de/ajan-ns#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
      ASK
      WHERE
      {
        ?bnode  rdf:type  welcome:LCCUseCase ;
            mac:hasParticipants ?pAgentId ;
            mac:hasId ?lccId .

        ?agentUri welcome:hasLCCPersonalInfo  ?bnode2 ;
              ajan:agentId  ?pAgentId .

        ?bnode2   rdf:type  welcome:LCCPersonalInfo ;
              mac:hasId ?lccId .
      }
            """^^xsd:string ;
    ]) .

:HandleReceiveLccPersonalInfoEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: Receive LCC Personal Info Event" ;
  bt:event agents:ReceiveLccPersonalInfoEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }"""^^xsd:string ;
        ] .

:WriteLccPersonalInfoOfSender2Lakr
  a bt:Write ;
  rdfs:label "Write: LCC Personal Info of the sender agent to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            ?agent  ajan:agentId  ?agentId ;
                welcome:hasLCCPersonalInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId ;
                mac:hasId ?lccId .

          }
          WHERE {
            ?agent  ajan:agentId  ?agentId ;
                welcome:hasLCCPersonalInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId ;
                mac:hasId ?lccId .
          }
    """^^xsd:string ;
  ] .

:InsertLccPersonalInfoOfSender2Lakr
  a bt:Insert ;
  rdfs:label "Insert: LCC Personal Info of the sender agent to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            ?agent  ajan:agentId  ?agentId ;
                welcome:hasLCCPersonalInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                welcome:hasAttendedLessonIDs  ?attendedLessonId ;
                mac:hasId ?lccId .

          }
          WHERE {
            ?agent  ajan:agentId  ?agentId ;
                welcome:hasLCCPersonalInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                welcome:hasGender ?gender ;
                welcome:hasNationality  ?nationality ;
                welcome:hasLccCpl   ?lccCpl ;
                mac:hasId ?lccId .

            OPTIONAL {
                  ?bnode  rdf:type  welcome:LCCPersonalInfo ;
                          welcome:hasAttendedLessonIDs  ?attendedLessonId .
            }
          }


    """^^xsd:string ;
  ] .

:ProduceComputeCoalitionsEvent
  a bt:EventProducer ;
  rdfs:label "EventProducer: Compute Possible Coalitions Event" ;
  ajan:event agents:ComputeLccCoalitionStructuresEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:ExecutionKnowledge;
          bt:sparql """

            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE {
              ?s ?p ?o .
            }"""^^xsd:string ;
        ] .

:ProduceLccFailedEvent
  a bt:EventProducer ;
  rdfs:label "EventProducer: LCC Failed Event" ;
  ajan:event agents:LccFailureEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:ExecutionKnowledge;
          bt:sparql """
            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE {
              ?s ?p ?o .
            }"""^^xsd:string ;
        ] .

:HandleComputeCoalitionsEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: Compute Coalition Structures Event" ;
  bt:event agents:ComputeLccCoalitionStructuresEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }"""^^xsd:string ;
        ] .

:ComputeLccCannotLinkConnections
  a bt:Write ;
  rdfs:label "Write: Compute LCC Cannot Link Connections" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          CONSTRUCT {
            ?bnode  mac:hasCannotLinkConnections  ?cannotLinkBnode .

            ?cannotLinkBnode  mac:hasCannotConnect  ?pAgentId, ?pAgentId2 .

          }
          WHERE {
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                welcome:hasLessonId ?lessonId ;
                mac:hasParticipants ?pAgentId, ?pAgentId2 .

            FILTER(?pAgentId != ?pAgentId2)
            FILTER(?pAgentId < ?pAgentId2)

            FILTER(xsd:integer(?lessonId) != 1)

            ?agentUri ajan:agentId  ?pAgentId ;
                  welcome:hasLCCPersonalInfo  ?bnode2 .
            ?bnode2 rdf:type  welcome:LCCPersonalInfo ;
                mac:hasId ?lccId .

            ?agentUri2  ajan:agentId  ?pAgentId2 ;
                  welcome:hasLCCPersonalInfo  ?bnode3 .
            ?bnode3 rdf:type  welcome:LCCPersonalInfo ;
                mac:hasId ?lccId .

            BIND((xsd:integer(?lessonId) - 1) AS ?previousLessonId)

            FILTER NOT EXISTS {
              ?bnode2 welcome:hasAttendedLessonIDs  ?previousLessonId .
            }
            FILTER NOT EXISTS {
              ?bnode3 welcome:hasAttendedLessonIDs  ?previousLessonId .
            }
            BIND(BNODE() AS ?cannotLinkBnode)
          }
    """^^xsd:string ;
  ] .

:GenerateFeasibleCoalitions4Lcc
  a bt:CoalitionGenerator ;
  rdfs:label "CoalitionGenerator: Generate Feasible Coalitions for LCC" ;
  bt:query [
        a bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:targetBase ajan:ExecutionKnowledge ;
        bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          Construct {
            ?bnode  rdf:type  mac:MACProblemInstance ;
                mac:hasId ?lccId ;
                mac:hasParticipants ?pAgentId ;
                mac:hasNumberOfAgents ?numOfAgents ;
                mac:hasMinCoalitionSize ?minSize ;
                mac:hasMaxCoalitionSize ?maxSize ;
                mac:hasCannotLinkConnections  ?cannotLinkBnode ;
                mac:hasMustLinkConnections  ?mustLinkBnode .

            ?cannotLinkBnode  mac:hasCannotConnect  ?clAgentId, ?clAgentId2 .
            ?mustLinkBnode  mac:hasMustConnect  ?mlAgentId, ?mlAgentId2 .
          }
          Where{
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasParticipants ?pAgentId ;
                mac:hasNumberOfAgents ?numOfAgents ;
                mac:hasMinCoalitionSize ?minSize ;
                mac:hasMaxCoalitionSize ?maxSize .

            OPTIONAL {
              ?bnode mac:hasCannotLinkConnections ?cannotLinkBnode .

              ?cannotLinkBnode  mac:hasCannotConnect  ?clAgentId, ?clAgentId2 .
            }
            OPTIONAL {
              ?bnode mac:hasMustLinkConnections ?mustLinkBnode .

              ?mustLinkBnode  mac:hasMustConnect  ?mlAgentId, ?mlAgentId2 .
            }
          }
          """^^xsd:string ;
      ] .

:ConditionAnyFeasibleCoalitionExists
  a bt:Condition ;
  rdfs:label "Condition: Is there any LCC Feasible Coalition?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
      PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
      PREFIX ajan: <http://www.ajan.de/ajan-ns#>
      PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
      PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>

      ASK
      WHERE
      {
        ?bnode  rdf:type  welcome:LCCUseCase ;
            mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

        ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                    mac:hasMembers  ?cmAgentId .
        FILTER(BOUND(?cmAgentId))
      }
            """^^xsd:string ;
    ]) .

:ProduceFinalizeLccProcessEvent
  a bt:EventProducer ;
  rdfs:label "EventProducer: Finalize LCC Process either with Success or Failure" ;
  ajan:event agents:FinalizeLccProcessEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:ExecutionKnowledge;
          bt:sparql """

            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE {
              ?s ?p ?o .
            }"""^^xsd:string ;
        ] .


:BroadcastCoalitions2ReceiveUtilities
  a bt:Broadcast ;
  rdfs:label "Broadcast: LCC Feasible Coalitions to Receive Utility Values"^^xsd:string ;
  rdfs:comment ""^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        SELECT ?hdrName ?userID
        WHERE {
             VALUES ?hdrName {"X-User-ID"}
             ?du rdf:type welcome:DialogueUser .
             ?du welcome:hasUserId ?userID .
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

            CONSTRUCT {
              ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode ;
                  welcome:hasDedicatedAgent ?dAgentId .

              ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                          welcome:hasCommonGender ?cmnGender ;
                          welcome:hasCommonNation ?cmnNation ;
                          mac:hasMembers  ?mAgentId .

              # Select Complete LCC Personal Info
              ?pAgent ajan:agentId  ?pAgentId ;
                  welcome:hasLCCPersonalInfo ?lccPsnlInfo .

              ?lccPsnlInfo  rdf:type  welcome:LCCPersonalInfo ;
                      welcome:hasGender ?gender ;
                      welcome:hasNationality  ?nationality ;
                      welcome:hasLccCpl   ?lccCpl ;
                      mac:hasId ?lccId .
            }
            WHERE {
              # Select Feasible Coalitions
              ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode ;
                  welcome:hasDedicatedAgent ?dAgentId .

              ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                          welcome:hasCommonGender ?cmnGender ;
                          welcome:hasCommonNation ?cmnNation ;
                          mac:hasMembers  ?mAgentId .

              # Select Complete LCC Personal Info
              ?pAgent ajan:agentId  ?pAgentId ;
                  welcome:hasLCCPersonalInfo ?lccPsnlInfo .

              ?lccPsnlInfo  rdf:type  welcome:LCCPersonalInfo ;
                      welcome:hasGender ?gender ;
                      welcome:hasNationality  ?nationality ;
                      welcome:hasLccCpl   ?lccCpl ;
                      mac:hasId ?lccId .
              }
              """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          SELECT DISTINCT ?requestURI
          WHERE {

          ?bnode  rdf:type  welcome:LCCUseCase ;
              mac:hasParticipants ?pAgentId .

          ?agent  rdf:type  ajan:Agent, ajan:ThisAgent ;
              ajan:agentId  ?agentId .

          FILTER(?pAgentId != ?agentId)
          ?agentUri ajan:agentId  ?pAgentId ;
                welcome:hasAddress  ?address .
          BIND(CONCAT(?address, "?capability=computeLccUtilityValues") AS ?requestURI )
          }"""^^xsd:string
  ] .

:HandleComputeLccUtilitiesEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: Compute LCC Utility Values Event" ;
  bt:event agents:ComputeLccUtilityValuesEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }"""^^xsd:string ;
        ] .
        
:WriteDebug
  a bt:Write ;
  rdfs:label "Write: DEBUG " ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            ajan:bnode  ajan:pred ?bnode .
            ajan:lccId  ajan:pred ?lccId .
            ajan:pAgentId ajan:pred ?pAgentId .
            ajan:agent  ajan:pred ?agent .
            ajan:agentId  ajan:pred ?agentId .
          }
          WHERE {

          ?bnode  rdf:type  welcome:LCCUseCase ;
              mac:hasId ?lccId ;
              mac:hasParticipants ?pAgentId .

          ?agent  rdf:type  ajan:Agent ;
              ajan:agentId  ?agentId .

          FILTER(?pAgentId != ?agentId)
          BIND(CONCAT("http://localhost:8060/welcome/integration/coordination/ajan/agents/", ?pAgentId, "?capability=computeLccUtilityValues") AS ?requestURI )
          }"""^^xsd:string ;
  ] .

:WriteAllLccInfo2Exec
  a bt:Write ;
  rdfs:label "Write: All LCC Problem Instances Info to Execution" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
        CONSTRUCT  {
          ?bnode  rdf:type  welcome:LCCUseCase ;
              welcome:hasGenderWeight   ?gWeight ;
              welcome:hasNationalityWeight  ?nWeight ;
              mac:hasId ?lccId .
        }
        WHERE {
          ?bnode  rdf:type  welcome:LCCUseCase ;
              welcome:hasGenderWeight   ?gWeight ;
              welcome:hasNationalityWeight  ?nWeight ;
              mac:hasId ?lccId .
        } """^^xsd:string ;
  ] .

:RemoveUnnecessaryLccInfoFromExec
  a bt:Update ;
  rdfs:label "Update: Remove Unnecessary LCC Problem Instances from Exec" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          DELETE {
            ?bnode  rdf:type  welcome:TempLCCUseCase ;
                welcome:hasGenderWeight   ?gWeight ;
                welcome:hasNationalityWeight  ?nWeight ;
                mac:hasId ?lccId .
          }
          WHERE{
            # this is retrieved from LAKR of this agent. All LCCUseCase s are retrieved.
            ?bnode  rdf:type  welcome:TempLCCUseCase ;
                welcome:hasGenderWeight   ?gWeight ;
                welcome:hasNationalityWeight  ?nWeight .

            # this is received from Dedicated agent. It also sends the id of LCCUseCase.
            ?bnode2 rdf:type  welcome:LCCUseCase ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode ;
                mac:hasId ?lccId .

            FILTER(BOUND(?feasibleCoalitionNode))

            #   ?p  ?o .
            #   mac:hasId ?lccId .

            # here we select the LCCUseCases which have a different ID than the one which is sent by Dedicated Agent.
            # We need to retrieve the correct LCC USE CASE specific to this agent from LAKR. Because the LCCUseCase problem instance contains
            # the weights of preferences sent by Teacher.
            FILTER NOT EXISTS {
              ?bnode  mac:hasId ?lccId .
            }
          }
          """^^xsd:string ;
    ]) .

:RemoveUnnecessaryCoalitions
  a bt:Update ;
  rdfs:label "Update: Remove Unnecessary Coalitions" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          DELETE {
            ?bnode  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .
            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        ?p      ?o .
          }
          WHERE{
            ?agent  rdf:type  ajan:Agent ;
                ajan:agentId  ?agentId .

            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        ?p      ?o .

            FILTER NOT EXISTS {
              ?feasibleCoalitionNode  mac:hasMembers  ?agentId .
            }
          }
          """^^xsd:string ;
    ]) .

:ComputeLccCoalitionInfo
  a bt:Insert ;
  rdfs:label "Insert: Compute LCC Coalition Information - common gender and nationality" ;
  bt:query ([
    a bt:ConstructQuery;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          CONSTRUCT {
              ?feasibleCoalitionNode  welcome:hasCommonGender ?cG ;
                          welcome:hasCommonNation ?cN .
          }
          WHERE {
            {
              SELECT ?feasibleCoalitionNode (COUNT(DISTINCT ?gender) AS ?gS) (COUNT(DISTINCT ?nation) AS ?nS)
              {
                ?bnode    rdf:type   welcome:LCCUseCase ;
                      mac:hasId ?lccId ;
                      mac:hasFeasibleCoalitions  ?feasibleCoalitionNode .
                ?feasibleCoalitionNode  rdf:type   mac:CSGP-Coalition ;
                            mac:hasMembers  ?mAgentId.
                ?mAgent ajan:agentId  ?mAgentId ;
                    welcome:hasLCCPersonalInfo ?mLccPsnlInfo .
                ?mLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                        mac:hasId ?lccId ;
                        welcome:hasGender ?gender ;
                        welcome:hasNationality  ?nation .
              } GROUP BY ?feasibleCoalitionNode
            }
            BIND(IF(?gS > 1, "Mixed", "Same") AS ?cG)
            BIND(IF(?nS > 1, "Mixed", "Same") AS ?cN)
          }
          """^^xsd:string ;
    ]) .

:ComputeLccCoalitionInfo_addingAttendanceInfo
  a bt:Insert ;
  rdfs:label "Insert: Compute LCC Coalition Information - common gender and nationality" ;
  bt:query ([
    a bt:ConstructQuery;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          CONSTRUCT {
              ?feasibleCoalitionNode  welcome:hasCommonGender ?cG ;
                          welcome:hasCommonNation ?cN ;
                          welcome:hasTotalAttendanceAmount  ?attnd .
          }
          WHERE {
          {
            SELECT ?feasibleCoalitionNode (COUNT(DISTINCT ?gender) AS ?gS) (COUNT(DISTINCT ?nation) AS ?nS)
            (COUNT(DISTINCT ?attended) AS ?attnd)
            {
              ?bnode    rdf:type   welcome:LCCUseCase ;
                        mac:hasId ?lccId ;
                        welcome:hasLessonId ?lessonId ;
                        mac:hasFeasibleCoalitions  ?feasibleCoalitionNode .
              ?feasibleCoalitionNode  rdf:type   mac:CSGP-Coalition ;
                                      mac:hasMembers  ?mAgentId.
              ?mAgent   ajan:agentId  ?mAgentId ;
                        welcome:hasLCCPersonalInfo ?mLccPsnlInfo .

              ?mLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                            mac:hasId ?lccId ;
                            welcome:hasGender ?gender ;
                            welcome:hasNationality  ?nation .
                            
              BIND((xsd:integer(?lessonId) - 1) AS ?previousLessonId)
              OPTIONAL {
                FILTER EXISTS {
                  ?mLccPsnlInfo welcome:hasAttendedLessonIDs  ?previousLessonId .
                }
                BIND(?mAgentId AS ?attended)
              }
            } GROUP BY ?feasibleCoalitionNode
          }
          BIND(IF(?gS > 1, "Mixed", "Same") AS ?cG)
          BIND(IF(?nS > 1, "Mixed", "Same") AS ?cN)
        }
        """^^xsd:string ;
    ]) .

:RemoveAttendanceViolatedCoalitions
  a bt:Update ;
  rdfs:label "Remove Coalitions in which Attendance is Violated" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          DELETE {
            ?bnode  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .
            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        ?p ?o.
          }
          WHERE{
            ?bnode  rdf:type   welcome:LCCUseCase ;
                welcome:hasLessonId ?lessonId ;
                welcome:hasAbsenceAllowance   ?allowedAttendanceLimit ;
                mac:hasFeasibleCoalitions  ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type   mac:CSGP-Coalition ;
                        mac:hasSize   ?groupSize ;
                        welcome:hasTotalAttendanceAmount  ?attendedAmount ;
                        ?p ?o.
            FILTER((xsd:integer(?lessonId) != 1) && ((xsd:integer(?attendedAmount) + xsd:integer(?allowedAttendanceLimit)) < xsd:integer(?groupSize)))
            }
        """^^xsd:string ;
    ]) .
    
:SimpleSuccess
  a bt:Success ;
  rdfs:label "Just Success Node"^^xsd:string .
  
:UpdateLccCoalitionInfoWrt
  a bt:Write ;
  rdfs:label "Write: LCC Coalition Info" ;
  bt:query ([
    a bt:ConstructQuery ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          #DELETE{
          #?feasibleCoalitionNode welcome:hasCommonGender ?cG ;
          #           welcome:hasCommonNation ?cN .
          #}
          CONSTRUCT {
          ?feasibleCoalitionNode  welcome:hasCommonGender ?commonGender ;
                      welcome:hasCommonNation ?commonNation .
          }
          WHERE {
            ?bnode    rdf:type   welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions  ?feasibleCoalitionNode .
            ?feasibleCoalitionNode  rdf:type   mac:CSGP-Coalition ;
                        welcome:hasCommonGender ?cG ;
                        welcome:hasCommonNation ?cN .

            FILTER(LCASE(?cG) = "same" || LCASE(?cN) = "same")

            #{
            # SELECT ?gender ?nation
            # {
                ?feasibleCoalitionNode  mac:hasMembers  ?mAgentId.
                ?mAgent ajan:agentId  ?mAgentId ;
                    welcome:hasLCCPersonalInfo ?mLccPsnlInfo .
                ?mLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                        mac:hasId ?lccId ;
                        welcome:hasGender ?gender ;
                        welcome:hasNationality  ?nation .
            # } LIMIT 1
            #}
            BIND(IF(LCASE(?cG) = "same", ?gender, ?cG) AS ?commonGender)
            BIND(IF(LCASE(?cN) = "same", ?nation, ?cN) AS ?commonNation)
          }
          """^^xsd:string ;
    ]) .

:UpdateLccCoalitionInfo
  a bt:Update ;
  rdfs:label "Update: LCC Coalition Info" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          DELETE{
          ?feasibleCoalitionNode  welcome:hasCommonGender ?cG ;
                      welcome:hasCommonNation ?cN .
          }
          INSERT{
          ?feasibleCoalitionNode  welcome:hasCommonGender ?commonGender ;
                      welcome:hasCommonNation ?commonNation .
          }
          WHERE {
            ?bnode    rdf:type   welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions  ?feasibleCoalitionNode .
            ?feasibleCoalitionNode  rdf:type   mac:CSGP-Coalition ;
                        welcome:hasCommonGender ?cG ;
                        welcome:hasCommonNation ?cN .

            FILTER(LCASE(?cG) = "same" || LCASE(?cN) = "same")

            #{
            # SELECT ?gender ?nation
            # {
                ?feasibleCoalitionNode  mac:hasMembers  ?mAgentId.
                ?mAgent ajan:agentId  ?mAgentId ;
                    welcome:hasLCCPersonalInfo ?mLccPsnlInfo .
                ?mLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                        mac:hasId ?lccId ;
                        welcome:hasGender ?gender ;
                        welcome:hasNationality  ?nation .
            # } LIMIT 1
            #}
            BIND(IF(LCASE(?cG) = "same", ?gender, ?cG) AS ?commonGender)
            BIND(IF(LCASE(?cN) = "same", ?nation, ?cN) AS ?commonNation)
          }
          """^^xsd:string ;
    ]) .

:WriteLccPreferencesToEKB
  a bt:Write ;
  rdfs:label "Write LCC Individual Preferences to EKB" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
        CONSTRUCT  {
            ?agent  welcome:hasLCCPreferencesInfo ?bnode .

            ?bnode  rdf:type  welcome:LCCPreferencesInfo ;
                welcome:hasLccGenderPreference ?genPref ;
                welcome:hasLccNationPreference ?natPref ;
                welcome:hasLccGenderPrefWeight  ?gWeight ;
                welcome:hasLccNationPrefWeight  ?nWeight .
        }
        WHERE {
          ?agent  rdf:type ajan:Agent ;
              ajan:agentId  ?subAgentId .

          welcome:tcn_user  rdf:type  welcome:DialogueUser ;
                            welcome:hasLccGenderPreference ?genPrefBnode ;
                            welcome:hasLccNationPreference ?natPrefBnode ;
                            welcome:hasLccGenderPrefWeight  ?gWeightBnode ;
                            welcome:hasLccNationPrefWeight  ?nWeightBnode .
          ?genPrefBnode   welcome:hasValue  ?genPref .
          ?natPrefBnode   welcome:hasValue  ?natPref .
          ?gWeightBnode   welcome:hasValue  ?gWeight .
          ?nWeightBnode   welcome:hasValue  ?nWeight .

          {BIND(BNODE() AS ?bnode)}

        } """^^xsd:string ;
  ] .

:ComputeSdOfLccCoalitions
  a bt:SquareRoot ;
  rdfs:label "SquareRoot: Compute LCC SDs" ;
  bt:query [
        a bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:targetBase ajan:AgentKnowledge ;
        bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX ajan_math: <http://localhost:8090/rdf4j/repositories/ajan_math_ontology#>

          Construct {
            ?feasibleCoalitionNode  rdf:type  ajan_math:AJAN_MathSubject ;
                        ajan_math:hasValue  ?unrootedSd ;
                        ajan_math:hasResultPredicate  welcome:hasStandardDeviation .

            # This node creates triples in the following format:
            # ?feasibleCoalitionNode welcome:hasStandardDeviation ?finalValue .

          }
          Where{
            SELECT ?feasibleCoalitionNode ((SUM(?sd)/?groupSize) AS ?unrootedSd)
            WHERE {
              {
                SELECT ?feasibleCoalitionNode (SUM(?lccCpl) AS ?totalCpl) (COUNT(?mAgentId) AS ?groupSize)
                WHERE {
                  # Select Feasible Coalitions
                  ?bnode  rdf:type  welcome:LCCUseCase ;
                      mac:hasId ?lccId ;
                      mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

                  ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                      mac:hasMembers  ?mAgentId .

                  # Select Complete LCC Personal Info
                  ?mAgentUri ajan:agentId  ?mAgentId ;
                      welcome:hasLCCPersonalInfo ?lccPsnlInfo .
                  ?lccPsnlInfo  rdf:type  welcome:LCCPersonalInfo ;
                      welcome:hasLccCpl   ?lccCpl ;
                      mac:hasId ?lccId .
                } GROUP BY ?feasibleCoalitionNode
              }
              BIND((?totalCpl/?groupSize) AS ?mean)
              {
                SELECT ?feasibleCoalitionNode ?lccCpl
                WHERE {
                  ?feasibleCoalitionNode   mac:hasMembers ?mAgentId .
                  # Select Complete LCC Personal Info
                  ?mAgentUri ajan:agentId  ?mAgentId ;
                      welcome:hasLCCPersonalInfo ?lccPsnlInfo .
                  ?lccPsnlInfo  rdf:type  welcome:LCCPersonalInfo ;
                      welcome:hasLccCpl   ?lccCpl .
                } GROUP BY ?feasibleCoalitionNode ?lccCpl ?mAgentId
              }
              BIND( ( (xsd:float(?mean) - xsd:float(?lccCpl)) * (xsd:float(?mean) - xsd:float(?lccCpl))) AS ?sd )
            }GROUP BY ?feasibleCoalitionNode ?groupSize

          }
          """^^xsd:string ;
      ] .


:ComputeUtilityValuesInLcc
  a bt:Update ;
  rdfs:label "Update: Compute Utility Values in LCC" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
                INSERT {
          ?bnode  rdf:type  welcome:LCCUseCase ;
              mac:hasId ?lccId ;
              mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

                    ?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
                    ?uVbnode    rdf:type    welcome:UtilityValue ;
                                welcome:hasComputedBy   ?agentId ;
                                mac:hasValue        ?ttlV .
                }
                WHERE {
      #   {
      #     SELECT DISTINCT ?feasibleCoalitionNode ?agentId ?bnode ?lccId (SUM(?uValue) AS ?ttlV)
      #     WHERE {
              # get This agent
      #       ?agent  rdf:type  ajan:Agent, ajan:ThisAgent ;
              #?agent rdf:type  ajan:Agent;
      #           ajan:agentId   ?agentId .

              # get Feasible Coalitions which are sent by Dedicated agent
      #       ?bnode  rdf:type  welcome:LCCUseCase ;
      #           mac:hasId ?lccId ;
      #           mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

              # make sure that coalition contains This agent
      #       FILTER EXISTS { ?feasibleCoalitionNode  mac:hasMembers  ?agentId . }

              # get the coalition information
      #       ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
      #                   welcome:hasCommonGender ?commonGender ;
      #                   welcome:hasCommonNation ?commonNation .

              # get preferences of This agent
      #       ?agent  welcome:hasLCCPreferencesInfo ?aLccPrfInfo .
      #       ?aLccPrfInfo  rdf:type  welcome:LCCPreferencesInfo ;
      #               welcome:hasLccGenderPreference  ?aGenderPref ;
      #               welcome:hasLccNationPreference  ?aNationPref ;
      #               welcome:hasLccGenderPrefWeight  ?gWeight ;
      #               welcome:hasLccNationPrefWeight  ?nWeight .

              # get gender and nation of This agent
              ?agent welcome:hasLCCPersonalInfo ?aLccPsnlInfo .
              ?aLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                      mac:hasId ?lccId ;
                      welcome:hasGender  ?aGender ;
                      welcome:hasNationality  ?aNation .


              BIND(IF(LCASE(?aGenderPref) = "dont mind" || (LCASE(?aGenderPref) = "same" && ?aGender = ?commonGender) || (LCASE(?aGenderPref) = "mixed" && LCASE(?commonGender) = "mixed"), xsd:float(?gWeight), -xsd:float(?gWeight)) AS ?genderUValue)
              BIND(IF(LCASE(?aNationPref) = "dont mind" || (LCASE(?aNationPref) = "same" && ?aNation = ?commonNation) || (LCASE(?aNationPref) = "mixed" && LCASE(?commonNation) = "mixed"), xsd:float(?nWeight), -xsd:float(?nWeight)) AS ?nationUValue)

              BIND((?genderUValue + ?nationUValue) AS ?uValue)

            } GROUP BY ?feasibleCoalitionNode ?agentId ?bnode ?lccId
          }
          BIND(BNODE() AS ?uVbnode)
                }
          """^^xsd:string ;
    ]) .

:ComputeUtilityValuesInLccWrite
  a bt:Insert ;
  rdfs:label "Insert: Compute Utility Values in LCC" ;
  bt:query ([
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
                CONSTRUCT {
          ?bnode  rdf:type  welcome:LCCUseCase ;
              mac:hasId ?lccId ;
              mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

                    ?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
                    ?uVbnode    rdf:type    welcome:UtilityValue ;
                                welcome:hasComputedBy   ?agentId ;
                                mac:hasValue        ?ttlV .
                }
                WHERE {
          {
            SELECT DISTINCT ?feasibleCoalitionNode ?agentId ?bnode ?lccId (SUM(?uValue) AS ?ttlV)
            WHERE {
              # get This agent
              ?agent  rdf:type  ajan:Agent, ajan:ThisAgent ;
              #?agent rdf:type  ajan:Agent;
                  ajan:agentId   ?agentId .

              # get Feasible Coalitions which are sent by Dedicated agent
              ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

              # make sure that coalition contains This agent
              FILTER EXISTS { ?feasibleCoalitionNode  mac:hasMembers  ?agentId . }

              # get the coalition information
              ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                          welcome:hasCommonGender ?commonGender ;
                          welcome:hasCommonNation ?commonNation .

              # get preferences of This agent
              ?agent  welcome:hasLCCPreferencesInfo ?aLccPrfInfo .
              ?aLccPrfInfo  rdf:type  welcome:LCCPreferencesInfo ;
                      welcome:hasLccGenderPreference  ?aGenderPref ;
                      welcome:hasLccNationPreference  ?aNationPref ;
                      welcome:hasLccGenderPrefWeight  ?gWeight ;
                      welcome:hasLccNationPrefWeight  ?nWeight .

              # get gender and nation of This agent
              ?agent welcome:hasLCCPersonalInfo ?aLccPsnlInfo .
              ?aLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                      mac:hasId ?lccId ;
                      welcome:hasGender  ?aGender ;
                      welcome:hasNationality  ?aNation .


              BIND(IF(LCASE(?aGenderPref) = "dont mind" || (LCASE(?aGenderPref) = "same" && ?aGender = ?commonGender) || (LCASE(?aGenderPref) = "mixed" && LCASE(?commonGender) = "mixed"), xsd:float(?gWeight), -xsd:float(?gWeight)) AS ?genderUValue)
              BIND(IF(LCASE(?aNationPref) = "dont mind" || (LCASE(?aNationPref) = "same" && ?aNation = ?commonNation) || (LCASE(?aNationPref) = "mixed" && LCASE(?commonNation) = "mixed"), xsd:float(?nWeight), -xsd:float(?nWeight)) AS ?nationUValue)

              BIND((?genderUValue + ?nationUValue) AS ?uValue)

            } GROUP BY ?feasibleCoalitionNode ?agentId ?bnode ?lccId
          }
          BIND(BNODE() AS ?uVbnode)
                }
          """^^xsd:string ;
    ]) .

:ComputeLccUtilities
  a bt:Write ;
  rdfs:label "Write: Compute LCC Utilities" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
                CONSTRUCT {
                    #?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
                    #?uVbnode    rdf:type    welcome:UtilityValue ;
                     #           welcome:hasComputedBy   ?agentId ;
                    #            mac:hasValue        ?ttlV .


          ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .
                    ?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
                    ?uVbnode    rdf:type    welcome:UtilityValue ;
                                welcome:hasComputedBy   ?agentId ;
                                mac:hasValue        ?ttlV .
                }
                WHERE {
          {
            SELECT DISTINCT ?feasibleCoalitionNode ?agentId ?bnode ?lccId (SUM(?uValue) AS ?ttlV)
            WHERE {
              # get This agent
              ?agent  rdf:type  ajan:Agent, ajan:ThisAgent ;
                  ajan:agentId   ?agentId .

              # get Feasible Coalitions which are sent by Dedicated agent
              ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .


              # get Weights for Preferences from the LCC info which is written from LAKR to Exec as Temporary LCC Info
              #?tempLccInfo rdf:type  welcome:LCCUseCase ;
              #       mac:hasId ?lccId ;
              #       welcome:hasGenderWeight   ?gWeight ;
              #       welcome:hasNationalityWeight  ?nWeight .

              # make sure that coalition contains This agent
              FILTER EXISTS { ?feasibleCoalitionNode  mac:hasMembers  ?agentId . }

              # get a member of a coalition
              ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                          mac:hasMembers  ?mAgentId .

              # make sure that the member is different than This agent
              FILTER(?mAgentId != ?agentId)

              # get gender of member agent
              ?mAgent ajan:agentId   ?mAgentId ;
                  welcome:hasLCCPersonalInfo ?mLccPsnlInfo .
              ?mLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                      mac:hasId ?lccId2 ;
                      welcome:hasGender  ?mGender ;
                      welcome:hasNationality  ?mNation .
              FILTER(?lccId = ?lccId2)
              # get gender of This agent
              ?agent welcome:hasLCCPersonalInfo ?aLccPsnlInfo .
              ?aLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                      mac:hasId ?lccId3 ;
                      welcome:hasGender  ?aGender ;
                      welcome:hasNationality  ?aNation .
              FILTER(?lccId = ?lccId3)
              # get gender preference of This agent
              ?agent  welcome:hasLCCPreferencesInfo ?aLccPrfInfo .
              ?aLccPrfInfo  rdf:type  welcome:LCCPreferencesInfo ;
                      welcome:hasGenderPreference ?aGenderPref ;
                      welcome:hasNationPreference ?aNationPref ;
                      welcome:hasGenderWeight ?gWeight ;
                      welcome:hasNationalityWeight  ?nWeight .

              #?du    rdf:type  welcome:DialogueUser ;
              #        welcome:hasGenderPreference ?aGenderPref ;
              #        welcome:hasNationPreference ?aNationPref ;
              #        welcome:hasGenderWeight  ?gWeight ;
              #        welcome:hasNationalityWeight ?nWeight .


              BIND(IF(LCASE(?aGenderPref) = "dont mind" || (?aGenderPref = ?mGender), xsd:float(?gWeight), -xsd:float(?gWeight)) AS ?genderUValue)

              BIND(IF(LCASE(?aNationPref) = "dont mind" || (LCASE(?aNationPref) = "same" && ?aNation = ?mNation) || (LCASE(?aNationPref) = "mixed" && ?aNation != ?mNation), xsd:float(?nWeight), -xsd:float(?nWeight)) AS ?nationUValue)

              BIND((?genderUValue + ?nationUValue) AS ?uValue)

      #       BIND(IF(LCASE(?aGenderPref) = "dont mind" ||
      #       ((LCASE(?aGenderPref) = "same") && ?aGender = ?mGender) ||
      #       ((LCASE(?aGenderPref) = "mixed") && ?aGender != ?mGender),1 ,-1) AS ?uv)

            } GROUP BY ?feasibleCoalitionNode ?agentId ?bnode ?lccId
          }
          #BIND(SHA1(xsd:string(NOW())) AS ?uniqueId)
          #BIND( IRI(CONCAT(STR(welcome:UtilityValue),STR(?lccId) , STR(?uniqueId))) AS ?uVbnode )
          BIND(BNODE() AS ?uVbnode)
                }"""^^xsd:string ;
  ] .

:ComputeLccUtilityValues
  a bt:Update ;
  rdfs:label "Update: Compute Utility Values" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
                INSERT {
                    #?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
                    #?uVbnode    rdf:type    welcome:UtilityValue ;
                     #           welcome:hasComputedBy   ?agentId ;
                    #            mac:hasValue        ?ttlV .


          ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .
                    ?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
                    ?uVbnode    rdf:type    welcome:UtilityValue ;
                                welcome:hasComputedBy   ?agentId ;
                                mac:hasValue        ?ttlV .
                }
                WHERE {
          {
            SELECT ?feasibleCoalitionNode ?agentId ?bnode ?lccId (SUM(?uValue) AS ?ttlV)
            WHERE {
              # get This agent
              ?agent  rdf:type  ajan:Agent ;
                  ajan:agentId   ?agentId .

              # get Feasible Coalitions which are sent by Dedicated agent
              ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .


              # get Weights for Preferences from the LCC info which is written from LAKR to Exec as Temporary LCC Info
              #?tempLccInfo rdf:type  welcome:LCCUseCase ;
              #       mac:hasId ?lccId ;
              #       welcome:hasGenderWeight   ?gWeight ;
              #       welcome:hasNationalityWeight  ?nWeight .

              # make sure that coalition contains This agent
              FILTER EXISTS { ?feasibleCoalitionNode  mac:hasMembers  ?agentId . }

              # get a member of a coalition
              ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                          mac:hasMembers  ?mAgentId .

              # make sure that the member is different than This agent
              FILTER(?mAgentId != ?agentId)

              # get gender of member agent
              ?mAgent ajan:agentId   ?mAgentId ;
                  welcome:hasLCCPersonalInfo ?mLccPsnlInfo .
              ?mLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                      mac:hasId ?lccId2 ;
                      welcome:hasGender  ?mGender ;
                      welcome:hasNationality  ?mNation .
              FILTER(?lccId = ?lccId2)
              # get gender of This agent
              ?agent welcome:hasLCCPersonalInfo ?aLccPsnlInfo .
              ?aLccPsnlInfo rdf:type  welcome:LCCPersonalInfo ;
                      mac:hasId ?lccId3 ;
                      welcome:hasGender  ?aGender ;
                      welcome:hasNationality  ?aNation .
              FILTER(?lccId = ?lccId3)
              # get gender preference of This agent
              ?agent  welcome:hasLCCPreferencesInfo ?aLccPrfInfo .
              ?aLccPrfInfo  rdf:type  welcome:LCCPreferencesInfo ;
                      welcome:hasGenderPreference ?aGenderPref ;
                      welcome:hasNationPreference ?aNationPref ;
                      welcome:hasGenderWeight ?gWeight ;
                      welcome:hasNationalityWeight  ?nWeight .

              #?du    rdf:type  welcome:DialogueUser ;
              #        welcome:hasGenderPreference ?aGenderPref ;
              #        welcome:hasNationPreference ?aNationPref ;
              #        welcome:hasGenderWeight  ?gWeight ;
              #        welcome:hasNationalityWeight ?nWeight .


              BIND(IF(LCASE(?aGenderPref) = "dont mind" || (?aGenderPref = ?mGender), xsd:float(?gWeight), -xsd:float(?gWeight)) AS ?genderUValue)

              BIND(IF(LCASE(?aNationPref) = "dont mind" || (LCASE(?aNationPref) = "same" && ?aNation = ?mNation) || (LCASE(?aNationPref) = "mixed" && ?aNation != ?mNation), xsd:float(?nWeight), -xsd:float(?nWeight)) AS ?nationUValue)

              BIND((?genderUValue + ?nationUValue) AS ?uValue)

      #       BIND(IF(LCASE(?aGenderPref) = "dont mind" ||
      #       ((LCASE(?aGenderPref) = "same") && ?aGender = ?mGender) ||
      #       ((LCASE(?aGenderPref) = "mixed") && ?aGender != ?mGender),1 ,-1) AS ?uv)

            } GROUP BY ?feasibleCoalitionNode ?agentId ?bnode ?lccId
          }
          BIND(BNODE() AS ?uVbnode)
                }
          """^^xsd:string ;
    ]) .

:MessageLccUtilities2Dedicated
  a myWelcome:Message ;
  rdfs:label "Message: Return LCC Utility Values to Dedicated agent for LCC"^^xsd:string ;
  rdfs:comment ""^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?hdrName ?fieldValue
        WHERE { 
            ?headerName welcome:hasHeaderName ?hdrName .
            ?headerName welcome:hasHeaderValue ?fieldValue .            
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            CONSTRUCT {
              ?agent  ajan:agentId  ?agentId ;
                  welcome:hasInvolvedInMac  ?bnode .

              ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

              ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                          welcome:hasUtilityValue ?uVbnode .

              ?uVbnode    rdf:type    welcome:UtilityValue ;
                    welcome:hasComputedBy   ?agentId ;
                    mac:hasValue        ?utilityValue .
            }
            WHERE {
              ?agent  rdf:type  ajan:Agent, ajan:ThisAgent ;
                  ajan:agentId  ?agentId .

              ?bnode  rdf:type  welcome:LCCUseCase ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

              ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;

              OPTIONAL {
                ?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
                ?uVbnode    rdf:type    welcome:UtilityValue ;
                      welcome:hasComputedBy   ?agentId ;
                      mac:hasValue        ?utilityValue .
              }
        }"""^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          SELECT DISTINCT ?requestURI
          WHERE {

          ?bnode  rdf:type  welcome:LCCUseCase ;
              welcome:hasDedicatedAgent ?dAgentId .

          ?agentUri ajan:agentId  ?dAgentId ;
                welcome:hasAddress  ?address .

          BIND(CONCAT(?address, "?capability=receiveLccUtilityValues") AS ?requestURI )
          }"""^^xsd:string
  ] .

:UpdateLccUseCaseInLakr
  a bt:Update ;
  rdfs:label "Update: LCC Info in LAKR" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
                DELETE{
          ?bnode2 rdf:type  welcome:LCCUseCase ;
              ?p2 ?o2 ;
              mac:hasId ?lccId .
        }
        INSERT {
          ?bnode  rdf:type  welcome:LCCUseCase ;
              ?p ?o ;
              ?p2 ?o2 .
                }
                WHERE {
          #OPTIONAL{
            ?bnode  rdf:type  welcome:LCCUseCase ;
                ?p ?o ;
                mac:hasId ?lccId .
          #}
          OPTIONAL {
            ?bnode2 rdf:type  welcome:LCCUseCase ;
                ?p2 ?o2 ;
                mac:hasId ?lccId .
            FILTER(?bnode != ?bnode2)
          }

                }
          """^^xsd:string ;
    ]) .

:InsertLccUtilities2Lakr
  a bt:Insert ;
  rdfs:label "Insert: LCC Utility Values to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

        CONSTRUCT  {
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode ;
                        welcome:hasCommonGender ?cmnGender ;
                        welcome:hasCommonNation ?cmnNation ;
                        mac:hasMembers  ?mAgentId .

            ?uVbnode  rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .
        }
        WHERE {

            #?agent rdf:type  ajan:Agent ;
            #   ajan:agentId  ?agentId .

            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        mac:hasMembers  ?mAgentId .

            OPTIONAL {
              ?feasibleCoalitionNode  welcome:hasCommonGender ?cmnGender ;
                          welcome:hasCommonNation ?cmnNation .
            }

            OPTIONAL {
              ?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
              ?uVbnode    rdf:type    welcome:UtilityValue ;
                    welcome:hasComputedBy   ?agentId ;
                    mac:hasValue        ?utilityValue .
            }

            #OPTIONAL {
            # ?existingBnode  rdf:type  welcome:LCCUseCase ;
            #         mac:hasId ?lccId .
            # FILTER(?existingBnode!=?bnode)
            #}
            #BIND(IF(BOUND(?existingBnode), ?existingBnode, ?bnode) AS ?finalBnode)

        } """^^xsd:string ;
  ] .

:WriteLccUtilities2Lakr
  a bt:Write ;
  rdfs:label "Write: LCC Utility Values to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

        CONSTRUCT  {
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode ;
                        mac:hasMembers  ?mAgentId .

            ?uVbnode  rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .
        }
        WHERE {

            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        mac:hasMembers  ?mAgentId .

            OPTIONAL {
              ?feasibleCoalitionNode  welcome:hasUtilityValue ?uVbnode .
              ?uVbnode    rdf:type    welcome:UtilityValue ;
                    welcome:hasComputedBy   ?agentId ;
                    mac:hasValue        ?utilityValue .
            }

            #OPTIONAL {
            # ?existingBnode  rdf:type  welcome:LCCUseCase ;
            #         mac:hasId ?lccId .
            # FILTER(?existingBnode!=?bnode)
            #}
            #BIND(IF(BOUND(?existingBnode), ?existingBnode, ?bnode) AS ?finalBnode)

        } """^^xsd:string ;
  ] .

:InsertLccUseCaseAmount
  a bt:Insert ;
  rdfs:label "Insert: LCC Utility Values to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

        CONSTRUCT  {
            ajan:LccInstances rdf:type  ?totalInstances .
        }
        WHERE {
            {
              SELECT (COUNT(?bnode) AS ?totalInstances)
              WHERE{
                ?bnode  rdf:type  welcome:LCCPreferencesInfo .
                    #mac:hasId ?lccId .
                #FILTER EXISTS { ?bnode mac:hasFeasibleCoalitions ?feasibleCoalitionNode . }
              }

            }
        } """^^xsd:string ;
  ] .
  
:Wait4UtilityValues
  a bt:Wait ;
  rdfs:label "Wait: 4 LCC Utilities" ;
  rdfs:comment "Wait for participating agents to return their Utility Values for LCC" ;
  bt:milliseconds "50000"^^xsd:int .

:ComputeLccCoalitionValues
  a bt:Update ;
  rdfs:label "Update: Compute LCC Coalition Values" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
        INSERT {
          ?feasibleCoalition mac:hasValue ?coalitionValue .
        }
        WHERE{
          {
            SELECT ?feasibleCoalition ?sdValue  ?sdWeight (SUM(?utilityValue) AS ?sumOfUtilities)
            WHERE {
              ?lccUseCase rdf:type  welcome:LCCUseCase ;
                    welcome:hasStatus ?lccStatus ;
                    mac:hasId ?lccId ;
                    welcome:hasSdWeight ?sdWeight ;
                    mac:hasFeasibleCoalitions ?feasibleCoalition .
              #FILTER NOT EXISTS { ?lccUseCase  welcome:hasStatus "Complete" .}
              FILTER(LCASE(?lccStatus) = "running")

              ?feasibleCoalition  rdf:type  mac:CSGP-Coalition .
              OPTIONAL {
              ?feasibleCoalition  welcome:hasUtilityValue ?utilityValueNode .
              ?utilityValueNode rdf:type  welcome:UtilityValue ;
                        mac:hasValue  ?utilityValue .
              }
              OPTIONAL {
                ?feasibleCoalition  welcome:hasStandardDeviation  ?sdValue .
              }
            } GROUP BY ?feasibleCoalition ?sdValue  ?sdWeight
          }
          #BIND(IF(BOUND(?sumOfUtilities), ((?sumOfUtilities * (1-?sdWeight)) - (?sdWeight * ?sdValue)), 0) AS ?coalitionValue)
                    BIND(IF(BOUND(?sumOfUtilities), ?sumOfUtilities, 0) AS ?boundSumOfUtils)
                    BIND(xsd:float(?sdValue) AS ?fSdValue)
                    BIND(xsd:float(?sdWeight) AS ?fSdWeight)
                    BIND(xsd:float(?boundSumOfUtils) AS ?fBoundSumOfUtils)
                    BIND( ((1-?fSdWeight) * ?fBoundSumOfUtils) - (?fSdWeight * ?fSdValue) AS ?coalitionValue)


          #{
          # SELECT ?feasibleCoalition ?sdValue  ?sdWeight (SUM(?utilityValue) AS ?sumOfUtilities)
          # WHERE {
          #   ?lccUseCase rdf:type  welcome:LCCUseCase ;
          #         welcome:hasStatus ?lccStatus ;
          #         mac:hasId ?lccId ;
          #         welcome:hasSdWeight ?sdWeight ;
          #         mac:hasFeasibleCoalitions ?feasibleCoalition .
          #   #FILTER NOT EXISTS { ?lccUseCase  welcome:hasStatus "Complete" .}
          #   FILTER(LCASE(?lccStatus) = "running")

          #   ?feasibleCoalition  rdf:type  mac:CSGP-Coalition .
          #   OPTIONAL {
          #   ?feasibleCoalition  welcome:hasUtilityValue ?utilityValueNode .
          #   ?utilityValueNode rdf:type  welcome:UtilityValue ;
          #             mac:hasValue  ?utilityValue .
          #   }
          #   OPTIONAL {
          #     ?feasibleCoalition  welcome:hasStandardDeviation  ?sdValue .
          #   }
          # } GROUP BY ?feasibleCoalition ?sdValue  ?sdWeight
          #}
          #BIND(IF(BOUND(?sumOfUtilities), ?sumOfUtilities, 0) AS ?coalitionValue)
        }
          """^^xsd:string ;
    ]) .

:ComputeLccRuntime
  a bt:Update ;
  rdfs:label "Update: Compute LCC Runtime" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
        INSERT {
          ?lccUseCase mac:hasRuntime  ?lccRuntimeInSeconds .
        }
        WHERE{
          ?lccUseCase rdf:type  welcome:LCCUseCase ;
                welcome:hasStatus ?lccStatus ;
                mac:hasId ?lccId .

          FILTER(LCASE(?lccStatus) = "completed" || LCASE(?lccStatus) = "failed" || LCASE(?lccStatus) = "no solution found")
          OPTIONAL {
            ?lccUseCase welcome:hasStartTime  ?startTime ;
                  welcome:hasEndTime  ?endTime .
          }
          FILTER(BOUND(?startTime) && BOUND(?endTime))

          BIND( (DAY(?startTime)*86400 + HOURS(?startTime)*3600 + MINUTES(?startTime)*60 + SECONDS(?startTime)) AS ?startTimeInSeconds)
          BIND( (DAY(?endTime)*86400 + HOURS(?endTime)*3600 + MINUTES(?endTime)*60 + SECONDS(?endTime)) AS ?endTimeInSeconds)
          BIND( ?endTimeInSeconds - ?startTimeInSeconds AS ?lccRuntimeInSeconds)
        }
          """^^xsd:string ;
    ]) .

:ConditionAgentInAnyCoordination
  a bt:Condition ;
  rdfs:label "Condition: is agent involved in or running any coordination use case?" ;
  bt:query ( [
    a bt:AskQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          ASK
          WHERE {
            #?agentUri  rdf:type  ajan:Agent ;
            #     ajan:agentId  ?agentName .

            #OPTIONAL {
            # ?agentUri welcome:isRunningCHC  ?runningChcId .
            #}

            #OPTIONAL {
            # ?agentUri welcome:isInvolvedInCHC ?involvedInChcId .
            #}

            #OPTIONAL {
            # ?agentUri welcome:hasRunningMac ?macId .
            #}

            #OPTIONAL {
            # ?agentUri welcome:hasInvolvedInMac  ?macId2 .
            #}

            # Each agent must add the Id of the MAC use case with the "welcome:hasInvolvedInMac" predicate,
            # every time it starts to participate in any coordination use case. This also helps to see in which use cases
            # the agent has participated so far.

            # So first we take the MacIds in which this.agent has involved in so far. Then we select the use cases
            # with these MacIds. Then we check if any of those Mac use cases are "Running". If not, then agent is not
            # involved in any mac use case. (?macStatus can take "Running", "Completed" and "Failed" values)

            ?agentUri rdf:type  ajan:Agent ;
                  welcome:hasInvolvedInMac  ?macId .

            ?macUseCase rdf:type  mac:MACProblemInstance ;
                  mac:hasId ?macId ;
                  welcome:hasStatus ?macStatus .

            FILTER( LCASE(?macStatus) = "running" )

            #FILTER( LCASE(?macStatus) != "completed" && LCASE(?macStatus) != "failed")

            }"""^^xsd:string ;
    ]) .

:Message2WPMUpdateStatus2Active
  a <http://www.ajan.de/myWelcome-ns#Message> ;
  rdfs:label "Message: Update Agent status to Active in WAR"^^xsd:string ;
  rdfs:comment ""^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;  
  <http://www.ajan.de/myWelcome-ns#correlatorId> [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT DISTINCT ?hdrName ?fieldValue
        WHERE { 
          {
#            ?headerName welcome:hasHeaderName ?hdrName .
#            ?headerName welcome:hasHeaderValue ?fieldValue .

             VALUES ?hdrName {"X-Correlation-ID"}
             OPTIONAL {
                  welcome:message  welcome:hasCorrelationID  ?corrId.
              }
              BIND( IF(BOUND(?corrId), ?corrId, "NoneInLakr") AS ?fieldValue)
          } UNION {
              VALUES ?hdrName {"X-User-ID"}
              
              OPTIONAL {
                  ?tcn_user   rdf:type  welcome:DialogueUser ;
                              welcome:hasUserId ?userIdBNode .
                  ?userIdBNode  welcome:hasValue  ?userId . 
              }

              BIND( IF(BOUND(?userId), ?userId, "NoneInLakr") AS ?fieldValue)
          }          
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "application/ld+json"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "application/ld+json"
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:to ;
          http-core:fieldValue "WPM"
      ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            PREFIX welcome-sw: <http://www.semanticweb.org/welcome#>
            CONSTRUCT {
              ?agent  welcome:hasStatus welcome-sw:active ;
                  ajan:agentId  ?agentName .
            }
            WHERE {
              ?agent  rdf:type  ajan:Agent, ajan:ThisAgent ;
                  ajan:agentId  ?agentName .
            }
            """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          
          
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

          # LINES TO SEND TO DUMMY ENDPOINT
          #SELECT ?requestURI
          #WHERE {
          #  VALUES ?requestURI { "http://localhost:8092/wpm/updateAgentStatus" }
          #}

          # LINES TO SEND TO ACTUAL ENDPOINT
          SELECT ?requestURI
          WHERE
          {
            welcome:dispatcher welcome:hasAddress ?partialAddress .
            BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/agentStatus") AS ?requestURI )
          }
          
          
          """^^xsd:string
  ] .
  
:ProduceSolveLccEvent
  a bt:EventProducer ;
  rdfs:label "EventProducer: Solve LCC Event" ;
  ajan:event agents:SolveLccEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:ExecutionKnowledge;
          bt:sparql """

            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE {
              ?s ?p ?o .
            }"""^^xsd:string ;
        ] .

:WriteCompleteUtilities2Exec
  a bt:Write ;
  rdfs:label "Write: Utilities to LAKR" ;
  rdfs:comment "Write LCC Utility Values of all participating agents to Execution Knowledge" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

        CONSTRUCT  {
            ?newbnode rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode ;
                        mac:hasMembers  ?mAgentId .

            ?uVbnode  rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .
        }
        WHERE {

            {?bnode rdf:type  welcome:LCCUseCase ;
                welcome:hasStatus "completed" ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .
            }
            BIND(BNODE() AS ?newbnode)
        } """^^xsd:string ;
  ] .

:HandleReceiveLccUtilitiesEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: Receive Utilities" ;
  rdfs:comment "Receive LCC Utility Values from Participants Event Handler" ;
  bt:event agents:ReceiveLccUtilityValuesEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }"""^^xsd:string ;
        ] .

:ReplaceLccProcessTypeOLDDDD
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: Receive Utilities" ;
  rdfs:comment "Receive LCC Utility Values from Participants Event Handler" ;
  bt:event agents: ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {
            ?bnode  rdf:type  welcome:CurrentlyRunningLCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .
          }
          WHERE {
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .
    #       ?s ?p ?o .
                  }"""^^xsd:string ;
        ] .

:ReplaceLccProcessType
  a bt:Update ;
  rdfs:label "Update: replace lccUseCase with Currentlyrunning..." ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          DELETE {
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .         }
          INSERT{
            ?bnode  rdf:type  welcome:CurrentlyRunningLCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .
          }
          WHERE{
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .
          }
          """^^xsd:string ;
    ]) .

:WriteAllIncompleteLccProcess2Ek
  a bt:Write ;
  rdfs:label "Write: All Incomplete LCCs 2 LAKR" ;
  rdfs:comment "" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          CONSTRUCT {
            ?agent  rdf:type  ajan:Agent ;
                ajan:agentId  ?agentId ;
                welcome:hasInvolvedInMac ?bnode .

            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId .

          }
          WHERE {
            ?agent  rdf:type  ajan:Agent ;
                ajan:agentId  ?agentId ;
                welcome:hasInvolvedInMac ?bnode .

            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId .

            FILTER NOT EXISTS {?bnode welcome:hasStatus "Completed" .}

          }


    """^^xsd:string ;
  ] .

:RemoveUnmatchingLccProcesses
  a bt:Update ;
  rdfs:label "Update: Remove Unmatching LCC Processes from EK" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          DELETE {
            ?agent  welcome:hasInvolvedInMac ?bnode .
            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccIdFromLakr .
          }
          WHERE{
            ?agent  rdf:type  ajan:Agent ;
                welcome:hasInvolvedInMac  ?bnode .

            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccIdFromLakr .

            ?bnode2 rdf:type  welcome:CurrentlyRunningLCCUseCase ;
                mac:hasId ?currentLccId .
            FILTER(?lccIdFromLakr != ?currentLccId)
          }
          """^^xsd:string ;
    ]) .

:InsertLccUtilitiesOfSender2Lakr
  a bt:Insert ;
  rdfs:label "Insert: LCC Utilities 2 LAKR" ;
  rdfs:comment "Insert LCC Utility Values of Participants to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """

          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          CONSTRUCT {

            ?bnode  rdf:type  welcome:LCCUseCase ;
            #   mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .

          }
          WHERE {
          # ?bnode  rdf:type  welcome:CurrentlyRunningLCCUseCase ;
          #     mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

          # ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
          #             welcome:hasUtilityValue ?uVbnode .

          # ?uVbnode    rdf:type    welcome:UtilityValue ;
          #       welcome:hasComputedBy   ?agentId ;
          #       mac:hasValue        ?utilityValue .

          # ?bnode2 rdf:type  welcome:LCCUseCase .

            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .

            #BIND(BNODE() AS ?utValue)
          }


    """^^xsd:string ;
  ] .

:WriteLccUtilitiesOfSender2Lakr
  a bt:Write ;
  rdfs:label "Write: LCC Utilities 2 LAKR" ;
  rdfs:comment "Write LCC Utility Values of Participants to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT {

            #?bnode rdf:type  welcome:LCCUseCase ;
            #   mac:hasId ?lccId ;
            #   mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?utValue .

            ?utValue    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .

          }
          WHERE {
          # ?bnode  rdf:type  welcome:CurrentlyRunningLCCUseCase ;
          #     mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

          # ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
          #             welcome:hasUtilityValue ?uVbnode .

          # ?uVbnode    rdf:type    welcome:UtilityValue ;
          #       welcome:hasComputedBy   ?agentId ;
          #       mac:hasValue        ?utilityValue .

          # ?bnode2 rdf:type  welcome:LCCUseCase .

            ?bnode  rdf:type  welcome:LCCUseCase ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        welcome:hasUtilityValue ?uVbnode .

            ?uVbnode    rdf:type    welcome:UtilityValue ;
                  welcome:hasComputedBy   ?agentId ;
                  mac:hasValue        ?utilityValue .

            BIND(BNODE() AS ?utValue)
          }


    """^^xsd:string ;
  ] .

:HandleSolveLccEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: Solve LCC Event" ;
  rdfs:comment "HandleEvent to Solve LCC Use Case with BOSS Algorithm" ;
  bt:event agents:SolveLccEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """
          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }"""^^xsd:string ;
        ] .

:WriteCoalitionValues2Ek
  a bt:Write ;
  rdfs:label "Write: LCC Coalition Values" ;
  rdfs:comment "Write LCC Coalition Values to Execution Knowledge" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:AgentKnowledge ;
    bt:targetBase ajan:ExecutionKnowledge  ;
    bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          CONSTRUCT {
            #?bnode rdf:type  welcome:LCCUseCase ;
            #   mac:hasId ?lccId ;
            #   mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        mac:hasMembers  ?memberAgent ;
                        mac:hasValue ?coalitionValue .

          }
          WHERE {
            ?bnode  rdf:type  welcome:LCCUseCase ;
                welcome:hasStatus ?lccStatus ;
                mac:hasId ?lccId ;
                mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        mac:hasMembers  ?memberAgent ;
                        mac:hasValue ?coalitionValue .

            FILTER(LCASE(?lccStatus) = "running")
          }


    """^^xsd:string ;
  ] .

:SolveLcc_BOSS
  a bt:BOSS ;
  rdfs:label "BOSS: Solve LCC Use Case" ;
  bt:query [
        a bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:targetBase ajan:ExecutionKnowledge ;
        bt:sparql """
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          Construct {
            ?lccSubject rdf:type  mac:MACProblemInstance ;
                  mac:hasNumberOfAgents ?numOfAgents ;
                  mac:hasParticipants ?pAgentId ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .
            ?lccSubject mac:hasNonExistentCoalitionValue  "-1000000" .


            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        mac:hasMembers  ?mAgentId ;
                        mac:hasValue ?coalitionValue .
            #?s ?p ?o .
          }
          Where{

            #?s ?p ?o .
            ?lccSubject rdf:type  welcome:LCCUseCase ;
                  mac:hasNumberOfAgents ?numOfAgents ;
                  mac:hasParticipants ?pAgentId ;
                  mac:hasId ?lccId ;
                  mac:hasFeasibleCoalitions ?feasibleCoalitionNode .

            ?feasibleCoalitionNode  rdf:type  mac:CSGP-Coalition ;
                        mac:hasMembers  ?mAgentId ;
                        mac:hasValue ?coalitionValue .
          }
          """^^xsd:string ;
      ] .



:NormalizeCsValues
  a bt:Update ;
  rdfs:label "Update: Normalize CS values" ;
  bt:query ([
    a bt:UpdateQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
        PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
        PREFIX ajan: <http://www.ajan.de/ajan-ns#>
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
        PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
        DELETE{
          ?lccSolution  mac:hasValue  ?csValue .
        }
        INSERT {
          ?lccSolution  mac:hasValue  ?normalizedCsValue .
        }
        WHERE{
          ?lccSubject rdf:type  welcome:LCCUseCase .

          OPTIONAL {
            ?lccSubject mac:hasSolution ?lccSolution ;
                  mac:hasMinCsValue ?minCsValue .
            BIND(IF(BOUND(?minCsValue), ?minCsValue, 0) AS ?minimmCsValue) 
            # Select LCC Use Case Solutions
            ?lccSolution  rdf:type  mac:CSGP-CoalitionStructure ;
                    mac:hasValue  ?csValue .
            BIND((?csValue + 5 - ?minimmCsValue) AS ?normalizedCsValue)
              }

        }
          """^^xsd:string ;
    ]) .
:BroadcastLccResult
  a bt:Broadcast ;
  rdfs:label "Broadcast: LCC Result"^^xsd:string ;
  rdfs:comment "Send the Result of LCC_CSGP to other participating agents"^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
        SELECT ?hdrName ?userID
        WHERE {
             VALUES ?hdrName {"X-User-ID"}
             ?du rdf:type welcome:DialogueUser .
             ?du welcome:hasUserId ?userID .
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

            CONSTRUCT {
              #?agentUri  rdf:type  ajan:Agent ;
              #     ajan:agentId  ?agentId .

              ?lccSubject rdf:type  welcome:LCCUseCase ;
                    mac:hasId ?lccId ;
                    mac:hasSolution ?lccSolution ;
                    mac:hasMinCsValue ?minCsValue ;
                    welcome:hasDedicatedAgent ?dAgentId ;
                    welcome:hasStatus ?lccStatus .

              ?lccSolution  rdf:type  mac:CSGP-CoalitionStructure ;
                      mac:hasValue  ?csValue ;
                      mac:hasRank   ?csRank ;
                      mac:hasSolutionOf ?lccSubject ;
                      mac:hasMembers  ?coalition .

              ?coalition  rdf:type  mac:CSGP-Coalition ;
                      mac:hasMembers  ?memberAgent .
            }
            WHERE {
              #?agentUri  rdf:type  ajan:Agent  ;
              #     ajan:agentId  ?agentId .

              # Select LCC Use Case Problem Info
              ?lccSubject rdf:type  welcome:LCCUseCase ;
                    mac:hasId ?lccId ;
                    welcome:hasDedicatedAgent ?dAgentId .

              OPTIONAL {
                ?lccSubject mac:hasSolution ?lccSolution .
                # Select LCC Use Case Solutions
                ?lccSolution  rdf:type  mac:CSGP-CoalitionStructure ;
                        mac:hasValue  ?csValue ;
                        mac:hasRank   ?csRank ;
                        mac:hasSolutionOf ?lccSubject ;
                        mac:hasMembers  ?coalition .
              }
              OPTIONAL {
                ?lccSubject rdf:type  welcome:LCCUseCase ;
                      mac:hasMinCsValue ?minCsValue .
}
              OPTIONAL {
                ?coalition  rdf:type  mac:CSGP-Coalition ;
                      mac:hasMembers  ?memberAgent .
              }
#             BIND( IF( BOUND(?lccSolution) && BOUND(?csValue) && BOUND(?csRank) && BOUND(?coalition) &&
#                   BOUND(?memberAgent), "Completed", "Failed") AS ?lccStatus)
              BIND( IF( BOUND(?lccSolution) && BOUND(?csValue) && BOUND(?csRank), "Completed", "No Solution Found") AS ?lccStatus)

              }
              """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          SELECT DISTINCT ?requestURI
          WHERE {

          ?bnode  rdf:type  welcome:LCCUseCase ;
              mac:hasParticipants ?pAgentId .

          ?agent  rdf:type  ajan:Agent, ajan:ThisAgent ;
              ajan:agentId  ?agentId .

          FILTER(?pAgentId != ?agentId)
          ?agentUri ajan:agentId  ?pAgentId ;
                welcome:hasAddress  ?address .

          BIND(CONCAT(?address, "?capability=finalizeLccProcess") AS ?requestURI )
          }"""^^xsd:string
  ] .

:BroadcastLccFailed
  a bt:Broadcast ;
  rdfs:label "Broadcast: LCC Failed"^^xsd:string ;
  rdfs:comment ""^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        SELECT ?hdrName ?userID
        WHERE {
             VALUES ?hdrName {"X-User-ID"}
             ?du rdf:type welcome:DialogueUser .
             ?du welcome:hasUserId ?userID .
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

            CONSTRUCT {
              ?lccSubject rdf:type  welcome:LCCUseCase ;
                    mac:hasId ?lccId ;
                    welcome:hasDedicatedAgent ?dAgentId ;
                    mac:hasStatus ?lccStatus .
            }
            WHERE {
              # Select LCC Use Case Problem Info
              ?lccSubject rdf:type  welcome:LCCUseCase ;
                    mac:hasId ?lccId ;
                    welcome:hasDedicatedAgent ?dAgentId .


              BIND( "Failed" AS ?lccStatus)

              }
              """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          SELECT DISTINCT ?requestURI
          WHERE {

          ?bnode  rdf:type  welcome:LCCUseCase ;
              mac:hasId ?lccId ;
              mac:hasParticipants ?pAgentId .

          ?agent  rdf:type  ajan:Agent, ajan:ThisAgent ;
              ajan:agentId  ?agentId .

          FILTER(?pAgentId != ?agentId)
          ?agentUri ajan:agentId  ?pAgentId ;
                welcome:hasAddress  ?address .

          BIND(CONCAT(?address, "?capability=finalizeLccProcess") AS ?requestURI )
          }"""^^xsd:string
  ] .


:BroadcastTestToView
  a bt:Broadcast ;
  rdfs:label "Display Execution Knowledge"^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
        SELECT ?hdrName ?userID
        WHERE {
             VALUES ?hdrName {"X-User-ID"}
             ?du rdf:type welcome:DialogueUser .
             ?du welcome:hasUserId ?userID .
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

            CONSTRUCT {
              ?s ?p ?o .
            }
            WHERE {
              ?s ?p ?o .
            }
              """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:sparql """
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

          SELECT DISTINCT ?requestURI
          WHERE {
            VALUES ?requestURI { "http://localhost:8092/teacherPanel/inform"}
          }"""^^xsd:string
  ] .

:Message2TeacherLccResult
  a myWelcome:Message ;
  rdfs:label "Message: LCC Result 2 Teacher"^^xsd:string ;
  rdfs:comment "Send Result of LCC Process to Teacher"^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT DISTINCT ?hdrName ?fieldValue
        WHERE { 
          {
#            ?headerName welcome:hasHeaderName ?hdrName .
#            ?headerName welcome:hasHeaderValue ?fieldValue .

             VALUES ?hdrName {"X-Correlation-ID"}
             OPTIONAL {
                  welcome:message  welcome:hasCorrelationID  ?corrId.
              }
              BIND( IF(BOUND(?corrId), ?corrId, "NoneInLakr") AS ?fieldValue)
          } UNION {
              VALUES ?hdrName {"X-User-ID"}
              
              OPTIONAL {
                  ?tcn_user   rdf:type  welcome:DialogueUser ;
                              welcome:hasUserId ?userIdBNode .
                  ?userIdBNode  welcome:hasValue  ?userId . 
              }

              BIND( IF(BOUND(?userId), ?userId, "NoneInLakr") AS ?fieldValue)
          }  UNION {
              VALUES ?hdrName {"X-Msg-Type"}
              VALUES ?fieldValue {"Groups"}
          }           
        }
        """^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
                        CONSTRUCT {
            
              ?lccSubject <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#LCCUseCase> ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasId> ?lccId ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasSolution> ?lccSolution ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasDedicatedAgent> ?dAgentId ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasStatus> ?lccStatus .

              ?lccSolution  <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Grouping> ;
                      <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasValue>  ?csValue ;
                      <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasRank>   ?csRank ;
                      <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasSolutionOf> ?lccSubject ;
                      <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasMembers>  ?coalition .

              ?coalition  <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#Group> ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasMembers>  ?memberAgent .

            }
            WHERE {
              # Select LCC Use Case Problem Info
              ?lccSubject <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#LCCUseCase> ;
                    <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasId> ?lccId ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasDedicatedAgent> ?dAgentId .

              OPTIONAL {
                ?lccSubject <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasSolution> ?lccSolution .
                # Select LCC Use Case Solutions
                ?lccSolution  <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#CSGP-CoalitionStructure> ;
                        <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasValue>  ?csValue ;
                        <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasRank>   ?csRank ;
                        <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasSolutionOf> ?lccSubject ;
                        <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasMembers>  ?coalition .

                ?coalition  <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#CSGP-Coalition> ;
                <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasMembers>  ?memberAgent .
              }
              BIND( IF( BOUND(?lccSolution) && BOUND(?csValue) && BOUND(?csRank) && BOUND(?coalition) &&
                    BOUND(?memberAgent), "Completed", "No Solution Found") AS ?lccStatus)

              }
        """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

          # LINES TO SEND TO DUMMY ENDPOINT
          #SELECT DISTINCT ?requestURI
          #WHERE {
          # VALUES ?requestURI { "http://localhost:8092/teacherPanel/inform"}
          #}

          # LINES TO SEND TO ACTUAL ENDPOINT
          SELECT ?requestURI
          WHERE
          {
            welcome:dispatcher welcome:hasAddress ?partialAddress .
            BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/messageToTeacher") AS ?requestURI )
          }

          """^^xsd:string
  ] .
:WriteEverythingToLSR
  a bt:Write ;
  rdfs:label "Write everything to LSR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:LocalServicesKnowledge ;
    bt:sparql """
          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }
    """^^xsd:string ;
  ] .
:Message2TeacherLccFailed
  a myWelcome:Message ;
  rdfs:label "Message: LCC Failed 2 Teacher"^^xsd:string ;
  rdfs:comment ""^^xsd:string ;
  bt:targetBase ajan:ExecutionKnowledge ;
  myWelcome:correlatorId [
    a bt:SelectQuery;
    bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT ?correlatorId
        WHERE {
            ?msg welcome:hasCorrelationID ?correlatorId .
        }"""^^xsd:string
  ] ;
  bt:binding [
    a http-core:Request ;
    http-core:httpVersion "1.1"^^xsd:string ;
    http-core:mthd http-methods:POST ;
    bt:headers [
      a bt:SelectQuery;
      a bt:QueryUri ;
      bt:originBase ajan:AgentKnowledge ;
      bt:sparql """
        PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#> 
        SELECT DISTINCT ?hdrName ?fieldValue
        WHERE { 
          {
#            ?headerName welcome:hasHeaderName ?hdrName .
#            ?headerName welcome:hasHeaderValue ?fieldValue .

             VALUES ?hdrName {"X-Correlation-ID"}
             OPTIONAL {
                  welcome:message  welcome:hasCorrelationID  ?corrId.
              }
              BIND( IF(BOUND(?corrId), ?corrId, "NoneInLakr") AS ?fieldValue)
          } UNION {
              VALUES ?hdrName {"X-User-ID"}
              
              OPTIONAL {
                  ?tcn_user   rdf:type  welcome:DialogueUser ;
                              welcome:hasUserId ?userIdBNode .
                  ?userIdBNode  welcome:hasValue  ?userId . 
              }

              BIND( IF(BOUND(?userId), ?userId, "NoneInLakr") AS ?fieldValue)
          }  UNION {
              VALUES ?hdrName {"X-Msg-Type"}
              VALUES ?fieldValue {"Groups"}
          }           
        }"""^^xsd:string
    ] ;
    http-core:headers ([
          a http-core:Header ;
          http-core:hdrName http-headers:accept ;
          http-core:fieldValue "text/turtle"^^xsd:string
        ][
          a http-core:Header ;
          http-core:hdrName http-headers:content-type ;
          http-core:fieldValue "text/turtle"
        ]
    ) ;
    http-core:body [
      a actn:Payload ;
      bt:query [
        rdf:type bt:ConstructQuery ;
        bt:originBase ajan:ExecutionKnowledge ;
        bt:sparql """
            CONSTRUCT {
              ?lccSubject <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#LCCUseCase> ;
                    <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasId> ?lccId ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasDedicatedAgent> ?dAgentId ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasStatus> ?lccStatus .
            }
            WHERE {
              # Select LCC Use Case Problem Info
              ?lccSubject <http://www.w3.org/1999/02/22-rdf-syntax-ns#type>  <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#LCCUseCase> ;
                    <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#hasId> ?lccId ;
                    <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#hasDedicatedAgent> ?dAgentId .

              BIND( "Failed" AS ?lccStatus)

              }
        """^^xsd:string
      ]
    ] ;
  ] ;
  bt:queryUri [
    a bt:SelectQuery ;
    a bt:QueryUri ;
    bt:originBase ajan:AgentKnowledge ;
    bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
          
          #LINES TO SEND TO DUMMY ENDPOINT
          #SELECT DISTINCT ?requestURI
          #WHERE {
          # VALUES ?requestURI { "http://localhost:8092/teacherPanel/inform"}
          #}

          # LINES TO SEND TO ACTUAL ENDPOINT
          SELECT ?requestURI
          WHERE
          {
            welcome:dispatcher welcome:hasAddress ?partialAddress .
            BIND(CONCAT(STR(?partialAddress), "/welcome/integration/workflow/dispatcher/messageToTeacher") AS ?requestURI )
          }
          """^^xsd:string
  ] .

:ProduceFinalizeLccEvent
  a bt:EventProducer ;
  rdfs:label "EventProducer: Finalize LCC Event" ;
  ajan:event agents:FinalizeLccProcessEvent ;
  bt:content [
          a bt:ConstructQuery ;
          bt:originBase ajan:ExecutionKnowledge;
          bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

            CONSTRUCT {
              ?agentUri rdf:type  ajan:Agent ;
                    ajan:agentId  ?agentId .

              ?lccSubject rdf:type  welcome:LCCUseCase ;
                    mac:hasId ?lccId ;
                    mac:hasSolution ?lccSolution ;
                    welcome:hasDedicatedAgent ?dAgentId ;
                    mac:hasMinCsValue ?minCsValue ;
                    welcome:hasStatus ?lccStatus .

              ?lccSolution  rdf:type  mac:CSGP-CoalitionStructure ;
                      mac:hasValue  ?csValue ;
                      mac:hasRank   ?csRank ;
                      mac:hasSolutionOf ?lccSubject ;
                      mac:hasMembers  ?coalition .

              ?coalition  rdf:type  mac:CSGP-Coalition ;
                      mac:hasMembers  ?memberAgent .
            }
            WHERE {
              ?agentUri rdf:type  ajan:Agent  ;
                    ajan:agentId  ?agentId .

              # Select LCC Use Case Problem Info
              ?lccSubject rdf:type  welcome:LCCUseCase ;
                    mac:hasId ?lccId ;
                    welcome:hasDedicatedAgent ?dAgentId .

              OPTIONAL {
                ?lccSubject mac:hasSolution ?lccSolution .
                # Select LCC Use Case Solutions
                ?lccSolution  rdf:type  mac:CSGP-CoalitionStructure ;
                        mac:hasValue  ?csValue ;
                        mac:hasRank   ?csRank ;
                        mac:hasSolutionOf ?lccSubject ;
                        mac:hasMembers  ?coalition .
              }
              OPTIONAL {
                ?lccSubject rdf:type  welcome:LCCUseCase ;
                      mac:hasMinCsValue ?minCsValue .
              }

              OPTIONAL {
                ?coalition  rdf:type  mac:CSGP-Coalition ;
                      mac:hasMembers  ?memberAgent .
              }
#             BIND( IF( BOUND(?lccSolution) && BOUND(?csValue) && BOUND(?csRank) && BOUND(?coalition) &&
#                   BOUND(?memberAgent), "Completed", "Failed") AS ?lccStatus)
              BIND( IF( BOUND(?lccSolution) && BOUND(?csValue) && BOUND(?csRank), "Completed", "No Solution Found") AS ?lccStatus)

              } """^^xsd:string ;
        ] .

:HandleFinalizeLccEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: Finalize LCC Event" ;
  rdfs:comment "Handle Finalize LCC Process Event" ;
  bt:event agents:FinalizeLccProcessEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """

          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }"""^^xsd:string ;
        ] .

:HandleLccFailedEvent
  a bt:HandleQueueEvent ;
  rdfs:label "EventHandler: Lcc Failed Event" ;
  rdfs:comment "" ;
  bt:event agents:LccFailureEvent ;
  bt:validate [
      a bt:ConstructQuery ;
      bt:targetBase ajan:ExecutionKnowledge ;
      bt:sparql """

          CONSTRUCT {
            ?s ?p ?o .
          }
          WHERE {
            ?s ?p ?o .
          }"""^^xsd:string ;
        ] .

:WriteLccResult
  a bt:Write ;
  rdfs:label "Write: LCC Result 2 LAKR" ;
  rdfs:comment "Write LCC Result to LAKR" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge  ;
    bt:sparql """
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

          CONSTRUCT {
            ?lccSubject rdf:type  welcome:LCCUseCase, mac:MACProblemInstance ;
                  welcome:hasEndTime  ?now ;
                  mac:hasId ?lccId ;
                  mac:hasSolution ?lccSolution ;
                  welcome:hasDedicatedAgent ?dAgentId ;
                  mac:hasMinCsValue ?minCsValue ;
                  welcome:hasStatus ?lccStatus .

            ?lccSolution  rdf:type  mac:CSGP-CoalitionStructure ;
                    mac:hasValue  ?csValue ;
                    mac:hasRank   ?csRank ;
                    mac:hasSolutionOf ?lccSubject ;
                    mac:hasMembers  ?coalition .

            ?coalition  rdf:type  mac:CSGP-Coalition ;
                  mac:hasMembers  ?memberAgent .
            #?s ?p ?o .

          }
          WHERE {
            # Select LCC Use Case Problem Info
            ?lccSubject rdf:type  welcome:LCCUseCase ;
                  welcome:hasStatus ?lccStatus ;
                  mac:hasId ?lccId ;
                  welcome:hasDedicatedAgent ?dAgentId .

            OPTIONAL {
              ?lccSubject mac:hasSolution ?lccSolution .
              # Select LCC Use Case Solutions
              ?lccSolution  rdf:type  mac:CSGP-CoalitionStructure ;
                      mac:hasValue  ?csValue ;
                      mac:hasRank   ?csRank ;
                      mac:hasSolutionOf ?lccSubject ;
                      mac:hasMembers  ?coalition .

            # ?coalition  rdf:type  mac:CSGP-Coalition ;
            #       mac:hasMembers  ?memberAgent .
            }

            OPTIONAL {
              ?lccSubject rdf:type  welcome:LCCUseCase ;
                    mac:hasMinCsValue ?minCsValue .
                    }
            #?s ?p ?o .
            BIND(NOW() AS ?now)
          }


    """^^xsd:string ;
  ] .

#-------------LCC Protocol BT Nodes END--------------------------

:WriteTest
  a bt:Write ;
  rdfs:label "Write: Test" ;
  bt:query [
    a bt:ConstructQuery ;
    bt:originBase ajan:ExecutionKnowledge ;
    bt:targetBase ajan:AgentKnowledge ;
    bt:sparql """
            PREFIX dbr: <http://dbpedia.org/resource/>
            PREFIX dbp: <http://dbpedia.org/property/>
            PREFIX dbo: <http://dbpedia.org/ontology/>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
            CONSTRUCT {
              dbr:reqem rdf:type ?o2.
            } WHERE {
              BIND("1"^^xsd:int AS ?o2)
              OPTIONAL {
              dbr:reqem rdf:type ?o.
              FILTER(?o>0)
              BIND(?o+1 AS ?o2)
              }
        } """^^xsd:string ;
  ] .

:HandleTestQueueEvent
  a bt:HandleQueueEvent ;
  rdfs:label "QueueEventHandler: Handle TEST Queue Event" ;
  bt:event agents:TestQueueEvent ;
  bt:validate [
          a bt:ConstructQuery ;
          bt:targetBase ajan:ExecutionKnowledge ;
          bt:sparql """
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>

            CONSTRUCT {
            dbr:reqem rdf:type .
            }
            WHERE {
              ?s ?p ?o .
            }"""^^xsd:string ;
        ] .

#--------------------TEST Bts----------------------
#------------LCC Protocol Nodes -------------------------------

:TestBigQuery
  a bt:Write ;
  rdfs:label "Testing Big Query" ;
  bt:query [
        a bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:targetBase ajan:AgentKnowledge ;
        bt:sparql """
            PREFIX ajan: <http://www.ajan.de/ajan-ns#>
            PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
            PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
            PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
            CONSTRUCT{
              _:bNodeSimilarity ajan:subject ?a1;
              ajan:object ?a2;
              mac:isComputedForProblemId  ?usecaseId;
              mac:hasPerfectMatchScore ?perfectMatchScore;
              mac:hasNumberOfAgents ?numberOfAgents;
              mac:hasSimilarityScore ?totalSml.
              }
            WHERE {
              welcome:UseCase welcome:toBeSolved ?usecase.
              ?usecase  mac:hasMacProblemId  ?usecaseId;
                  mac:hasNumberOfAgents ?numberOfAgents;
                  welcome:hasAgeWeight ?ageWeight;
                  welcome:hasGenderWeight ?genWeight;
                  welcome:hasFamilyWeight ?famWeight;
                  welcome:hasNationalityWeight  ?natWeight;
                  welcome:hasReligionWeight ?relWeight;
                  welcome:hasEthnicityWeight  ?ethWeight;
                  welcome:hasLocationWeight ?locWeight;
                  welcome:hasAccessibilityWeight  ?accWeight;
                  welcome:hasRentPeriodWeight ?rentWeight;
                  welcome:hasShareWithWeight  ?shareWeight.
              ?a1 a ajan:Agent.
              ?a1 welcome:isParticipatingIn ?usecaseId.

              ?a2 a ajan:Agent.
              ?a2 welcome:isParticipatingIn ?usecaseId.
              ?a1 welcome:hasChcAgePreference ?agePrefA1.
              OPTIONAL {
                ?agePrefA1 welcome:lowerBound ?lowerAgeA1;
                  welcome:higherBound ?higherAgeA1.
                }.
              ?a1 welcome:hasChcGenderPreference ?genPrefA1.
              ?a1 welcome:hasChcFamilyPreference ?famPrefA1.
              ?a1 welcome:hasChcNationPreference ?natPrefA1.
              ?a1 welcome:hasNationality ?nationA1.
              ?a1 welcome:hasChcReligionPreference ?relPrefA1.
              ?a1 welcome:hasReligion ?relA1.
              ?a1 welcome:hasChcEthnicPreference ?ethPrefA1.
              ?a1 welcome:hasEthnicity ?ethA1.
              ?a1 welcome:hasChcLocationPreference ?locPrefA1.
              ?a1 welcome:hasChcAccessibilityPreference ?accPrefA1.
              ?a1 welcome:hasChcRentPeriodPreference ?rentPrefA1.
              OPTIONAL {
                ?rentPrefA1 welcome:startDate ?startRentA1;
                  welcome:endDate ?endRentA1.
                }.
              ?a1 welcome:hasShareWithPreference ?sharePrefA1.
              OPTIONAL {
                ?sharePrefA1 welcome:min ?minShareA1;
                  welcome:max ?maxShareA1.
                }.
              ?a2 welcome:hasAge ?ageA2.
              ?a2 welcome:hasGender ?genA2.
              ?a2 welcome:hasFamily ?famA2.
              ?a2 welcome:hasNationality ?nationA2.
              ?a2 welcome:hasReligion ?relA2.
              ?a2 welcome:hasEthnicity ?ethA2.
              ?a2 welcome:hasChcLocationPreference ?locPrefA2.
              ?a2 welcome:hasChcAccessibilityPreference ?accPrefA2.
              ?a2 welcome:hasChcRentPeriodPreference ?rentPrefA2.
              OPTIONAL {
                ?rentPrefA2 welcome:startDate ?startRentA2;
                  welcome:endDate ?endRentA2.
                }.
              ?a2 welcome:hasShareWithPreference ?sharePrefA2.
              OPTIONAL {
                ?sharePrefA2 welcome:min ?minShareA2;
                  welcome:max ?maxShareA2.
                }.
              FILTER(?a1 != ?a2)
              BIND(1 AS ?matchScore)
              BIND(0 AS ?unmatchScore)
              BIND(10 AS ?numberOfPreferences)
              BIND((?matchScore * (?ageWeight + ?genWeight + ?famWeight + ?natWeight + ?relWeight + ?ethWeight + ?locWeight + ?accWeight + ?rentWeight + ?shareWeight))/?numberOfPreferences AS ?perfectMatchScore)

              BIND(IF(?agePrefA1="Dont mind" || (xsd:integer(?ageA2) >= xsd:integer(?lowerAgeA1) && xsd:integer(?ageA2) <= xsd:integer(?higherAgeA1)), ?matchScore, ?unmatchScore) AS ?ageSml).
              BIND(IF(?genPrefA1="Dont mind" || ?genA2=?genPrefA1, ?matchScore, ?unmatchScore) AS ?genSml).
              BIND(IF(?famPrefA1="Dont mind" || ?famA2=?famPrefA1, ?matchScore, ?unmatchScore) AS ?famSml).
              BIND(IF(?natPrefA1="Dont mind" || (?natPrefA1="Same" && ?nationA1=?nationA2) || (?natPrefA1="Mixed" && ?nationA1!=?nationA2), ?matchScore, ?unmatchScore) AS ?natSml)
              BIND(IF(?relPrefA1="Dont mind" || (?relPrefA1="Same" && ?relA1=?relA2) || (?relPrefA1="Mixed" && ?relA1!=?relA2), ?matchScore, ?unmatchScore) AS ?relSml)
              BIND(IF(?ethPrefA1="Dont mind" || (?ethPrefA1="Same" && ?ethA1=?ethA2) || (?ethPrefA1="Mixed" && ?ethA1!=?ethA2), ?matchScore, ?unmatchScore) AS ?ethSml)

              BIND(IF(?locPrefA1="Dont mind" || ?locPrefA2="Dont mind" || ?locPrefA1=?locPrefA2, ?matchScore, ?unmatchScore) AS ?locSml)
              BIND(IF(?accPrefA1="Dont mind" || ?accPrefA2="Dont mind" || ?accPrefA1=?accPrefA2, ?matchScore, ?unmatchScore) AS ?accSml)
              BIND(((year(xsd:dateTime(?endRentA1)) - year(now()))*365 + 30*(month(xsd:dateTime(?endRentA1))) + day(xsd:dateTime(?endRentA1))) AS ?endRentA1IntValue)
              BIND(((year(xsd:dateTime(?endRentA2)) - year(now()))*365 + 30*(month(xsd:dateTime(?endRentA2))) + day(xsd:dateTime(?endRentA2))) AS ?endRentA2IntValue)
              BIND(((year(xsd:dateTime(?startRentA1)) - year(now()))*365 + 30*(month(xsd:dateTime(?startRentA1))) + day(xsd:dateTime(?startRentA1))) AS ?startRentA1IntValue)
              BIND(((year(xsd:dateTime(?startRentA2)) - year(now()))*365 + 30*(month(xsd:dateTime(?startRentA2))) + day(xsd:dateTime(?startRentA2))) AS ?startRentA2IntValue)
              BIND(IF(?endRentA1IntValue>?endRentA2IntValue, ?endRentA2IntValue, ?endRentA1IntValue) AS ?smallerEndRent)
              BIND(IF(?startRentA1IntValue>?startRentA2IntValue, ?startRentA1IntValue, ?startRentA2IntValue) AS ?biggerStartRent)
              BIND(IF(?startRentA1IntValue>?startRentA2IntValue, ?startRentA2IntValue, ?startRentA1IntValue) AS ?smallerStartRent)
              BIND(IF(?endRentA1IntValue>?endRentA2IntValue, ?endRentA1IntValue, ?endRentA2IntValue) AS ?biggerEndRent)
              BIND(?smallerEndRent - ?biggerStartRent + 1 AS ?rentOverlap)
              BIND(?biggerEndRent - ?smallerStartRent + 1 AS ?rentTotal)
              BIND(IF(?rentPrefA1="Dont mind" || ?rentPrefA2="Dont mind", ?matchScore, IF(?startRentA1 > ?endRentA2 || ?startRentA2 > ?endRentA1, ?unmatchScore,
              xsd:double(?rentOverlap/?rentTotal))) AS ?rentSml)
              BIND(IF(?maxShareA1>?maxShareA2, ?maxShareA2, ?maxShareA1) AS ?smallerMaxShare)
              BIND(IF(?minShareA1>?minShareA2, ?minShareA1, ?minShareA2) AS ?biggerMinShare)
              BIND(IF(?minShareA1>?minShareA2, ?minShareA2, ?minShareA1) AS ?smallerMinShare)
              BIND(IF(?maxShareA1>?maxShareA2, ?maxShareA1, ?maxShareA2) AS ?biggerMaxShare)
              BIND(?smallerMaxShare - ?biggerMinShare + 1 AS ?shareOverlap)

              BIND(?biggerMaxShare - ?smallerMinShare + 1 AS ?shareTotal)
              BIND(IF(?sharePrefA1="Dont mind" || ?sharePrefA2="Dont mind", ?matchScore, IF(?minShareA1 > ?maxShareA2 || ?minShareA2 > ?maxShareA1, ?unmatchScore,
              xsd:double(?shareOverlap/?shareTotal))) AS ?shareSml)

              BIND(xsd:float(((?ageSml * ?ageWeight) + (?genSml * ?genWeight) + (?famSml * ?famWeight) + (?natSml * ?natWeight) + (?relSml * ?relWeight) +
              (?ethSml * ?ethWeight) + (?locSml * ?locWeight) + (?accSml * ?accWeight) + (?rentSml * ?rentWeight) + (?shareSml * ?shareWeight))/10.0) AS ?totalSml).
              }
                    """^^xsd:string ;
      ] .
      
:HDBSCAN
  a bt:HDBSCAN ;
  rdfs:label "Run HDBSCAN" ;
  bt:query [
        a bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:targetBase ajan:AgentKnowledge ;
        bt:sparql """
          PREFIX ajan: <http://www.ajan.de/ajan-ns#>
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          CONSTRUCT{
            ?usecase  mac:hasMacProblemId  ?usecaseID;
                mac:hasPerfectMatchScore ?perfectMatchScore;
                mac:hasNumberOfAgents ?numberOfAgents;
                mac:hasParticipants ?agents.
            _:bNodeSimilarity   mac:hasSubjectAgent ?a1;
                  mac:hasObjectAgent ?a2;
                  mac:isComputedForProblemId  ?usecaseId;
                  mac:hasSimilarityScore ?totalSml.
            }
          WHERE {
            {
            welcome:UseCase welcome:toBeSolved ?usecase.
            ?usecase  mac:hasNumberOfAgents ?numberOfAgents;
                mac:hasParticipants ?agents;
                mac:hasMacProblemId  ?usecaseID;
                welcome:hasAgeWeight ?ageWeight;
                welcome:hasGenderWeight ?genWeight;
                welcome:hasFamilyWeight ?famWeight;
                welcome:hasNationalityWeight  ?natWeight;
                welcome:hasReligionWeight ?relWeight;
                welcome:hasEthnicityWeight  ?ethWeight;
                welcome:hasLocationWeight ?locWeight;
                welcome:hasAccessibilityWeight  ?accWeight;
                welcome:hasRentPeriodWeight ?rentWeight;
                welcome:hasShareWithWeight  ?shareWeight.
            BIND(1 AS ?matchScore)
            BIND(0 AS ?unmatchScore)
            BIND(10 AS ?numberOfPreferences)
            BIND((?matchScore * (?ageWeight + ?genWeight + ?famWeight + ?natWeight + ?relWeight + ?ethWeight + ?locWeight + ?accWeight + ?rentWeight + ?shareWeight))/?numberOfPreferences AS ?perfectMatchScore)
            } UNION {
            welcome:UseCase welcome:toBeSolved ?usecase.

            ?usecase  mac:hasMacProblemId  ?usecaseId;
                welcome:hasAgeWeight ?ageWeight;
                welcome:hasGenderWeight ?genWeight;
                welcome:hasFamilyWeight ?famWeight;
                welcome:hasNationalityWeight  ?natWeight;
                welcome:hasReligionWeight ?relWeight;
                welcome:hasEthnicityWeight  ?ethWeight;
                welcome:hasLocationWeight ?locWeight;
                welcome:hasAccessibilityWeight  ?accWeight;
                welcome:hasRentPeriodWeight ?rentWeight;
                welcome:hasShareWithWeight  ?shareWeight.

            BIND(1 AS ?matchScore)
            BIND(0 AS ?unmatchScore)

            ?a1 a ajan:Agent.
            ?a1 welcome:isParticipatingIn ?usecaseId.

            ?a2 a ajan:Agent.
            ?a2 welcome:isParticipatingIn ?usecaseId.
            ?a1 welcome:hasChcAgePreference ?agePrefA1.
            OPTIONAL {
              ?agePrefA1 welcome:lowerBound ?lowerAgeA1;
                  welcome:higherBound ?higherAgeA1.
              }.
            ?a1 welcome:hasChcGenderPreference ?genPrefA1.
            ?a1 welcome:hasChcFamilyPreference ?famPrefA1.
            ?a1 welcome:hasChcNationPreference ?natPrefA1.
            ?a1 welcome:hasNationality ?nationA1.
            ?a1 welcome:hasChcReligionPreference ?relPrefA1.
            ?a1 welcome:hasReligion ?relA1.
            ?a1 welcome:hasChcEthnicPreference ?ethPrefA1.
            ?a1 welcome:hasEthnicity ?ethA1.
            ?a1 welcome:hasChcLocationPreference ?locPrefA1.
            ?a1 welcome:hasChcAccessibilityPreference ?accPrefA1.
            ?a1 welcome:hasChcRentPeriodPreference ?rentPrefA1.
            OPTIONAL {
              ?rentPrefA1 welcome:startDate ?startRentA1;
                welcome:endDate ?endRentA1.
              }.
            ?a1 welcome:hasChcShareWithPreference ?sharePrefA1.
              OPTIONAL {
              ?sharePrefA1 welcome:min ?minShareA1;
                welcome:max ?maxShareA1.
              }.
            ?a2 welcome:hasAge ?ageA2.
            ?a2 welcome:hasGender ?genA2.
            ?a2 welcome:hasFamily ?famA2.
            ?a2 welcome:hasNationality ?nationA2.
            ?a2 welcome:hasReligion ?relA2.
            ?a2 welcome:hasEthnicity ?ethA2.
            ?a2 welcome:hasChcLocationPreference ?locPrefA2.
            ?a2 welcome:hasChcAccessibilityPreference ?accPrefA2.
            ?a2 welcome:hasChcRentPeriodPreference ?rentPrefA2.
            OPTIONAL {
              ?rentPrefA2 welcome:startDate ?startRentA2;
                welcome:endDate ?endRentA2.
              }.
            ?a2 welcome:hasChcShareWithPreference ?sharePrefA2.
            OPTIONAL {
              ?sharePrefA2 welcome:min ?minShareA2;
                welcome:max ?maxShareA2.
              }.
            FILTER(?a1 != ?a2)
            BIND(IF(?agePrefA1="Dont mind" || (xsd:integer(?ageA2) >= xsd:integer(?lowerAgeA1) && xsd:integer(?ageA2) <= xsd:integer(?higherAgeA1)), ?matchScore, ?unmatchScore) AS ?ageSml).
            BIND(IF(?genPrefA1="Dont mind" || ?genA2=?genPrefA1, ?matchScore, ?unmatchScore) AS ?genSml).
            BIND(IF(?famPrefA1="Dont mind" || ?famA2=?famPrefA1, ?matchScore, ?unmatchScore) AS ?famSml).
            BIND(IF(?natPrefA1="Dont mind" || (?natPrefA1="Same" && ?nationA1=?nationA2) || (?natPrefA1="Mixed" && ?nationA1!=?nationA2), ?matchScore, ?unmatchScore) AS ?natSml)
            BIND(IF(?relPrefA1="Dont mind" || (?relPrefA1="Same" && ?relA1=?relA2) || (?relPrefA1="Mixed" && ?relA1!=?relA2), ?matchScore, ?unmatchScore) AS ?relSml)
            BIND(IF(?ethPrefA1="Dont mind" || (?ethPrefA1="Same" && ?ethA1=?ethA2) || (?ethPrefA1="Mixed" && ?ethA1!=?ethA2), ?matchScore, ?unmatchScore) AS ?ethSml)

            BIND(IF(?locPrefA1="Dont mind" || ?locPrefA2="Dont mind" || ?locPrefA1=?locPrefA2, ?matchScore, ?unmatchScore) AS ?locSml)
            BIND(IF(?accPrefA1="Dont mind" || ?accPrefA2="Dont mind" || ?accPrefA1=?accPrefA2, ?matchScore, ?unmatchScore) AS ?accSml)
            BIND(((year(xsd:dateTime(?endRentA1)) - year(now()))*365 + 30*(month(xsd:dateTime(?endRentA1))) + day(xsd:dateTime(?endRentA1))) AS ?endRentA1IntValue)
            BIND(((year(xsd:dateTime(?endRentA2)) - year(now()))*365 + 30*(month(xsd:dateTime(?endRentA2))) + day(xsd:dateTime(?endRentA2))) AS ?endRentA2IntValue)
            BIND(((year(xsd:dateTime(?startRentA1)) - year(now()))*365 + 30*(month(xsd:dateTime(?startRentA1))) + day(xsd:dateTime(?startRentA1))) AS ?startRentA1IntValue)
            BIND(((year(xsd:dateTime(?startRentA2)) - year(now()))*365 + 30*(month(xsd:dateTime(?startRentA2))) + day(xsd:dateTime(?startRentA2))) AS ?startRentA2IntValue)
            BIND(IF(?endRentA1IntValue>?endRentA2IntValue, ?endRentA2IntValue, ?endRentA1IntValue) AS ?smallerEndRent)
            BIND(IF(?startRentA1IntValue>?startRentA2IntValue, ?startRentA1IntValue, ?startRentA2IntValue) AS ?biggerStartRent)
            BIND(IF(?startRentA1IntValue>?startRentA2IntValue, ?startRentA2IntValue, ?startRentA1IntValue) AS ?smallerStartRent)
            BIND(IF(?endRentA1IntValue>?endRentA2IntValue, ?endRentA1IntValue, ?endRentA2IntValue) AS ?biggerEndRent)
            BIND(?smallerEndRent - ?biggerStartRent + 1 AS ?rentOverlap)
            BIND(?biggerEndRent - ?smallerStartRent + 1 AS ?rentTotal)
            BIND(IF(?rentPrefA1="Dont mind" || ?rentPrefA2="Dont mind", ?matchScore, IF(?startRentA1 > ?endRentA2 || ?startRentA2 > ?endRentA1, ?unmatchScore,
            xsd:double(?rentOverlap/?rentTotal))) AS ?rentSml)
            BIND(IF(?maxShareA1>?maxShareA2, ?maxShareA2, ?maxShareA1) AS ?smallerMaxShare)
            BIND(IF(?minShareA1>?minShareA2, ?minShareA1, ?minShareA2) AS ?biggerMinShare)
            BIND(IF(?minShareA1>?minShareA2, ?minShareA2, ?minShareA1) AS ?smallerMinShare)
            BIND(IF(?maxShareA1>?maxShareA2, ?maxShareA1, ?maxShareA2) AS ?biggerMaxShare)
            BIND(?smallerMaxShare - ?biggerMinShare + 1 AS ?shareOverlap)

            BIND(?biggerMaxShare - ?smallerMinShare + 1 AS ?shareTotal)
            BIND(IF(?sharePrefA1="Dont mind" || ?sharePrefA2="Dont mind", ?matchScore, IF(?minShareA1 > ?maxShareA2 || ?minShareA2 > ?maxShareA1, ?unmatchScore,
            xsd:double(?shareOverlap/?shareTotal))) AS ?shareSml)

            BIND(xsd:float(((?ageSml * ?ageWeight) + (?genSml * ?genWeight) + (?famSml * ?famWeight) + (?natSml * ?natWeight) + (?relSml * ?relWeight) +
            (?ethSml * ?ethWeight) + (?locSml * ?locWeight) + (?accSml * ?accWeight) + (?rentSml * ?rentWeight) + (?shareSml * ?shareWeight))/10.0) AS ?totalSml).
            }}
          """^^xsd:string ;
      ] .

:CoalitionGenerator
  a bt:CoalitionGenerator ;
  rdfs:label "Generating Coalitions" ;
  bt:query [
        a bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:targetBase ajan:AgentKnowledge ;
        bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          Construct {
            welcome:LCC1 ?p ?o.
            ?o2 ?p3 ?o3.
          }
          Where{
            { welcome:LCC1 ?p ?o. }   UNION
            { welcome:LCC1 ?p2 ?o2.
              ?o2 ?p3 ?o3.}
          }
          """^^xsd:string ;
      ] .

:CSGPSolver
  a bt:CSGPSolver ;
  rdfs:label "Solve CSGP" ;
  bt:query [
        a bt:ConstructQuery ;
        bt:originBase ajan:AgentKnowledge ;
        bt:targetBase ajan:AgentKnowledge ;
        bt:sparql """
          PREFIX welcome: <https://raw.githubusercontent.com/gtzionis/WelcomeOntology/main/welcome.ttl#>
          PREFIX mac: <http://localhost:8090/rdf4j/repositories/ajan_mac_ontology#>
          Construct {
            welcome:LCC1 ?p ?o.
            ?o2 ?p3 ?o3.
          }
          Where{
            { welcome:LCC1 ?p ?o. }   UNION
            { welcome:LCC1 ?p2 ?o2.
              ?o2 ?p3 ?o3.}
          }
          """^^xsd:string ;
      ] .

#------------LCC Protocol Nodes -------------------------------

#------------MAJAN Stuff----------------------